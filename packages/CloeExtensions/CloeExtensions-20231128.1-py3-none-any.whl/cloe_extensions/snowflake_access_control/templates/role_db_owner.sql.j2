{% set role_name = 'R_T_' ~ database_name ~ '_OWNER' -%}
{% if delete_role -%}
DROP ROLE IF EXISTS {{ role_name }};
{% elif create_role -%}
CREATE ROLE IF NOT EXISTS {{ role_name }};
{% elif grant_role -%}
GRANT ROLE {{ role_name }} TO ROLE SYSADMIN;
GRANT USAGE ON DATABASE {{ database_name }} TO ROLE {{ role_name }};
GRANT OWNERSHIP ON FUTURE SCHEMAS IN DATABASE {{ database_name }} TO ROLE {{ role_name }} COPY CURRENT GRANTS;
GRANT CREATE SCHEMA ON DATABASE {{ database_name }} TO ROLE {{ role_name }};
{% for schema in schemas -%}
GRANT ROLE R_T_{{ database_name }}_{{ schema["name"] }}_OWNER TO ROLE {{ role_name }};
{% endfor -%}
{% endif -%}
