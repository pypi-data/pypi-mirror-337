import{g as Ve,p as Ce,cc as Ye,j as Pe,t as K,m as Ze,k as Je,A as ke,B as t,an as X,F as el,K as De,cd as Ie,J as Ee,N as Se,c7 as Re,ad as ll,s as tl,x as N,w as J,a as de,I as Me,ae as al,h as nl,ai as sl,f as il,z as ol,c as W,H as rl,al as ul,ce as dl,Q as re,ah as Be,R as $,S as h,U as s,Z as oe,as as ie,bD as le,ao as L,ab as I,G as pe,$ as He,aW as ml,a3 as pl,bv as cl,bw as Le,a8 as P,a7 as te,W as ae,cf as C,cg as F,d as vl,o as qe,a9 as x,a0 as _,bm as fl,bo as ge,ch as gl,P as ye,br as yl,ci as ee,l as _l,b1 as hl,a4 as _e,aZ as bl,bx as Vl,bE as Cl}from"./index-NjNzsJZz.js";import{a as j}from"./VBtn-BMSa1vvR.js";import{_ as xe}from"./_plugin-vue_export-helper-DlAUqK2U.js";import{V as kl}from"./VSlider-C-UASzEy.js";import{V as Sl}from"./VTextField-BzcjCXX9.js";import{V as ze}from"./VContainer-8K-4ZDub.js";import{a as me,V as he}from"./VSwitch-B2ae3Cuw.js";import{V as Ue,a as be}from"./VRow-CIfg2k_G.js";import{V as Ne}from"./VSpacer-Q407UFfd.js";import{V as Oe,a as we}from"./VToolbar-foJ2MHub.js";import{V as Ll}from"./VDialog-Dg4wySCa.js";import{V as Al}from"./VAlert-CTswA5gy.js";import"./VCheckboxBtn-xSdu6NP7.js";/* empty css              */import"./VVirtualScroll-BCTdJaoP.js";const Fl=Ce({dotColor:String,fillDot:Boolean,hideDot:Boolean,icon:Re,iconColor:String,lineColor:String,...Se(),...Ee(),...Ie(),...De()},"VTimelineDivider"),$l=Ve()({name:"VTimelineDivider",props:Fl(),setup(l,k){let{slots:c}=k;const{sizeClasses:o,sizeStyles:n}=Ye(l,"v-timeline-divider__dot"),{backgroundColorStyles:q,backgroundColorClasses:O}=Pe(K(l,"dotColor")),{roundedClasses:S}=Ze(l,"v-timeline-divider__dot"),{elevationClasses:E}=Je(l),{backgroundColorClasses:H,backgroundColorStyles:u}=Pe(K(l,"lineColor"));return ke(()=>t("div",{class:["v-timeline-divider",{"v-timeline-divider--fill-dot":l.fillDot},l.class],style:l.style},[t("div",{class:["v-timeline-divider__before",H.value],style:u.value},null),!l.hideDot&&t("div",{key:"dot",class:["v-timeline-divider__dot",E.value,S.value,o.value],style:n.value},[t("div",{class:["v-timeline-divider__inner-dot",O.value,S.value],style:q.value},[c.default?t(el,{key:"icon-defaults",disabled:!l.icon,defaults:{VIcon:{color:l.iconColor,icon:l.icon,size:l.size}}},c.default):t(X,{key:"icon",color:l.iconColor,icon:l.icon,size:l.size},null)])]),t("div",{class:["v-timeline-divider__after",H.value],style:u.value},null)])),{}}}),We=Ce({density:String,dotColor:String,fillDot:Boolean,hideDot:Boolean,hideOpposite:{type:Boolean,default:void 0},icon:Re,iconColor:String,lineInset:[Number,String],...Se(),...al(),...De(),...Ee(),...Ie(),...Me()},"VTimelineItem"),se=Ve()({name:"VTimelineItem",props:We(),setup(l,k){let{slots:c}=k;const{dimensionStyles:o}=ll(l),n=tl(0),q=N();return J(q,O=>{var S;O&&(n.value=((S=O.$el.querySelector(".v-timeline-divider__dot"))==null?void 0:S.getBoundingClientRect().width)??0)},{flush:"post"}),ke(()=>{var O,S;return t("div",{class:["v-timeline-item",{"v-timeline-item--fill-dot":l.fillDot},l.class],style:[{"--v-timeline-dot-size":de(n.value),"--v-timeline-line-inset":l.lineInset?`calc(var(--v-timeline-dot-size) / 2 + ${de(l.lineInset)})`:de(0)},l.style]},[t("div",{class:"v-timeline-item__body",style:o.value},[(O=c.default)==null?void 0:O.call(c)]),t($l,{ref:q,hideDot:l.hideDot,icon:l.icon,iconColor:l.iconColor,size:l.size,elevation:l.elevation,dotColor:l.dotColor,fillDot:l.fillDot,rounded:l.rounded},{default:c.icon}),l.density!=="compact"&&t("div",{class:"v-timeline-item__opposite"},[!l.hideOpposite&&((S=c.opposite)==null?void 0:S.call(c))])])}),{}}}),Tl=Ce({align:{type:String,default:"center",validator:l=>["center","start"].includes(l)},direction:{type:String,default:"vertical",validator:l=>["vertical","horizontal"].includes(l)},justify:{type:String,default:"auto",validator:l=>["auto","center"].includes(l)},side:{type:String,validator:l=>l==null||["start","end"].includes(l)},lineThickness:{type:[String,Number],default:2},lineColor:String,truncateLine:{type:String,validator:l=>["start","end","both"].includes(l)},...dl(We({lineInset:0}),["dotColor","fillDot","hideOpposite","iconColor","lineInset","size"]),...Se(),...ul(),...Me(),...rl()},"VTimeline"),Pl=Ve()({name:"VTimeline",props:Tl(),setup(l,k){let{slots:c}=k;const{themeClasses:o}=nl(l),{densityClasses:n}=sl(l),{rtlClasses:q}=il();ol({VTimelineDivider:{lineColor:K(l,"lineColor")},VTimelineItem:{density:K(l,"density"),dotColor:K(l,"dotColor"),fillDot:K(l,"fillDot"),hideOpposite:K(l,"hideOpposite"),iconColor:K(l,"iconColor"),lineColor:K(l,"lineColor"),lineInset:K(l,"lineInset"),size:K(l,"size")}});const O=W(()=>{const E=l.side?l.side:l.density!=="default"?"end":null;return E&&`v-timeline--side-${E}`}),S=W(()=>{const E=["v-timeline--truncate-line-start","v-timeline--truncate-line-end"];switch(l.truncateLine){case"both":return E;case"start":return E[0];case"end":return E[1];default:return null}});return ke(()=>t(l.tag,{class:["v-timeline",`v-timeline--${l.direction}`,`v-timeline--align-${l.align}`,`v-timeline--justify-${l.justify}`,S.value,{"v-timeline--inset-line":!!l.lineInset},o.value,n.value,O.value,q.value,l.class],style:[{"--v-timeline-line-thickness":de(l.lineThickness)},l.style]},c)),{}}}),ql=re({__name:"DSPPipeline",props:{dsp:{},selected:{}},emits:["onSelect","onAddFilter","onMoveFilter","onDeleteFilter"],setup(l,{emit:k}){const c=Be(),o=l,n=k,q=b=>o.selected===b?"primary":"secondary",O=b=>b==="input"||b==="output"?!1:!o.dsp.filters[b].enabled,S=b=>o.selected===b?"primary":c.global.current.value.dark?"grey-darken-3":"grey-lighten-3",E=b=>({"filter-selected":o.selected===b}),H=b=>{n("onSelect",b)},u=(b,D)=>{n("onMoveFilter",{index:b,direction:D})},T=b=>{n("onDeleteFilter",b)},R=function(b,D){const A=[{label:"settings.dsp.move_up",labelArgs:[],action:()=>{u(D,"up")},disabled:D===0,icon:"mdi-arrow-up"},{label:"settings.dsp.move_down",labelArgs:[],action:()=>{u(D,"down")},disabled:D===o.dsp.filters.length-1,icon:"mdi-arrow-down"},{label:"settings.dsp.delete_filter",labelArgs:[],action:()=>{T(D)},icon:"mdi-delete"}];pl.emit("contextmenu",{items:A,posX:b.clientX,posY:b.clientY})};return(b,D)=>(h(),$(Pl,{density:"compact",side:"end"},{default:s(()=>[t(se,{"dot-color":q("input"),size:"x-small",onClick:D[0]||(D[0]=A=>H("input"))},{default:s(()=>[t(j,{flat:"",rounded:"pill",color:S("input"),class:ie([E("input"),"dsp-pipeline-card"])},{default:s(()=>[t(le,{class:"px-3 py-1"},{default:s(()=>[L(I(b.$t("settings.dsp.input")),1)]),_:1})]),_:1},8,["color","class"])]),_:1},8,["dot-color"]),t(se,{"hide-dot":!0,size:"x-small"}),(h(!0),oe(pe,null,He(b.dsp.filters,(A,M)=>(h(),$(se,{key:M,"dot-color":q(M),size:"x-small","hide-dot":O(M),onClick:m=>H(M),onContextmenu:ml(m=>R(m,M),["prevent"])},{default:s(()=>[t(j,{flat:"",rounded:"pill",color:S(M),class:ie([E(M),"dsp-pipeline-card"])},{default:s(()=>[t(le,{class:"px-3 py-1"},{default:s(()=>[L(I(b.$t(`settings.dsp.types.${A.type}`)),1)]),_:2},1024)]),_:2},1032,["color","class"])]),_:2},1032,["dot-color","hide-dot","onClick","onContextmenu"]))),128)),t(se,{"dot-color":"secondary",size:"x-small","hide-dot":!0},{default:s(()=>[t(j,{outlined:"",rounded:"pill",class:"dsp-pipeline-card add-filter-btn",elevation:0,onClick:D[1]||(D[1]=A=>n("onAddFilter"))},{default:s(()=>[t(le,{class:"py-1 d-flex align-center"},{default:s(()=>[t(X,{size:"small",class:"mr-1"},{default:s(()=>D[3]||(D[3]=[L("mdi-plus")])),_:1}),L(" "+I(b.$t("settings.dsp.filter.add")),1)]),_:1})]),_:1})]),_:1}),t(se,{"hide-dot":!0,size:"x-small"}),t(se,{"dot-color":q("output"),size:"x-small",onClick:D[2]||(D[2]=A=>H("output"))},{default:s(()=>[t(j,{flat:"",rounded:"pill",color:S("output"),class:ie([E("output"),"dsp-pipeline-card"])},{default:s(()=>[t(le,{class:"px-3 py-1"},{default:s(()=>[L(I(b.$t("settings.dsp.output")),1)]),_:1})]),_:1},8,["color","class"])]),_:1},8,["dot-color"])]),_:1}))}}),Ol=xe(ql,[["__scopeId","data-v-f292f100"]]),wl={style:{"min-width":"100px"},class:"v-label pl-2"},Dl={style:{"min-width":"40px"},class:"pl-2"},Y=re({__name:"DSPSlider",props:cl({type:{}},{modelValue:{required:!0},modelModifiers:{}}),emits:["update:modelValue"],setup(l){const k=l,c=Le(l,"modelValue"),o=N(!1),n=W(()=>k.type==="gain"?{min:-15,max:15,step:.1,label:P("settings.dsp.parameter.gain"),unit:"dB",is_log:!1}:k.type==="q"?{min:.1,max:20,step:.1,label:P("settings.dsp.parameter.q_factor"),unit:"",is_log:!1}:k.type==="frequency"?{min:20,max:2e4,step:1,label:P("settings.dsp.parameter.frequency"),unit:"Hz",is_log:!0}:k.type),q=W({get:()=>o.value?c.value.toString():c.value>1e3?c.value.toFixed(0):c.value>100?c.value.toFixed(1):c.value.toFixed(2),set:u=>{c.value=Number(u)}}),O=W({get:()=>n.value.is_log?Math.log10(c.value):c.value,set:u=>{n.value.is_log?c.value=Math.pow(10,u):c.value=u}}),S=W(()=>n.value.is_log?Math.log10(n.value.max):n.value.max),E=W(()=>n.value.is_log?Math.log10(n.value.min):n.value.min),H=W(()=>n.value.is_log?Math.log10(n.value.step):n.value.step);return(u,T)=>(h(),$(te,{flat:"",color:"transparent"},{default:s(()=>[t(le,{class:"d-flex align-center gap-4"},{default:s(()=>[ae("span",wl,I(n.value.label),1),t(kl,{modelValue:O.value,"onUpdate:modelValue":T[0]||(T[0]=R=>O.value=R),min:E.value,max:S.value,step:H.value,"hide-details":"",class:"flex-grow-1 pr-4",density:"compact",color:"primary"},null,8,["modelValue","min","max","step"]),t(Sl,{modelValue:q.value,"onUpdate:modelValue":T[1]||(T[1]=R=>q.value=R),type:"number","hide-details":"",density:"compact",style:{"max-width":"100px"},onFocus:T[2]||(T[2]=R=>o.value=!0),onBlur:T[3]||(T[3]=R=>o.value=!1)},null,8,["modelValue"]),ae("span",Dl,I(n.value.unit),1)]),_:1})]),_:1}))}}),Il={class:"d-flex flex-wrap justify-end align-center ga-2 pr-2"},El={class:"d-flex align-center pl-1"},Rl=re({__name:"DSPParametricEQ",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(l){const k={PK:C.PEAK,PEQ:C.PEAK,HP:C.HIGH_PASS,HPQ:C.HIGH_PASS,LP:C.LOW_PASS,LPQ:C.LOW_PASS,LS:C.LOW_SHELF,HS:C.HIGH_SHELF,NO:C.NOTCH},c={[C.PEAK]:"PK",[C.HIGH_PASS]:"HP",[C.LOW_PASS]:"LP",[C.LOW_SHELF]:"LS",[C.HIGH_SHELF]:"HS",[C.NOTCH]:"NO"},o=Object.entries(F).map(([a,e])=>({title:P(`settings.dsp.channels.${a}`),value:e})),n=a=>{const e=a.split(`
`),i=[];let V=!1,w={},y=F.ALL;for(const r of e)if(r.startsWith("Channel:")){const f=r.match(/Channel:\s*(.+)/);if(f&&f[1]){const p=f[1].trim().toUpperCase();p==="ALL"||p==="1 2"||p==="L R"?y=F.ALL:p==="L"||p==="1"||p==="FL"?(y=F.FL,V=!0):(p==="R"||p==="2"||p==="FR")&&(y=F.FR,V=!0)}w[y]||(w[y]=0)}else if(r.startsWith("Filter")){const f=r.match(/Filter(?:\s+\d+)?:\s+(ON|OFF)\s+(\w+)\s+(?:Fc\s+)?(\d+\.?\d*)\s*(?:Hz)?\s+(?:Gain\s+)?(-?\d+\.?\d*)\s+dB\s+(?:(?:Q\s+)?(\d+\.?\d*)|(?:BW\s+Oct\s+)(\d+\.?\d*))/);if(f){const[p,U,Z,$e,ve,fe,Q]=f;Z!=="None"&&i.push({frequency:parseFloat($e),gain:parseFloat(ve),q:parseFloat(fe),type:k[Z]||C.PEAK,enabled:U==="ON",channel:y})}}else if(r.startsWith("Preamp")){const f=r.match(/Preamp:\s*(-?\d+\.?\d*)\s+dB/);f&&(w[y]=parseFloat(f[1]))}let v;V?v=u.value.bands.filter(r=>!i.some(f=>f.channel===r.channel||f.channel===F.ALL||r.channel===F.ALL)):B.value!==F.ALL?(v=u.value.bands.filter(r=>r.channel!==F.ALL&&r.channel!==B.value),w.ALL&&(w[B.value]=w.ALL,w.ALL=0),i.forEach(r=>{r.channel=B.value})):(v=[],u.value.per_channel_preamp={}),u.value.bands=[...v,...i],Object.keys(w).length>0?(w.ALL&&(u.value.preamp=w.ALL),Object.entries(w).forEach(([r,f])=>{r!==F.ALL&&(u.value.per_channel_preamp[r]=f)})):(u.value.preamp=0,u.value.per_channel_preamp={}),ye(()=>{G.value=-1})},q=a=>{const e=a.target;if(e.files&&e.files[0]){const i=e.files[0],V=new FileReader;V.onload=w=>{var y;(y=w.target)!=null&&y.result&&n(w.target.result)},V.readAsText(i)}},O=N(null),S=()=>{var a;(a=O.value)==null||a.click()},E=()=>{var w;let a="";if(a+=`Preamp: ${ce.value.toFixed(2)} dB
`,g.value){const y=Object.values(F);for(const v of y){if(v===F.ALL)continue;const r=((w=o.find(p=>p.value===v))==null?void 0:w.title)||v;a+=`
# ${r}
`,a+=`Channel: ${v===F.FL?"L":"R"}
`,u.value.per_channel_preamp[v]!==void 0&&(a+=`Preamp: ${u.value.per_channel_preamp[v].toFixed(2)} dB
`);let f=1;u.value.bands.forEach(p=>{if(p.channel===v||p.channel===F.ALL){const U=c[p.type];a+=`Filter ${f++}: ${p.enabled?"ON":"OFF"} ${U} Fc ${p.frequency.toFixed(1)} Hz Gain ${p.gain.toFixed(2)} dB Q ${p.q.toFixed(3)}
`}})}}else u.value.bands.forEach((y,v)=>{const r=c[y.type];a+=`Filter ${v+1}: ${y.enabled?"ON":"OFF"} ${r} Fc ${y.frequency.toFixed(1)} Hz Gain ${y.gain.toFixed(2)} dB Q ${y.q.toFixed(3)}
`});const e=new Blob([a],{type:"text/plain"}),i=URL.createObjectURL(e),V=document.createElement("a");V.href=i,V.download=`music_assistant_eq_settings_${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(V),V.click(),document.body.removeChild(V),URL.revokeObjectURL(i)},H=Be(),u=Le(l,"modelValue"),T=N(null),R=N(null),b=Object.values(C).map(a=>({title:P(`settings.dsp.parametric_eq.filter_types.${a}`),value:a})),D=a=>![C.HIGH_PASS,C.LOW_PASS,C.NOTCH].includes(a),A=N({width:0,height:0,min_gain:-20,max_gain:20,min_freq:20,max_freq:2e4,padding_lr:40,padding_tb:20}),M=()=>{if(!T.value||!R.value)return;const a=H.global.current.value.dark,e=T.value.getContext("2d");if(!e)return;T.value.width=R.value.clientWidth*2,T.value.height=R.value.clientHeight*2,A.value.width=T.value.width/2,A.value.height=T.value.height/2,e.scale(2,2),e.clearRect(0,0,T.value.width,T.value.height),Ke(e,A.value);const i=e.canvas.width/2;e.canvas.height/2;const V=(y,v,r)=>{let f=`hsla(${v*360/u.value.bands.length}, 60%, ${a?70:50}%, 0.5)`;r.beginPath(),v===G.value?(r.lineWidth=5,f=`hsla(${v*360/u.value.bands.length}, 70%, ${a?70:60}%, 1)`):r.lineWidth=2,r.strokeStyle=f;const p=new Float32Array(i);for(let Q=0;Q<i;Q++)p[Q]=Qe(Q,A.value);const U=new Float32Array(i),Z=new Float32Array(i);m(d,y).getFrequencyResponse(p,U,Z);for(let Q=A.value.padding_lr;Q<i-A.value.padding_lr;Q++){const Xe=20*Math.log10(U[Q]),Te=ue(Xe,A.value);Q===A.value.padding_lr?r.moveTo(Q,Te):r.lineTo(Q,Te)}r.stroke();const ve=Fe(y.frequency,A.value),fe=ue(y.gain,A.value);return r.beginPath(),r.fillStyle=f,r.arc(ve,fe,6,0,2*Math.PI),r.fill(),{frequencies:p,magResponse:U}},w=(y,v)=>{v.lineWidth=3,a?v.strokeStyle="#fff":v.strokeStyle="#000",v.beginPath();for(let r=A.value.padding_lr;r<i-A.value.padding_lr;r++){const f=ue(y[r],A.value);r===A.value.padding_lr?v.moveTo(r,f):v.lineTo(r,f)}v.stroke()};if(B.value===F.ALL&&g.value){const y=Object.values(F).filter(r=>r!==F.ALL),v={};y.forEach(r=>{v[r]=new Float32Array(i).fill((u.value.preamp??0)+(u.value.per_channel_preamp[r]??0))}),u.value.bands.forEach((r,f)=>{if(r.enabled){const{magResponse:p}=V(r,f,e);if(r.channel===F.ALL)y.forEach(U=>{for(let Z=0;Z<i;Z++)v[U][Z]+=20*Math.log10(p[Z])});else for(let U=0;U<i;U++)v[r.channel][U]+=20*Math.log10(p[U])}}),y.forEach(r=>{w(v[r],e)})}else{const y=new Float32Array(i).fill((u.value.preamp??0)+(u.value.per_channel_preamp[B.value]??0));u.value.bands.forEach((v,r)=>{if(v.enabled&&v.channel===B.value||v.channel===F.ALL){const{magResponse:f}=V(v,r,e);for(let p=0;p<i;p++)y[p]+=20*Math.log10(f[p])}}),w(y,e)}},m=(a,e)=>{const i=a.createBiquadFilter();switch(e.type){case C.HIGH_PASS:i.type="highpass";break;case C.LOW_PASS:i.type="lowpass";break;case C.HIGH_SHELF:i.type="highshelf";break;case C.LOW_SHELF:i.type="lowshelf";break;case C.NOTCH:i.type="notch";break;case C.PEAK:i.type="peaking";break}return i.frequency.value=e.frequency,i.Q.value=e.q,i.gain.value=e.gain,i},d=new AudioContext;W(()=>u.value.bands.map(a=>m(d,a)));const g=W(()=>u.value.bands.some(a=>a.channel!==F.ALL)||Object.keys(u.value.per_channel_preamp).length>0&&Object.values(u.value.per_channel_preamp).some(a=>a!==0)),ne=N(!1),G=N(-1),B=N(F.ALL),z=W(()=>u.value.bands[G.value]),ce=W({get:()=>u.value.preamp??0,set:a=>{u.value.preamp=a}}),Ae=W({get:()=>u.value.per_channel_preamp[B.value]??0,set:a=>{B.value!==F.ALL&&(u.value.per_channel_preamp[B.value]=a)}}),je=a=>{u.value.bands.splice(a,1),G.value>=u.value.bands.length&&ye(()=>{G.value=u.value.bands.length-1})},Ge=()=>{const a=u.value.bands.length;u.value.bands.push({frequency:1e3,q:1,gain:0,type:C.PEAK,enabled:!0,channel:B.value}),ye(()=>{G.value=a})};J(()=>u.value.preamp,M),J(()=>u.value.per_channel_preamp,M,{deep:!0}),J(()=>(G.value,u.value.bands),()=>{G.value>=u.value.bands.length&&(G.value=u.value.bands.length-1),M()},{deep:!0}),J(()=>B.value,M),J(()=>H.global.current.value.dark,M),vl(()=>{g.value&&(ne.value=!0)}),qe(()=>{M(),window.addEventListener("resize",M)});const Fe=(a,e)=>{const i=Math.log2(a/e.min_freq),V=Math.log2(e.max_freq/e.min_freq);return i/V*(e.width-e.padding_lr*2)+e.padding_lr},Qe=(a,e)=>{const i=Math.log2(e.max_freq/e.min_freq),V=e.min_freq*Math.pow(2,(a-e.padding_lr)/(e.width-e.padding_lr*2)*i);return Math.min(Math.max(V,e.min_freq),e.max_freq)},ue=(a,e)=>e.height/2-a*(e.height-2*e.padding_tb)/(2*Math.max(Math.abs(e.min_gain),Math.abs(e.max_gain))),Ke=(a,e)=>{const i=a.canvas.width/2,V=a.canvas.height/2;H.global.current.value.dark?(a.fillStyle="#eee",a.strokeStyle="#eee"):(a.fillStyle="#222",a.strokeStyle="#666"),a.lineWidth=1,[20,50,100,200,500,1e3,2e3,5e3,1e4,2e4].forEach(f=>{const p=Fe(f,e);a.beginPath(),a.moveTo(p,e.padding_tb),a.lineTo(p,V-e.padding_tb),a.stroke(),a.font="10px Arial",a.textAlign="center",a.fillText(f>=1e3?`${f/1e3}k`:f.toString(),p,V-5)});const v=e.max_gain-e.min_gain,r=Math.ceil(v/(e.height/30));for(let f=e.min_gain;f<=e.max_gain;f+=r){const p=ue(f,e);a.beginPath(),a.moveTo(e.padding_lr,p),a.lineTo(i-e.padding_lr,p),a.stroke(),a.font="10px Arial",a.textAlign="right",a.fillText(`${f}dB`,e.padding_lr-3,p+3)}};return qe(()=>{const a=new ResizeObserver(()=>{M()});return R.value&&a.observe(R.value),()=>{a.disconnect()}}),(a,e)=>(h(),$(ze,{class:"pa-2"},{default:s(()=>[ae("div",Il,[ne.value?(h(),$(me,{key:1,modelValue:B.value,"onUpdate:modelValue":e[1]||(e[1]=i=>B.value=i),class:"pa-2",items:_(o),label:_(P)("settings.dsp.parametric_eq.edited_channel"),variant:"outlined",density:"comfortable",style:{"min-width":"250px"},"hide-details":""},null,8,["modelValue","items","label"])):(h(),$(j,{key:0,variant:"outlined",onClick:e[0]||(e[0]=()=>{ne.value=!0})},{default:s(()=>[t(X,{start:""},{default:s(()=>e[12]||(e[12]=[L("mdi-speaker-multiple")])),_:1}),L(" "+I(_(P)("settings.dsp.parametric_eq.show_multichannel_controls")),1)]),_:1})),t(j,{variant:"outlined",onClick:S},{default:s(()=>[t(X,{start:""},{default:s(()=>e[13]||(e[13]=[L("mdi-file-import")])),_:1}),L(" "+I(_(P)("settings.dsp.parametric_eq.import_apo")),1)]),_:1}),t(j,{variant:"outlined",onClick:E},{default:s(()=>[t(X,{start:""},{default:s(()=>e[14]||(e[14]=[L("mdi-file-export")])),_:1}),L(" "+I(_(P)("settings.dsp.parametric_eq.export_apo")),1)]),_:1}),ae("input",{ref_key:"fileInputRef",ref:O,type:"file",accept:".txt",class:"d-none",onChange:q},null,544)]),t(te,{elevation:"0",color:"transparent"},{default:s(()=>[ae("div",{ref_key:"graphContainer",ref:R,class:"graph-container"},[ae("canvas",{ref_key:"canvas",ref:T,class:"frequency-graph"},null,512)],512)]),_:1}),t(te,{elevation:"0",color:"transparent",class:"border-t border-b rounded-0"},{default:s(()=>[t(le,{class:"pa-0"},{default:s(()=>[t(fl,{modelValue:G.value,"onUpdate:modelValue":e[2]||(e[2]=i=>G.value=i),class:"mb-0 pa-2",mandatory:"","selected-class":"primary"},{default:s(()=>[(h(),$(ge,{key:-1,value:-1,filter:"",variant:"elevated"},{default:s(()=>[L(I(_(P)("settings.dsp.parametric_eq.preamp",{index:100})),1)]),_:1})),(h(!0),oe(pe,null,He(u.value.bands,(i,V)=>(h(),$(ge,{key:V,value:V,class:ie({"opacity-50":!i.enabled}),filter:"",variant:"elevated"},{default:s(()=>[L(I(i.channel===_(F).ALL?_(P)("settings.dsp.parametric_eq.band",{index:V+1}):_(P)("settings.dsp.parametric_eq.band_channel",{index:V+1,channel:_(P)(`settings.dsp.channels_compact.${i.channel}`)})),1)]),_:2},1032,["value","class"]))),128)),t(ge,{variant:"outlined",onClick:Ge},{default:s(()=>[t(X,{icon:"mdi-plus",start:""}),L(" "+I(B.value===_(F).ALL?_(P)("settings.dsp.parametric_eq.add_band"):_(P)("settings.dsp.parametric_eq.add_band_channel",{channel:_(P)(`settings.dsp.channels.${B.value}`)})),1)]),_:1})]),_:1},8,["modelValue"])]),_:1})]),_:1}),G.value===-1?(h(),$(te,{key:0,elevation:"0",color:"transparent"},{default:s(()=>[t(le,null,{default:s(()=>[t(Ue,{dense:""},{default:s(()=>[t(be,{cols:"12"},{default:s(()=>[t(Y,{modelValue:ce.value,"onUpdate:modelValue":e[3]||(e[3]=i=>ce.value=i),type:"gain"},null,8,["modelValue"]),B.value!==_(F).ALL?(h(),$(Y,{key:0,modelValue:Ae.value,"onUpdate:modelValue":e[4]||(e[4]=i=>Ae.value=i),type:{min:-15,max:15,step:.1,label:_(P)("settings.dsp.parametric_eq.per_channel_preamp",{channel:_(P)(`settings.dsp.channels.${B.value}`)}),unit:"dB",is_log:!1}},null,8,["modelValue","type"])):x("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):x("",!0),z.value?(h(),oe(pe,{key:1},[t(gl,null,{default:s(()=>[ae("div",El,[t(he,{modelValue:z.value.enabled,"onUpdate:modelValue":e[5]||(e[5]=i=>z.value.enabled=i),label:_(P)("settings.dsp.parametric_eq.enable_band"),density:"comfortable","hide-details":"",color:"primary"},null,8,["modelValue","label"]),t(Ne),t(j,{color:"error",variant:"tonal",onClick:e[6]||(e[6]=i=>je(G.value))},{default:s(()=>[t(X,null,{default:s(()=>e[15]||(e[15]=[L("mdi-delete")])),_:1}),L(" "+I(_(P)("settings.dsp.parametric_eq.delete_band")),1)]),_:1})])]),_:1}),t(me,{modelValue:z.value.type,"onUpdate:modelValue":e[7]||(e[7]=i=>z.value.type=i),items:_(b),label:_(P)("settings.dsp.parametric_eq.filter_type"),variant:"outlined",density:"comfortable",class:"pa-4","hide-details":""},null,8,["modelValue","items","label"]),t(Y,{modelValue:z.value.frequency,"onUpdate:modelValue":e[8]||(e[8]=i=>z.value.frequency=i),type:"frequency"},null,8,["modelValue"]),D(z.value.type)?(h(),$(Y,{key:0,modelValue:z.value.gain,"onUpdate:modelValue":e[9]||(e[9]=i=>z.value.gain=i),type:"gain"},null,8,["modelValue"])):x("",!0),t(Y,{modelValue:z.value.q,"onUpdate:modelValue":e[10]||(e[10]=i=>z.value.q=i),type:"q"},null,8,["modelValue"]),ne.value?(h(),$(me,{key:1,modelValue:z.value.channel,"onUpdate:modelValue":e[11]||(e[11]=i=>z.value.channel=i),items:_(o),label:_(P)("settings.dsp.parametric_eq.channel"),variant:"outlined",density:"comfortable",class:"pa-4","hide-details":""},null,8,["modelValue","items","label"])):x("",!0)],64)):x("",!0)]),_:1}))}}),Ml=xe(Rl,[["__scopeId","data-v-ac29d681"]]),Bl=re({__name:"DSPToneControl",props:{modelValue:{required:!0},modelModifiers:{}},emits:["update:modelValue"],setup(l){const k=Le(l,"modelValue");return(c,o)=>(h(),oe(pe,null,[t(Y,{modelValue:k.value.bass_level,"onUpdate:modelValue":o[0]||(o[0]=n=>k.value.bass_level=n),type:{min:-10,max:10,step:.1,label:c.$t("settings.dsp.tone_control.bass_level"),unit:"dB",is_log:!1}},null,8,["modelValue","type"]),t(Y,{modelValue:k.value.mid_level,"onUpdate:modelValue":o[1]||(o[1]=n=>k.value.mid_level=n),type:{min:-10,max:10,step:.1,label:c.$t("settings.dsp.tone_control.mid_level"),unit:"dB",is_log:!1}},null,8,["modelValue","type"]),t(Y,{modelValue:k.value.treble_level,"onUpdate:modelValue":o[2]||(o[2]=n=>k.value.treble_level=n),type:{min:-10,max:10,step:.1,label:c.$t("settings.dsp.tone_control.treble_level"),unit:"dB",is_log:!1}},null,8,["modelValue","type"])],64))}}),Hl={key:0},tt=re({__name:"EditPlayerDsp",props:{playerId:{}},setup(l){const{t:k}=yl();Cl();const c=l,o=N(),n=N(null),q=N(!1),O=N(ee.PARAMETRIC_EQ);N(window.innerWidth);const{mobile:S}=_l(),E=Object.values(ee).map(m=>({value:m,title:k(`settings.dsp.types.${m}`)})),H=m=>{n.value=m},u=m=>{var d;return k(m==="input"?"settings.dsp.input":m==="output"?"settings.dsp.output":`settings.dsp.types.${(d=o.value)==null?void 0:d.filters[m].type}`)},T=()=>{if(!o.value)return;let m;switch(O.value){case ee.PARAMETRIC_EQ:m={preamp:0,per_channel_preamp:{},enabled:!0,type:ee.PARAMETRIC_EQ,bands:[]};break;case ee.TONE_CONTROL:m={enabled:!0,type:ee.TONE_CONTROL,bass_level:0,mid_level:0,treble_level:0};break;default:return}o.value.filters.push(m),q.value=!1,H(o.value.filters.length-1)},R=(m,d)=>{if(!o.value)return;const g=d==="up"?m-1:m+1;if(g<0||g>=o.value.filters.length)return;const[ne]=o.value.filters.splice(m,1);o.value.filters.splice(g,0,ne),n.value===m?n.value=g:n.value===g&&(n.value=m)},b=m=>{var d;n.value===m&&(n.value="input"),(d=o.value)==null||d.filters.splice(m,1)};J(S,m=>{!m&&n.value===null&&H("input")},{immediate:!0});const D=W(()=>hl(_e.players[c.playerId],27));J(()=>c.playerId,async m=>{m&&(o.value=await _e.getDSPConfig(m))},{immediate:!0});let A=null;const M=m=>{A&&clearTimeout(A),A=setTimeout(async()=>{c.playerId&&await _e.saveDSPConfig(c.playerId,m)},2e3)};return J(o,(m,d)=>{m!==null&&d&&M(d)},{deep:!0}),(m,d)=>o.value?(h(),oe("section",Hl,[t(Oe,{color:"transparent",class:"border-b"},{default:s(()=>[t(he,{modelValue:o.value.enabled,"onUpdate:modelValue":d[0]||(d[0]=g=>o.value.enabled=g),"hide-details":"",color:"primary",class:"pl-4"},null,8,["modelValue"]),t(we,null,{default:s(()=>[L(I(m.$t("settings.dsp.configure_on",{name:D.value})),1)]),_:1})]),_:1}),t(ze,{class:"pa-4"},{default:s(()=>[o.value.enabled?x("",!0):(h(),$(Al,{key:0,type:"info",class:"mt-4",color:"transparent"},{default:s(()=>[L(I(m.$t("settings.dsp.disabled_message")),1)]),_:1})),t(Ue,{class:ie([{"justify-center":_(S)},"flex-nowrap"])},{default:s(()=>[!_(S)||n.value===null?(h(),$(be,{key:0,class:ie(["flex-grow-0 flex-shrink-0",{"border-e pr-4":!_(S)}]),"align-self":"start"},{default:s(()=>[t(Ol,{dsp:o.value,selected:n.value,onOnSelect:H,onOnAddFilter:d[1]||(d[1]=g=>q.value=!0),onOnMoveFilter:d[2]||(d[2]=g=>R(g.index,g.direction)),onOnDeleteFilter:b},null,8,["dsp","selected"])]),_:1},8,["class"])):x("",!0),n.value!=null?(h(),$(be,{key:1,style:{"min-width":"0"}},{default:s(()=>[t(Oe,{density:"compact",color:m.$vuetify.theme.current.dark?"surface":"surface-light",class:"border-b"},{default:s(()=>[_(S)?(h(),$(j,{key:0,class:"hidden-xs-only",icon:"",onClick:d[3]||(d[3]=g=>n.value=null)},{default:s(()=>[t(X,null,{default:s(()=>d[15]||(d[15]=[L("mdi-arrow-left")])),_:1})]),_:1})):x("",!0),t(we,null,{default:s(()=>[L(I(u(n.value)),1)]),_:1}),typeof n.value=="number"&&!_(S)&&n.value>0?(h(),$(j,{key:1,icon:"",onClick:d[4]||(d[4]=g=>R(n.value,"up"))},{default:s(()=>[t(X,null,{default:s(()=>d[16]||(d[16]=[L("mdi-arrow-up")])),_:1})]),_:1})):x("",!0),typeof n.value=="number"&&!_(S)&&n.value<o.value.filters.length-1?(h(),$(j,{key:2,icon:"",onClick:d[5]||(d[5]=g=>R(n.value,"down"))},{default:s(()=>[t(X,null,{default:s(()=>d[17]||(d[17]=[L("mdi-arrow-down")])),_:1})]),_:1})):x("",!0),typeof n.value=="number"?(h(),$(he,{key:3,modelValue:o.value.filters[n.value].enabled,"onUpdate:modelValue":d[6]||(d[6]=g=>o.value.filters[n.value].enabled=g),"hide-details":"",color:"primary",class:"mr-4"},null,8,["modelValue"])):x("",!0),typeof n.value=="number"?(h(),$(j,{key:4,icon:"",onClick:d[7]||(d[7]=g=>b(n.value))},{default:s(()=>[t(X,null,{default:s(()=>d[18]||(d[18]=[L("mdi-delete")])),_:1})]),_:1})):x("",!0)]),_:1},8,["color"]),n.value==="input"?(h(),$(te,{key:0,flat:"",color:m.$vuetify.theme.current.dark?"surface":"surface-light"},{default:s(()=>[t(Y,{modelValue:o.value.input_gain,"onUpdate:modelValue":d[8]||(d[8]=g=>o.value.input_gain=g),type:"gain"},null,8,["modelValue"])]),_:1},8,["color"])):n.value==="output"?(h(),$(te,{key:1,flat:"",color:m.$vuetify.theme.current.dark?"surface":"surface-light"},{default:s(()=>[t(Y,{modelValue:o.value.output_gain,"onUpdate:modelValue":d[9]||(d[9]=g=>o.value.output_gain=g),type:"gain"},null,8,["modelValue"])]),_:1},8,["color"])):(h(),$(te,{key:2,flat:"",color:m.$vuetify.theme.current.dark?"surface":"surface-light"},{default:s(()=>[o.value.filters[n.value].type===_(ee).PARAMETRIC_EQ?(h(),$(Ml,{key:0,modelValue:o.value.filters[n.value],"onUpdate:modelValue":d[10]||(d[10]=g=>o.value.filters[n.value]=g)},null,8,["modelValue"])):x("",!0),o.value.filters[n.value].type===_(ee).TONE_CONTROL?(h(),$(Bl,{key:1,modelValue:o.value.filters[n.value],"onUpdate:modelValue":d[11]||(d[11]=g=>o.value.filters[n.value]=g)},null,8,["modelValue"])):x("",!0)]),_:1},8,["color"]))]),_:1})):x("",!0)]),_:1},8,["class"])]),_:1}),t(Ll,{modelValue:q.value,"onUpdate:modelValue":d[14]||(d[14]=g=>q.value=g),"max-width":"300"},{default:s(()=>[t(te,null,{default:s(()=>[t(bl,null,{default:s(()=>[L(I(m.$t("settings.dsp.filter.add")),1)]),_:1}),t(le,null,{default:s(()=>[t(me,{modelValue:O.value,"onUpdate:modelValue":d[12]||(d[12]=g=>O.value=g),items:_(E),label:m.$t("settings.dsp.filter.type")},null,8,["modelValue","items","label"])]),_:1}),t(Vl,null,{default:s(()=>[t(Ne),t(j,{onClick:d[13]||(d[13]=g=>q.value=!1)},{default:s(()=>[L(I(m.$t("cancel")),1)]),_:1}),t(j,{color:"primary",onClick:T},{default:s(()=>[L(I(m.$t("settings.dsp.filter.add")),1)]),_:1})]),_:1})]),_:1})]),_:1},8,["modelValue"])])):x("",!0)}});export{tt as default};
