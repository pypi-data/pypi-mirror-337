import{b as ne,a0 as ie,G as v,o as f,c as _,w as p,a as t,f as o,aM as k,q as fe,z as ve,I as J,Y as Ue,a5 as se,aD as Ae,i as ae,F as Re,ak as Ne,J as T,k as Y,e as D,t as E,R,V as ee,U as q,O as $e,N as Ie,S as te}from"./index-Bbkf9DIc.js";import{V as re,r as P}from"./VForm-BCtIZQOE.js";import{a as pe,b as Ve,c as ye}from"./VCard-DLgKmdoO.js";import{V as H,m as Oe,a as ue,e as Pe}from"./VTextField-Djz_9Wz9.js";import{V as be}from"./VSwitch-MOiUeFZQ.js";import{d as ge}from"./forwardRefs-zpUiuLw8.js";import{V as Fe}from"./VSpacer-CPtHAmtO.js";import{g as S,h as De}from"./index-CDn75bM3.js";import{m as Te,a as oe,b as qe,c as je}from"./VChip-DoOT6ijG.js";import{u as ke}from"./tag-BgJ4tZGv.js";import{V as z}from"./VSelect-0_bFDN-s.js";import{V as Ge}from"./VCheckbox-C7p6F9aZ.js";import{_ as de}from"./MenuItems-DQdkh9BG.js";import{V as Be}from"./VToolbar-BMyNQ6K-.js";import{V as Ee}from"./VDataTable-BfFW1vg6.js";import{V as me}from"./VDialog-CLTUldPN.js";import{V as Le}from"./VAutocomplete-BqJxkVxD.js";import{V as ce}from"./VMenu-pbjiSmmM.js";import{V as Me}from"./VTextarea-CCOY15Y4.js";import"./VAvatar-CcSwNzJ2.js";import"./VProgressCircular-o4TPEeLK.js";import"./dimensions-CxFA8Z4w.js";import"./ssrBoot-C8G7_1W2.js";/* empty css              */import"./filter-BVTKTv4O.js";const Je={__name:"FilterSetForm",emits:["close"],setup(V,{emit:U}){const{$gettext:m}=ne(),g=U,i=ie(),l=v({}),h=v(),y=v(!1);function a(){h.value.reset(),l.value={},g("close")}async function A(){const{valid:r}=await h.value.validate();if(r){y.value=!0;try{await k.createFilterSet(l.value),i.displayNotification({msg:m("Filter set created")}),a()}finally{y.value=!1}}}return(r,w)=>(f(),_(ye,{title:o(m)("Create a new filter set")},{default:p(()=>[t(pe,null,{default:p(()=>[t(re,{ref_key:"formRef",ref:h},{default:p(()=>[t(H,{modelValue:l.value.name,"onUpdate:modelValue":w[0]||(w[0]=C=>l.value.name=C),label:o(m)("Name"),variant:"outlined",rules:[o(P).required]},null,8,["modelValue","label","rules"]),t(be,{label:o(m)("Active"),modelValue:l.value.active,"onUpdate:modelValue":w[1]||(w[1]=C=>l.value.active=C),color:"primary"},null,8,["label","modelValue"])]),_:1},512)]),_:1}),t(ge),t(Ve,null,{default:p(()=>[t(Fe),t(S,{text:o(m)("Cancel"),variant:"plain",onClick:a},null,8,["text"]),t(S,{color:"primary",text:o(m)("Create"),onClick:A},null,8,["text"])]),_:1})]),_:1},8,["title"]))}},ze=fe({...Te({falseIcon:"$radioOff",trueIcon:"$radioOn"})},"VRadio"),le=ve()({name:"VRadio",props:ze(),setup(V,U){let{slots:m}=U;return ke(()=>{const g=oe.filterProps(V);return t(oe,J(g,{class:["v-radio",V.class],style:V.style,type:"radio"}),m)}),{}}}),Ye=fe({height:{type:[Number,String],default:"auto"},...Oe(),...Ue(qe(),["multiple"]),trueIcon:{type:se,default:"$radioOn"},falseIcon:{type:se,default:"$radioOff"},type:{type:String,default:"radio"}},"VRadioGroup"),He=ve()({name:"VRadioGroup",inheritAttrs:!1,props:Ye(),emits:{"update:modelValue":V=>!0},setup(V,U){let{attrs:m,slots:g}=U;const i=Ae(),l=ae(()=>V.id||`radio-group-${i}`),h=Re(V,"modelValue");return ke(()=>{const[y,a]=Ne(m),A=ue.filterProps(V),r=oe.filterProps(V),w=g.label?g.label({label:V.label,props:{for:l.value}}):V.label;return t(ue,J({class:["v-radio-group",V.class],style:V.style},y,A,{modelValue:h.value,"onUpdate:modelValue":C=>h.value=C,id:l.value}),{...g,default:C=>{let{id:N,messagesId:I,isDisabled:$,isReadonly:x}=C;return t(T,null,[w&&t(Pe,{id:N.value},{default:()=>[w]}),t(je,J(r,{id:N.value,"aria-describedby":I.value,defaultsTarget:"VRadio",trueIcon:V.trueIcon,falseIcon:V.falseIcon,type:V.type,disabled:$.value,readonly:x.value,"aria-labelledby":w?N.value:void 0,multiple:!1},a,{modelValue:h.value,"onUpdate:modelValue":L=>h.value=L}),g)])}})}),{}}}),Ke={class:"bg-grey-lighten-4 rounded pa-3"},Qe={class:"mt-4 bg-grey-lighten-4 rounded pa-3"},We={class:"mx-2 d-flex flex-column flex-grow-1"},Xe={__name:"FilterForm",props:{filterSet:{type:String,default:null},filter:{type:Object,required:!1,default:null}},emits:["close"],setup(V,{emit:U}){const m=V,g=U,i=ie(),{$gettext:l}=ne(),h=v({}),y=v([]),a=v([]),A=v(),r=v(x()),w=v(!1),C=ae(()=>m.filter?l("Edit filter"):l("New filter")),N=ae(()=>m.filter?l("Update"):l("Create"));let I;Y(()=>m.filter,c=>{c?(r.value=JSON.parse(JSON.stringify(c)),I=c.name):r.value=x()},{immediate:!0});function $(){g("close"),r.value=x()}function x(){return{match_type:"anyof",conditions:[{}],actions:[{args:{}}]}}function L(c){for(const b of y.value)if(b.name===c)return b.operators;return[]}function K(c){for(const b of y.value)if(b.name===r.value.conditions[c].name){for(const s of b.operators)if(s.name===r.value.conditions[c].operator)return s.type==="string"?"text":"number"}}function Q(c){for(const b of a.value)if(b.name===c)return b.args;return[]}function W(){r.value.conditions.push({name:y.value[0].name,operator:y.value[0].operators[0].name})}function M(c){r.value.conditions.splice(c,1)}function O(){r.value.actions.push({name:a.value[0].name,args:{}})}function X(c){r.value.actions.splice(c,1)}async function Z(){const{valid:c}=await A.value.validate();if(!c)return;w.value=!0;let b;const s=JSON.parse(JSON.stringify(r.value));for(const F of s.actions)for(const[d,B]of Object.entries(F.args))typeof B=="boolean"&&!B&&delete F.args[d];try{m.filter?(await k.updateFilter(m.filterSet,I,s),b=l("Filter updated")):(await k.createFilter(m.filterSet,s),b=l("Filter added"))}catch(F){F.response.status===400&&F.response.data&&(h.value=F.response.data);return}finally{w.value=!1}i.displayNotification({msg:b}),$()}return k.getFilterConditionTemplates().then(c=>{y.value=c.data,m.filter||(r.value.conditions[0].name=y.value[0].name,r.value.conditions[0].operator=y.value[0].operators[0].name)}),k.getFilterActionTemplates().then(c=>{a.value=c.data,m.filter||(r.value.actions[0].name=a.value[0].name)}),(c,b)=>(f(),_(ye,{title:C.value},{default:p(()=>[t(pe,null,{default:p(()=>[t(re,{ref_key:"formRef",ref:A},{default:p(()=>[t(H,{modelValue:r.value.name,"onUpdate:modelValue":b[0]||(b[0]=s=>r.value.name=s),label:o(l)("Name"),variant:"outlined",density:"compact",rules:[o(P).required],"error-messages":h.value.name?h.value.name:[]},null,8,["modelValue","label","rules","error-messages"]),D("div",Ke,[D("h4",null,E(o(l)("Conditions")),1),t(He,{modelValue:r.value.match_type,"onUpdate:modelValue":b[1]||(b[1]=s=>r.value.match_type=s),color:"primary",inline:""},{default:p(()=>[t(le,{label:o(l)("All of the following"),value:"allof"},null,8,["label"]),t(le,{label:o(l)("Any of the following"),value:"anyof"},null,8,["label"]),t(le,{label:o(l)("All messages"),value:"all"},null,8,["label"])]),_:1},8,["modelValue"]),r.value.match_type!=="all"?(f(!0),R(T,{key:0},ee(r.value.conditions,(s,F)=>(f(),R("div",{key:`condition-${F}`,class:"d-flex align-start"},[t(z,{modelValue:s.name,"onUpdate:modelValue":d=>s.name=d,label:o(l)("Choose a header"),items:y.value,"item-title":"label","item-value":"name",variant:"outlined",density:"compact",rules:[o(P).required]},null,8,["modelValue","onUpdate:modelValue","label","items","rules"]),t(z,{modelValue:s.operator,"onUpdate:modelValue":d=>s.operator=d,label:o(l)("Choose an operator"),items:L(s.name),"item-title":"label","item-value":"name",variant:"outlined",class:"ml-2",density:"compact",rules:[o(P).required]},null,8,["modelValue","onUpdate:modelValue","label","items","rules"]),t(H,{modelValue:s.value,"onUpdate:modelValue":d=>s.value=d,label:o(l)("Value"),variant:"outlined",class:"ml-2",density:"compact",type:K(F),rules:[o(P).required]},null,8,["modelValue","onUpdate:modelValue","label","type","rules"]),F===0?(f(),_(S,{key:0,icon:"mdi-plus",variant:"text",title:o(l)("Add condition"),color:"primary",onClick:W},null,8,["title"])):(f(),_(S,{key:1,icon:"mdi-trash-can",variant:"text",title:o(l)("Remove condition"),color:"error",onClick:d=>M(F)},null,8,["title","onClick"]))]))),128)):q("",!0)]),D("div",Qe,[D("h4",null,E(o(l)("Actions")),1),(f(!0),R(T,null,ee(r.value.actions,(s,F)=>(f(),R("div",{key:`action-${F}`,class:"d-flex align-start mt-2"},[t(z,{modelValue:s.name,"onUpdate:modelValue":d=>s.name=d,label:o(l)("Choose an action"),items:a.value,"item-title":"label","item-value":"name",variant:"outlined",density:"compact",class:"flex-grow-0"},null,8,["modelValue","onUpdate:modelValue","label","items"]),D("div",We,[(f(!0),R(T,null,ee(Q(s.name),(d,B)=>(f(),R(T,{key:`arg-${F}-${B}`},[d.type==="list"?(f(),_(z,{key:0,modelValue:s.args[d.name],"onUpdate:modelValue":j=>s.args[d.name]=j,items:d.choices,"item-title":"label",density:"compact",variant:"outlined",rules:[o(P).required]},null,8,["modelValue","onUpdate:modelValue","items","rules"])):q("",!0),d.type==="string"?(f(),_(H,{key:1,modelValue:s.args[d.name],"onUpdate:modelValue":j=>s.args[d.name]=j,density:"compact",variant:"outlined",rules:[o(P).required]},null,8,["modelValue","onUpdate:modelValue","rules"])):q("",!0),d.type==="boolean"?(f(),_(Ge,{key:2,modelValue:s.args[d.name],"onUpdate:modelValue":j=>s.args[d.name]=j,label:d.label,color:"primary",value:d.value,density:"compact"},null,8,["modelValue","onUpdate:modelValue","label","value"])):q("",!0)],64))),128))]),F===0?(f(),_(S,{key:0,icon:"mdi-plus",variant:"text",title:o(l)("Add action"),color:"primary",onClick:O},null,8,["title"])):(f(),_(S,{key:1,icon:"mdi-trash-can",variant:"text",title:o(l)("Remove action"),color:"error",onClick:d=>X(F)},null,8,["title","onClick"]))]))),128))])]),_:1},512)]),_:1}),t(ge),t(Ve,null,{default:p(()=>[t(Fe),t(S,{text:o(l)("Cancel"),variant:"elevated",onClick:$},null,8,["text"]),t(S,{color:"primary",variant:"elevated",text:N.value,loading:w.value,onClick:Z},null,8,["text","loading"])]),_:1})]),_:1},8,["title"]))}},Ze={class:"pa-4"},et={class:"text-h6 font-weight-regular mb-4"},tt={key:0,class:"bg-white mt-4 pa-2"},lt={class:"d-flex align-center"},Ut={__name:"FiltersView",setup(V){const U=$e(),m=Ie(),g=ie(),{$gettext:i}=ne(),l=v([]),h=v([]),y=v(""),a=v(),A=v(!1),r=v([]),w=v(),C=v(!1),N=v(!1),I=v(null),$=v(!1),x=v(!1),L=[{title:i("Name"),key:"name"},{title:i("Active"),key:"enabled"},{title:"",key:"filter_actions",align:"end"}];Y(a,e=>{e?(O(e.name),m.params.filterset!==e.name&&U.push({name:"AccountFilters",params:{filterset:e.name}})):U.push({name:"AccountFilters"})}),Y(C,e=>{e?k.downloadFilterSet(a.value.name).then(n=>{y.value=n.data}):O(a.value.name)}),Y(y,()=>{r.value.length&&(r.value=[])});function K(e){let n=e.name;return e.active?n+=" ("+i("active")+")":n+=" ("+i("inactive")+")",n}function Q(){$.value=!1,M()}function W(){x.value=!1,I.value=null,O(a.value.name)}function M(){k.getFilterSets().then(e=>{if(e.data.length>0&&e.data[0].active&&e.data[0].name===null?l.value=e.data.slice(1):l.value=e.data,!a.value&&m.params.filterset){for(const n of l.value)if(n.name===m.params.filterset){a.value=n;break}}})}function O(e){A.value=!0,k.getFilters(e).then(n=>{h.value=n.data,A.value=!1}).catch(n=>{n.response.status===518&&(C.value=!0,g.displayNotification({msg:i("Failed to display template. Using raw mode"),type:"warning"}))})}function X(e){I.value=e,x.value=!0}function Z(e){k.enableFilter(a.value.name,e.name).then(()=>{e.enabled=!0,g.displayNotification({msg:i("Filter enabled")})})}function c(e){k.disableFilter(a.value.name,e.name).then(()=>{e.enabled=!1,g.displayNotification({msg:i("Filter disabled")})})}function b(e){k.deleteFilter(a.value.name,e.name).then(()=>{g.displayNotification({msg:i("Filter removed")}),O(a.value.name)})}async function s(e){await k.moveFilterDown(a.value.name,e.name),O(a.value.name)}async function F(e){await k.moveFilterUp(a.value.name,e.name),O(a.value.name)}async function d(e){await k.activateFilterSet(e.name),g.displayNotification({msg:i("Filter set activated")})}async function B(e){await k.deleteFilterSet(e.name),g.displayNotification({msg:i("Filter set removed")}),a.value=null,M()}async function j(){const{valid:e}=await w.value.validate();if(!e)return;const n={content:y.value};N.value=!0;try{await k.saveFilterSet(a.value.name,n),g.displayNotification({msg:i("Filter set updated")})}catch(u){u.response.status===400&&u.response.data.content&&(r.value=u.response.data.content)}finally{N.value=!1}}async function he(e){const n=await k.downloadFilterSet(e.name),u=new Blob([n.data],{type:"text/plain"}),G=document.createElement("a");G.href=URL.createObjectURL(u),G.download=`${e.name}.txt`,G.click(),URL.revokeObjectURL(G.href)}const we=[{label:i("Edit"),icon:"mdi-circle-edit-outline",onClick:X},{label:i("Delete"),icon:"mdi-delete-outline",onClick:b,color:"red"}];function Ce(e,n){const u=[...we];return e.enabled?u.push({label:i("Disable"),icon:"mdi-stop",color:"red",onClick:c}):u.push({label:i("Enable"),icon:"mdi-check",color:"success",onClick:Z}),n!==h.value.length-1&&u.push({label:i("Move down"),icon:"mdi-arrow-down",onClick:s}),n!==0&&u.push({label:i("Move up"),icon:"mdi-arrow-up",onClick:F}),u}const Se=[{label:i("Download filter set"),icon:"mdi-download",onClick:he},{label:i("Delete filter set"),color:"error",icon:"mdi-trash-can",onClick:B}];function _e(){const e=[];return a.value.active||e.push({label:i("Activate filter set"),color:"success",icon:"mdi-check",onClick:d}),e.concat(Se)}return M(),(e,n)=>(f(),R(T,null,[D("div",Ze,[D("div",et,E(o(i)("Message filters")),1),t(Be,{dense:"",floating:"",color:"white"},{default:p(()=>[t(Le,{modelValue:a.value,"onUpdate:modelValue":n[0]||(n[0]=u=>a.value=u),label:o(i)("Select a filter set"),items:l.value,"item-title":K,"return-object":"",variant:"outlined","hide-details":"",class:"flex-grow-0",style:{width:"200px"},density:"compact"},null,8,["modelValue","label","items"]),t(S,{color:"primary",icon:"mdi-plus",size:"small",class:"mx-4",onClick:n[1]||(n[1]=u=>$.value=!0),title:o(i)("Add filter set")},null,8,["title"]),a.value?(f(),_(ce,{key:0},{activator:p(({props:u})=>[t(S,J({icon:"mdi-dots-vertical"},u,{size:"small",color:"default"}),null,16)]),default:p(()=>[t(de,{items:_e(),obj:a.value},null,8,["items","obj"])]),_:1})):q("",!0),a.value?(f(),_(be,{key:1,modelValue:C.value,"onUpdate:modelValue":n[2]||(n[2]=u=>C.value=u),label:o(i)("Raw mode"),color:"primary",class:"ml-4","hide-details":""},null,8,["modelValue","label"])):q("",!0)]),_:1}),a.value?(f(),R("div",tt,[C.value?(f(),R(T,{key:1},[t(re,{ref_key:"rawFormRef",ref:w},{default:p(()=>[t(Me,{modelValue:y.value,"onUpdate:modelValue":n[4]||(n[4]=u=>y.value=u),variant:"outlined","auto-grow":"",rules:[o(P).required],"error-messages":r.value},null,8,["modelValue","rules","error-messages"])]),_:1},512),t(S,{color:"success",onClick:j,loading:N.value,class:"mt-2"},{default:p(()=>[te(E(o(i)("Save")),1)]),_:1},8,["loading"])],64)):(f(),R(T,{key:0},[D("div",lt,[t(S,{color:"primary",title:o(i)("Add new filter"),onClick:n[3]||(n[3]=u=>x.value=!0),class:"mx-auto"},{default:p(()=>[t(De,{icon:"mdi-plus"}),te(" "+E(o(i)("Add")),1)]),_:1},8,["title"])]),t(Ee,{headers:L,items:h.value,loading:A.value},{"item.enabled":p(({item:u})=>[te(E(e.$yesno(u.enabled)),1)]),"item.filter_actions":p(({index:u,item:G})=>[t(ce,{"offset-y":""},{activator:p(({props:xe})=>[t(S,J({icon:"mdi-dots-horizontal",variant:"text"},xe),null,16)]),default:p(()=>[t(de,{items:Ce(G,u),obj:G},null,8,["items","obj"])]),_:2},1024)]),_:2},1032,["items","loading"])],64))])):q("",!0)]),t(me,{modelValue:$.value,"onUpdate:modelValue":n[5]||(n[5]=u=>$.value=u),"max-width":"600"},{default:p(()=>[t(Je,{onClose:Q})]),_:1},8,["modelValue"]),t(me,{modelValue:x.value,"onUpdate:modelValue":n[6]||(n[6]=u=>x.value=u),"max-width":"800"},{default:p(()=>[a.value?(f(),_(Xe,{key:0,"filter-set":a.value.name,filter:I.value,onClose:W},null,8,["filter-set","filter"])):q("",!0)]),_:1},8,["modelValue"])],64))}};export{Ut as default};
