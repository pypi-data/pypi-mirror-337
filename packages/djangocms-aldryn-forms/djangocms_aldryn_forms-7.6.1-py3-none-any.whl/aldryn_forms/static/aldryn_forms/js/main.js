(()=>{"use strict";function e(e,t){for(const[s,n]of Object.entries(t)){const t=new RegExp(`%\\(${s}\\)s`,"g");e=e.replace(t,n)}return e}function t(e){const t=e.target.closest("form");if(t){for(const e of t.querySelectorAll(".aldryn-forms-required-msg, .aldryn-forms-submit-msg"))e.parentNode.removeChild(e);for(const e of t.querySelectorAll("[type=submit]"))e.disabled=!1,e.readOnly=!1}}function s(e,t){e.target.blur();for(const s of e.target.querySelectorAll("[type=submit]"))if(s.disabled=!0,s.readOnly=!0,t){const t=e.target.closest("form"),n=t&&t.dataset.message_wait?t.dataset.message_wait:gettext("Please wait. Submitting form...");s.insertAdjacentHTML("afterend",'<div class="text-danger aldryn-forms aldryn-forms-submit-msg">'+n+"</div>")}}function n(t){let s=!0;for(const t of this.getElementsByClassName("form-required")){const n=t.querySelectorAll("input[type=checkbox]:checked").length;n<parseInt(t.dataset.required_min)&&(s=!1,t.insertAdjacentHTML("afterend",'<div class="text-danger aldryn-forms aldryn-forms-required-msg">'+e(gettext("You have to choose at least %(value)s options (chosen %(chosen)s)."),{value:t.dataset.required_min,chosen:n})+"</div>"))}if(s)for(const e of this.querySelectorAll("[type=submit]"))e.insertAdjacentHTML("afterend",'<div class="text-danger aldryn-forms aldryn-forms-submit-msg">'+gettext("Please wait. Submitting form...")+"</div>");else{t.preventDefault();for(const e of this.querySelectorAll("[type=submit]"))e.insertAdjacentHTML("afterend",'<div class="text-danger aldryn-forms aldryn-forms-submit-msg">'+gettext("Correct the errors first, please.")+"</div>")}}function o(e,t,s){e.insertAdjacentHTML("afterend",`<ul class="messages aldryn-forms-post-message"><li class="${s}">`+t.join(`</li><li class="${s}">`)+"</ul>")}function r(e,t,s){for(const n of e.querySelectorAll("[type=submit]"))n.insertAdjacentHTML("afterend",`<ul class="messages aldryn-forms-post-message">\n                <li class="${s}">${t}</li>\n            </ul>`)}function l(e){const t=e.parentNode.querySelector("ul.upload-file-names");if(null===t)return;t.innerHTML="",function(e){const t=e.closest("form");for(const e of t.querySelectorAll("[type=submit]"))e.disabled=!1;for(const e of t.getElementsByClassName("aldryn-forms-submit-msg"))e.remove()}(e);const s=e.accept.length?e.accept.split(","):[],n=[],o=[],r=[];let l=!0,a=null;if(null!==e.dataset.max_size){a=0;for(let t=0;t<e.files.length;t++)a+=e.files[t].size}if(null!==e.dataset.max_size&&a>e.dataset.max_size){l=!1;const e=document.createElement("li");e.classList.add("text-danger"),e.appendChild(document.createTextNode(gettext("The total file size has exceeded the specified limit."))),t.appendChild(e)}if(e.accept.length)for(let e=0;e<s.length;e++)if("."===s[e][0])n.push(s[e]);else{const t=s[e].split("/");"*"===t[1]?r.push(t[0]):o.push(s[e])}for(let a=0;a<e.files.length;a++){const i=document.createElement("li"),c=e.files[a].name,d=document.createElement("span");d.appendChild(document.createTextNode(c+" ")),i.appendChild(d);const f=[];a>=e.dataset.max_files&&f.push(gettext("This file exceeds the uploaded files limit."));let m=!s.length;if(!m&&n){const e=c.toLowerCase().match(/\.\w+$/);null!==e&&n.includes(e[0])&&(m=!0)}if(!m&&o&&o.includes(e.files[a].type)&&(m=!0),!m&&r){const t=e.files[a].type.split("/");r.includes(t[0])&&(m=!0)}if(m||f.push(gettext("The file type is not among the accpeted types.")),f.length){l=!1,d.title=f.join(" "),d.classList.add("fail-upload");const e=document.createElement("img");e.src="/static/admin/img/icon-alert.svg",e.width=16,e.height=16,d.insertBefore(e,d.firstChild)}t.appendChild(i)}l||function(e){const t=e.closest("form");for(const e of t.querySelectorAll("[type=submit]"))e.disabled=!0,e.insertAdjacentHTML("afterend",'<div class="text-danger aldryn-forms aldryn-forms-submit-msg">'+gettext("Correct the errors first, please.")+"</div>")}(e)}async function a(e){!function(e){for(const t of e.querySelectorAll(".aldryn-forms-post-message"))t.remove()}(e);const t=new FormData(e);try{const s=await fetch(e.action,{method:"POST",body:t,headers:{"X-Requested-With":"XMLHttpRequest"}}),n=await s.json();if(console.log(n),"ERROR"===n.status)for(const t in n.form)if("__all__"===t){const s=e.querySelector("[type=submit]");s?o(s,n.form[t],"error"):r(e,n.form[t],"error")}else{const s=e.querySelector(`input[name="${t}"]`);s&&o(s,n.form[t],"error")}else e.dataset.run_next?document[e.dataset.run_next](e,n):r(e,n.message,"success")}catch(t){r(e,t,"error")}finally{!function(e){for(const t of e.querySelectorAll("[type=submit]"))t.disabled=!1,t.readOnly=!1;for(const t of e.querySelectorAll(".aldryn-forms-submit-msg"))t.remove()}(e)}}"function"!=typeof gettext&&(window.gettext=e=>e),document.addEventListener("DOMContentLoaded",(()=>{for(const e of document.getElementsByTagName("form"))if(e.getAttribute("novalidate"))e.classList.contains("skip-disable-submit")||e.addEventListener("submit",(e=>s(e,!0)));else if(e.classList.contains("skip-disable-submit")||e.addEventListener("submit",(e=>s(e,!1))),!e.getAttribute("novalidate-checkbox-groups")){e.addEventListener("submit",n);for(const s of e.querySelectorAll(".form-required input[type=checkbox]"))s.addEventListener("click",t)}!function(){for(const e of document.querySelectorAll("input[type=file]"))if(void 0!==e.dataset.enable_js){const t=document.createElement("div");t.classList.add("upload-file-frame"),e.parentNode.insertBefore(t,e),e.parentElement.removeChild(e),t.appendChild(e);const s=document.createElement("ul");s.classList.add("upload-file-names"),t.appendChild(s),e.addEventListener("change",(e=>l(e.target)),!1),l(e)}}(),function(){for(const e of document.querySelectorAll("form.submit-by-fetch"))e.addEventListener("submit",(t=>{t.preventDefault(),a(e)}))}()})),document.AldrynFormsSendData=a})();
//# sourceMappingURL=main.js.map