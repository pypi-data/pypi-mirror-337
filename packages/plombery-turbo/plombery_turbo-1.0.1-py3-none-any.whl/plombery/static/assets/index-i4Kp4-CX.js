const __vite__mapDeps=(i,m=__vite__mapDeps,d=(m.f||(m.f=["assets/HandsonTable-BRdkCBfa.js","assets/vendor-CXhV_CSN.js","assets/HandsonTable-CeXsD9Sv.css","assets/main-CTQXcDgT.js"])))=>i.map(i=>d[i]);
var cs=Object.defineProperty;var ds=(s,t,r)=>t in s?cs(s,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[t]=r;var ne=(s,t,r)=>ds(s,typeof t!="symbol"?t+"":t,r);import{k as Ie,r as d,j as e,u as He,a as us,F as ms,b as xs,c as hs,d as gs,e as js,o as ps,f as fs,s as bs,g as ys,h as vs,i as Ns,l as ws,m as h,n as w,p as Q,q as N,t as ks,v as R,w as y,x as J,y as S,z as _s,A as l,B as M,C as Ts,D as Ve,E as Ue,G as q,H as Ss,I as Rs,J as Es,K as $s,L as ae,_ as ie,M as P,N as A,O as L,P as qe,Q as Cs,R as Ps,S as Ls,T as Fs,U as W,V as ze,W as oe,X as I,Y as D,Z as xe,$ as Ds,a0 as Os,a1 as Ge,a2 as H,a3 as Ms,a4 as As,a5 as Be,a6 as Is,a7 as Hs,a8 as Ke,a9 as C,aa as v,ab as X,ac as Y,ad as he,ae as ge,af as je,ag as _,ah as pe,ai as Vs,aj as Us,ak as qs,al as zs,am as Gs,an as Bs,ao as Ks,ap as Qs,aq as Js,ar as Ws,as as Xs,at as fe,au as Ys,av as $e,aw as Ce,ax as Zs,ay as be,az as Qe,aA as et,aB as st,aC as tt,aD as rt,aE as nt,aF as at,aG as it,aH as ot,aI as lt,aJ as ct,aK as dt,aL as ut,aM as mt}from"./vendor-CXhV_CSN.js";(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const a of document.querySelectorAll('link[rel="modulepreload"]'))n(a);new MutationObserver(a=>{for(const i of a)if(i.type==="childList")for(const u of i.addedNodes)u.tagName==="LINK"&&u.rel==="modulepreload"&&n(u)}).observe(document,{childList:!0,subtree:!0});function r(a){const i={};return a.integrity&&(i.integrity=a.integrity),a.referrerPolicy&&(i.referrerPolicy=a.referrerPolicy),a.crossOrigin==="use-credentials"?i.credentials="include":a.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function n(a){if(a.ep)return;a.ep=!0;const i=r(a);fetch(a.href,i)}})();class le{constructor(t,r,n,a,i){this.id=t,this.name=r,this.description=n,this.tasks=a,this.triggers=i}hasTrigger(){return this.triggers.some(t=>!!t.schedule)}getNextFireTime(){const r=this.triggers.filter(n=>!!n.next_fire_time).sort((n,a)=>n.next_fire_time.getTime()-a.next_fire_time.getTime())[0];if(r)return r.next_fire_time}}var xt={BASE_URL:"/",DEV:!1,MODE:"production",PROD:!0,SSR:!1};class ht extends Error{constructor(r,n,a){super(r);ne(this,"data");ne(this,"status");this.data={data:a,status:n},this.status=n}}const gt=`${window.location.protocol}//${window.location.host}/api`,Z=xt.VITE_API_BASE_URL||gt,ye=Ie.create({prefixUrl:Z,credentials:"include",redirect:"follow"}),ve=()=>Z,F=async(s,t)=>(await ye.get(s,t)).json(),Je=async(s,t)=>{try{return await ye.post(s,t).json()}catch(r){const n=r;throw new ht(n.message,n.response.status,await n.response.json())}},jt=()=>{const s=new URL(Z);return s.pathname=s.pathname.replace(/api$/,""),s},Pe=s=>`${Z}/pipelines/${s}/run`,pt=async()=>await F("auth/whoami"),ft=async()=>{await Je("auth/logout")},bt=()=>({queryKey:["pipelines"],queryFn:async()=>{const s=await F("pipelines/");return s.forEach(t=>{t.triggers.forEach(r=>{r.next_fire_time&&(r.next_fire_time=new Date(r.next_fire_time))})}),s.map(t=>new le(t.id,t.name,t.description,t.tasks,t.triggers))},initialData:[]}),Ne=s=>({queryKey:["pipeline",s],queryFn:async()=>{const t=await F(`pipelines/${s}`);return t.triggers.forEach(r=>{r.next_fire_time&&(r.next_fire_time=new Date(r.next_fire_time))}),new le(t.id,t.name,t.description,t.tasks,t.triggers)},initialData:new le("","","",[],[]),enabled:!!s}),yt=s=>({queryKey:["pipeline-input",s],queryFn:async()=>await F(`pipelines/${s}/input-schema`)}),we=(s,t)=>({queryKey:["runs",s,t],queryFn:async()=>{const n=await F("runs/",{searchParams:{pipeline_id:s??"",trigger_id:t??""}});return n.forEach(a=>{a.start_time=new Date(a.start_time)}),n},initialData:[]}),Le=(s,t,r)=>({queryKey:["runs",s,t,r],queryFn:async()=>{const n=await F(`runs/${r}`);return n.start_time=new Date(n.start_time),n},enabled:!!(s&&t&&r)}),vt=s=>({queryKey:["logs",s],queryFn:async()=>{const t=await ye.get(`runs/${s}/logs`).text();return t?t.split(`
`).map((r,n)=>{const a=JSON.parse(r);return a.id=n,a.timestamp=new Date(a.timestamp),a}):[]},enabled:!!s,initialData:[]}),We=(s,t)=>`runs/${s}/data/${t}`,Nt=(s,t)=>({queryKey:["getRunData",{runId:s,taskId:t}],queryFn:async()=>await F(We(s,t))}),Xe=(s,t)=>({async mutationFn(r){return await Je(`pipelines/${s}/run`,{json:{trigger_id:t,params:r}})}}),wt=()=>({queryKey:["gh","latest-release"],queryFn:async()=>await Ie.get("https://api.github.com/repos/lucafaggianelli/plombery/releases/latest").json()}),Ye=d.createContext({isAuthenticated:!1,isAuthenticationEnabled:!0,isLoading:!0,logout:async()=>{},user:null}),kt=(s,t)=>{switch(t.type){case"LOGIN":return{...s,isAuthenticated:!0,isAuthenticationEnabled:t.payload.isAuthenticationEnabled,user:t.payload.user};case"LOGOUT":return{...s,isAuthenticated:!1,user:null};case"POPULATE":return{...s,user:t.payload?{...s.user,...t.payload}:null};case"STOP_LOADING":return{...s,isLoading:!1};default:throw new Error("Unknown action type")}},_t=({children:s})=>{const[t,r]=d.useReducer(kt,{isAuthenticated:!1,isAuthenticationEnabled:!0,isLoading:!0,logout:async()=>{await ft(),r({type:"LOGOUT"})},user:null});return d.useEffect(()=>{(async()=>{try{const{is_authentication_enabled:a,user:i}=await pt();(a&&i||!a)&&r({type:"LOGIN",payload:{user:i,isAuthenticationEnabled:a}})}catch(a){console.error(a)}finally{r({type:"STOP_LOADING"})}})()},[]),e.jsx(Ye.Provider,{value:t,children:t.isAuthenticationEnabled&&t.isLoading?"Loading...":s})},ke=()=>d.useContext(Ye),Tt=s=>`translate${s==="bottom"||s==="top"?"Y":"X"}(${s==="bottom"||s==="right"?"-":"+"}10%)`;function St({initialOpen:s=!1,placement:t="bottom",modal:r,open:n,onOpenChange:a}={}){const[i,u]=d.useState(s),[c,g]=d.useState(),[o,x]=d.useState(),p=n??i,T=a??u,k=gs({placement:t,open:p,onOpenChange:T,whileElementsMounted:js,middleware:[ps(5),fs({fallbackAxisSideDirection:"end"}),bs({padding:5})]}),f=k.context,m=ys(f,{enabled:n==null}),j=vs(f),b=Ns(f),$=ws([m,j,b]);return d.useMemo(()=>({open:p,setOpen:T,...$,...k,modal:r,labelId:c,descriptionId:o,setLabelId:g,setDescriptionId:x}),[p,T,$,k,r,c,o])}const Ze=d.createContext(null),ee=()=>{const s=d.useContext(Ze);if(s==null)throw new Error("Popover components must be wrapped in <Popover />");return s};function Rt({children:s,modal:t=!0,...r}){const n=St({modal:t,...r});return e.jsx(Ze.Provider,{value:n,children:s})}const Et=d.forwardRef(function({children:t,asChild:r=!1,...n},a){const i=ee(),u=t.ref,c=He([i.refs.setReference,a,u]);return r&&d.isValidElement(t)?d.cloneElement(t,i.getReferenceProps({ref:c,...n,...t.props,"data-state":i.open?"open":"closed"})):e.jsx("button",{ref:c,type:"button","data-state":i.open?"open":"closed",...i.getReferenceProps(n),children:t})}),$t=d.forwardRef(function(t,r){const{context:n,...a}=ee(),i=He([a.refs.setFloating,r]),{isMounted:u,styles:c}=us(n,{initial:({side:g})=>({opacity:0,transform:Tt(g)})});return e.jsx(ms,{children:u&&e.jsx(xs,{context:n,modal:a.modal,children:e.jsx("div",{ref:i,style:{position:a.strategy,top:a.y??0,left:a.x??0,width:"max-content",zIndex:20,...t.style,...c},"aria-labelledby":a.labelId,"aria-describedby":a.descriptionId,...a.getFloatingProps(t),children:t.children})})})});d.forwardRef(function({children:t,...r},n){const{setDescriptionId:a}=ee(),i=hs();return d.useLayoutEffect(()=>(a(i),()=>a(void 0)),[i,a]),e.jsx("p",{...r,ref:n,id:i,children:t})});d.forwardRef(function(t,r){const{setOpen:n}=ee();return e.jsx("button",{type:"button",ref:r,...t,onClick:a=>{var i;(i=t.onClick)==null||i.call(t,a),n(!1)}})});const Ct=()=>{const{logout:s,user:t}=ke();return t?e.jsxs(h,{className:"gap-4 mt-8",children:[e.jsxs("div",{children:[e.jsx(w,{children:t.name}),e.jsx(Q,{children:t.email})]}),e.jsx(N,{size:"xs",variant:"secondary",color:"rose",icon:ks,onClick:async()=>await s()})]}):e.jsx("div",{children:"Not authenticated"})},Fe="0.4.1",es=0,ce=1,De=2,Pt={[es]:"light",[ce]:"dark"},U="plomberyTheme",Lt=()=>{const s=localStorage[U]==="dark"?ce:U in localStorage?es:De,[t,r]=d.useState(s);return e.jsx(Ve,{onIndexChange:n=>{let a=!1;return n===De?(localStorage.removeItem(U),a=window.matchMedia("(prefers-color-scheme: dark)").matches):(a=n===ce,localStorage[U]=Pt[n]),a?document.documentElement.classList.add("dark"):document.documentElement.classList.remove("dark"),r(n)},index:t,children:e.jsxs(Ue,{variant:"solid",children:[e.jsx(q,{icon:Ss,children:"Light"}),e.jsx(q,{icon:Rs,children:"Dark"}),e.jsx(q,{icon:Es,children:"System"})]})})},Ft=(s,t)=>{const r=s.replace(/^v/,"").split(".").map(Number),n=t.replace(/^v/,"").split(".").map(Number);for(let a=0;a<r.length;a++){if(r[a]>n[a])return!0;if(r[a]<n[a])return!1}return!1},Dt=()=>{var c;const[s,t]=d.useState(!1),{user:r,isAuthenticationEnabled:n}=ke(),a=R({...wt(),enabled:s});let i=e.jsx($s,{});if(n&&r){const g=r.name.split(" ");i=g.length>1?`${g.at(0)[0]}${g.at(-1)[0]}`:g[0]}const u=a.isSuccess?Ft(Fe,a.data.tag_name):!1;return e.jsxs(Rt,{placement:"bottom-start",open:s,onOpenChange:t,children:[e.jsx(Et,{onClick:()=>t(!0),children:e.jsx("div",{className:"flex justify-center items-center font-medium dark:bg-dark-tremor-background dark:ring-dark-tremor-ring ring-1 ring-slate-300 text-indigo-500 rounded-full hover:ring-2 hover:ring-indigo-400 dark:hover:ring-indigo-700 transition-shadow",style:{width:34,height:34},children:i})}),e.jsx($t,{children:e.jsxs(y,{className:"p-0 pt-4 shadow-xl z-20",children:[e.jsxs(J,{children:[e.jsxs("a",{className:"flex items-center px-6 py-2 hover:bg-tremor-brand-faint hover:dark:bg-dark-tremor-brand-faint transition-colors no-underline",href:ve().replace(/\/api$/,"/docs"),target:"_blank",rel:"noopener noreferrer",children:[e.jsx(S,{icon:_s,color:"slate",className:"mr-3"}),e.jsx(l,{className:"flex-grow no-underline border-0",children:"REST API docs"}),e.jsx(S,{icon:M,color:"slate"})]}),e.jsxs("a",{className:"flex items-center px-6 py-2 hover:bg-tremor-brand-faint hover:dark:bg-dark-tremor-brand-faint transition-colors no-underline",href:"https://github.com/lucafaggianelli/plombery",target:"_blank",rel:"noopener noreferrer",children:[e.jsx(S,{icon:Ts,color:"slate",className:"mr-3"}),e.jsx(l,{className:"flex-grow no-underline border-0",children:"GitHub"}),e.jsx(S,{icon:M,color:"slate"})]})]}),e.jsxs("div",{className:"p-6",children:[e.jsx(Lt,{}),n&&e.jsx(Ct,{})]}),e.jsxs("div",{className:"px-6 pb-3 text-center text-tremor-content-subtle dark:text-dark-tremor-content-subtle text-sm",children:["Plombery v",Fe," ",u&&e.jsxs("span",{className:"text-xs text-amber-600",children:["(v",(c=a.data)==null?void 0:c.tag_name," available)"]})]})]})})]})},se=({children:s,header:t})=>e.jsxs("div",{className:"bg-slate-100 dark:bg-slate-950 p-6 sm:p-10 min-h-screen",children:[e.jsxs(h,{className:"items-start gap-4 md:gap-8",children:[t&&e.jsx("div",{className:"flex-grow max-w-full",children:t}),e.jsx(Dt,{})]}),e.jsx("main",{children:s})]}),V=({children:s,footer:t,isOpen:r,subtitle:n,title:a,onClose:i})=>e.jsx(ae,{show:r,as:d.Fragment,children:e.jsxs(ie,{onClose:i,className:"relative z-50",children:[e.jsx(ae.Child,{as:d.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0",enterTo:"opacity-100",leave:"ease-in duration-200",leaveFrom:"opacity-100",leaveTo:"opacity-0",children:e.jsx("div",{className:"fixed inset-0 bg-black/30 dark:bg-black/50 backdrop-blur-sm","aria-hidden":"true"})}),e.jsx("div",{className:"fixed inset-0 flex w-screen items-center justify-center p-12",children:e.jsx(ae.Child,{as:d.Fragment,enter:"ease-out duration-300",enterFrom:"opacity-0 translate-y-1/3",enterTo:"opacity-100 translate-y-0",leave:"ease-in duration-300",leaveFrom:"opacity-100 translate-y-0",leaveTo:"opacity-0 -translate-y-1/3",children:e.jsx(ie.Panel,{className:"max-w-full",children:e.jsxs(y,{children:[a&&e.jsx(ie.Title,{children:e.jsx(w,{children:a})}),n&&e.jsx(Q,{children:n}),e.jsx("div",{className:(a||n)&&"mt-6",children:s}),t&&e.jsx(h,{className:"justify-end space-x-6 mt-6",children:t})]})})})})]})}),Ot=({label:s,...t})=>{const r=d.createRef();return e.jsxs("div",{children:[e.jsx("input",{type:"range",onInput:n=>r.current&&(r.current.value=n.target.value),className:"w-full cursor-ew-resize appearance-none accent-indigo-500 h-2 bg-tremor-background border border-tremor-border dark:border-dark-tremor-border dark:bg-dark-tremor-background rounded",...t}),e.jsxs(P,{numItems:3,className:"items-baseline",children:[e.jsx(A,{children:e.jsxs("div",{className:"ml-1 inline-block",children:[e.jsx("div",{className:"border-r border-slate-300 dark:border-slate-600 h-2 mx-auto",style:{width:1}}),e.jsx(l,{children:t.min})]})}),e.jsx(h,{className:"justify-center",children:e.jsx(l,{children:e.jsx(L,{children:e.jsx("output",{ref:r,className:"px-2 py-1 rounded bg-tremor-background-subtle dark:bg-dark-tremor-background-subtle block truncate text-center",children:t.defaultValue})})})}),e.jsx(h,{className:"justify-end",children:e.jsxs("div",{className:"mr-1",children:[e.jsx("div",{className:"border-r border-slate-300 dark:border-slate-600 h-2 mx-auto",style:{width:1}}),e.jsx(l,{children:t.max})]})})]})]})},Mt={checkbox:s=>e.jsxs("div",{className:"flex items-center mb-4",children:[e.jsx("input",{id:`${s.name}_hidden`,name:s.name,type:"hidden",checked:!0,readOnly:!0,value:"false"}),e.jsx("input",{id:s.name,name:s.name,type:"checkbox",defaultChecked:s.defaultValue==="true",className:"w-4 h-4 accent-indigo-500 bg-tremor-background rounded dark:bg-dark-tremor-background cursor-pointer"}),e.jsx("label",{htmlFor:s.name,className:"pl-2 cursor-pointer",children:e.jsx(l,{children:s.label})})]}),number:s=>{const t=s.value.minimum??s.value.exclusiveMinimum,r=s.value.maximum??s.value.exclusiveMaximum;return e.jsx(Cs,{name:s.name,min:t,max:r,defaultValue:s.defaultValue,required:s.required})},range:s=>{const t=s.value.minimum??s.value.exclusiveMinimum??0,r=s.value.maximum??s.value.exclusiveMaximum??0,n=s.type==="number"?(r-t)/10:1;return e.jsx(Ot,{name:s.name,label:s.label,min:t,max:r,step:n,defaultValue:s.defaultValue,required:s.required})},select:s=>{const[t,r]=d.useState(s.defaultValue||"");return e.jsxs("div",{children:[e.jsx(Ps,{defaultValue:s.defaultValue,onValueChange:r,value:t,children:s.value.enum.map(n=>e.jsx(Ls,{value:n.toString(),children:n==null?void 0:n.toString()},n==null?void 0:n.toString()))}),e.jsx("input",{type:"hidden",name:s.name,value:t})]})},text:s=>{const t=s.value.format==="password"?"password":"text";return e.jsx(Fs,{type:t,name:s.name,placeholder:s.label,defaultValue:s.defaultValue})}},At=s=>{let t="text";if(s.type==="number"||s.type==="integer"){const r=s.value.minimum??s.value.exclusiveMinimum,n=s.value.maximum??s.value.exclusiveMaximum;r!==void 0&&n!==void 0?t="range":t="number"}else s.type==="enum"?t="select":s.type==="boolean"&&(t="checkbox");return Mt[t](s)},It=({errors:s={},schema:t})=>{const r=d.useCallback(i=>{const u=t.definitions||t.$defs;if(!u)return;const c=i.split("/").pop();return u[c]},[t]),n=t.properties;if(!n)return e.jsx(l,{className:"mt-4",children:"This pipeline has no input parameters, but you can still run it!"});const a=Object.entries(n).map(([i,u])=>{var k,f,m;if(typeof u=="boolean")return;let c=u,g;const o=c.title||i;if(u.allOf){const j=u.allOf[0];if(g=(k=u.default)==null?void 0:k.toString(),j.$ref){const b=r(j.$ref);b&&(c=b)}}else if(u.$ref){const j=r(u.$ref);j&&(c=j)}else g=(f=c.default)==null?void 0:f.toString();const x=(c.enum?"enum":Array.isArray(c.type)?c.type[0]:c.type)||"string",p=((m=t.required)==null?void 0:m.includes(i))??!1,T=At({defaultValue:g,label:o,name:i,required:p,type:x,value:c});return e.jsxs("div",{children:[e.jsxs(h,{className:"justify-between",children:[e.jsxs(l,{className:"mb-2",children:[o,p&&" *"]}),c.description&&e.jsx(S,{icon:qe,tooltip:c.description,color:"neutral"})]}),T,s[i]&&e.jsx(l,{color:"rose",className:"mt-1",children:s[i]})]},i)});return e.jsx(h,{className:"gap-4 flex-col items-stretch",children:a})},_e=({pipeline:s})=>{var g;const[t,r]=d.useState(!1),n=W(),a=R({...yt(s.id),enabled:t}),i=ze(Xe(s.id)),u=i.isError&&i.error.status===422?Object.fromEntries(i.error.data.data.detail.map(o=>[o.loc.join("."),o.msg])):void 0,c=(g=i.error)==null?void 0:g.message;return e.jsxs(e.Fragment,{children:[e.jsx(N,{color:"indigo",variant:"secondary",size:"xs",icon:oe,onClick:()=>r(!0),children:"Run"}),e.jsx(V,{isOpen:t,title:`Run ${s.name} manually`,onClose:()=>r(!1),children:e.jsxs("form",{onSubmit:async o=>{o.preventDefault();const x=Object.fromEntries(new FormData(o.target).entries());try{const p=await i.mutateAsync(x);n(`/pipelines/${p.pipeline_id}/triggers/${p.trigger_id}/runs/${p.id}`),r(!1)}catch(p){console.error(p)}},children:[a.isPending||a.isFetching?"Loading...":a.isError?"Error":e.jsxs("div",{style:{width:350},children:[e.jsx(It,{schema:a.data,errors:u}),c&&e.jsx(l,{className:"mt-2",color:"rose",children:c})]}),e.jsxs(h,{className:"justify-end space-x-6 mt-6",children:[e.jsx(N,{type:"button",variant:"secondary",color:"indigo",onClick:()=>{r(!1)},disabled:i.isPending,children:"Close"}),e.jsx(N,{color:"indigo",type:"submit",icon:oe,disabled:i.isPending,children:"Run"})]})]})})]})},Ht=()=>{const s=R(bt());if(s.isPending)return e.jsx("div",{children:"Loading..."});if(s.isError)return e.jsx("div",{children:"An error has occurred"});const t=s.data;return e.jsxs(y,{children:[e.jsx(w,{children:"Pipelines"}),e.jsxs(J,{children:[t.map(r=>{var n;return e.jsxs(I,{className:"gap-x-1",children:[e.jsxs("div",{className:"min-w-0",children:[e.jsx(l,{className:"truncate",children:e.jsx(L,{children:e.jsx(D,{to:`/pipelines/${r.id}`,children:r.name})})}),r.description&&e.jsx(l,{className:"truncate",children:r.description})]}),r.hasTrigger()&&e.jsxs("div",{className:"min-w-0",title:(n=r.getNextFireTime())==null?void 0:n.toString(),children:[e.jsx(l,{className:"truncate",children:"Next fire time"}),e.jsx(l,{className:"truncate",children:e.jsx(L,{children:xe(r.getNextFireTime(),{addSuffix:!0,includeSeconds:!0})})})]}),e.jsx(_e,{pipeline:r})]},r.id)}),t.length===0&&e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{className:"text-center italic",children:"There are no pipelines, you can't do much."}),e.jsx("div",{className:"text-center mt-2 text-sm",children:e.jsxs("a",{href:"https://lucafaggianelli.github.io/plombery/pipelines/",target:"_blank",className:"inline-flex items-center gap-2 bg-indigo-50/30 hover:bg-indigo-50 dark:bg-indigo-950/50 dark:hover:bg-indigo-950 rounded-sm px-4 py-2 text-indigo-500 transition-colors duration-300 cursor-pointer no-underline",rel:"noopener noreferrer",children:["How to create pipelines",e.jsx(S,{icon:M,size:"sm",className:"p-0",color:"indigo"})]})})]})]})]})},E=Ds(jt().toString(),{transports:["websocket"],path:"/ws/socket.io"}),Vt=()=>e.jsx("div",{className:"tremor-Badge-icon -ml-1 mr-1.5 h-4 w-4 animate-spin",children:e.jsx(Os,{})}),z={pending:"slate",completed:"emerald",failed:"rose",cancelled:"slate",running:"blue",warning:"amber"},de={pending:Ms,completed:As,failed:Be,cancelled:Is,running:Vt,warning:Hs},ue=["cyan","violet","pink","emerald","orange","stone","fuchsia"],ss=s=>Object.fromEntries(s.map((t,r)=>[t.id,`bg-${ue[r%ue.length]}-500`])),G=(s,t=!1)=>{if(t){const r=Ge(s,s.getTimezoneOffset());return H(r,"d MMM yyyy HH:mm:ss")+" (UTC)"}else return H(s,"d MMM yyyy HH:mm:ss (XXX)")},B=(s,t=!1)=>{if(t){const r=Ge(s,s.getTimezoneOffset());return H(r,"HH:mm:ss.SSS")+" (UTC)"}else return H(s,"HH:mm:ss.SSS")},Oe=s=>H(s,"d MMM yyyy"),Ut=new Intl.NumberFormat,qt=s=>Ut.format(s),ts=({status:s})=>e.jsx(Ke,{color:z[s],icon:de[s],children:s}),rs=({startTime:s})=>{const[t,r]=d.useState(Date.now()-s.getTime());return d.useEffect(()=>{const n=setInterval(()=>{r(Date.now()-s.getTime())},500);return()=>{clearInterval(n)}}),e.jsx("span",{children:(t/1e3).toFixed(2)})},Te=({query:s})=>s.isError?e.jsxs(e.Fragment,{children:[e.jsxs(h,{justifyContent:"start",children:[e.jsx(S,{icon:Be,color:"rose",className:"pl-0"}),e.jsx(w,{children:"Error fetching data"})]}),e.jsx(l,{children:s.error.message}),e.jsx(h,{justifyContent:"center",className:"mt-4",children:e.jsx(N,{color:"rose",variant:"light",size:"xs",onClick:()=>s.refetch(),children:"Retry"})})]}):null,te="animate-pulse rounded",re="bg-slate-200 dark:bg-slate-700",zt=({className:s})=>e.jsx("div",{className:X("h-10",te,re,s)}),Gt=({className:s})=>e.jsx("div",{className:X("h-28",te,re,s)}),me=({className:s})=>e.jsx(l,{className:X(te,re,s),children:" "}),ns=({className:s})=>e.jsx(Y,{className:X("w-24",te,re,s),children:" "}),Bt=({columns:s=6,rows:t=10})=>new Array(t).fill(1).map((r,n)=>e.jsx(C,{className:"animate-pulse",children:new Array(s).fill(1).map((a,i)=>e.jsx(v,{children:e.jsx(me,{})},i))},n)),Se=({pipelineId:s,query:t,triggerId:r})=>{const[n,a]=d.useState(t.data||[]),i=he(),u=W(),c=d.useCallback(o=>{if(o.run.start_time=new Date(o.run.start_time),o.run.trigger_id=o.trigger,o.run.status==="running")a([o.run,...n]);else{let x=[...n];const p=x.findIndex(T=>T.id===o.run.id);p>=0?x[p]=o.run:x=[o.run,...x],a(x),i.invalidateQueries({queryKey:["runs",s,r]})}},[s,i,n,r]);d.useEffect(()=>(E.on("run-update",c),()=>{E.off("run-update",c)}),[s]),d.useEffect(()=>{var o;(o=t.data)!=null&&o.length&&a(t.data)},[t.data]);const g=4+ +!!s+ +!!r;return e.jsxs(y,{children:[e.jsx(w,{children:"Runs"}),e.jsxs(ge,{className:"overflow-auto max-h-[50vh]",children:[e.jsx(je,{className:"sticky top-0 bg-tremor-background dark:bg-dark-tremor-background shadow dark:shadow-tremor-dropdown z-10",children:e.jsxs(C,{children:[e.jsx(_,{className:"text-right",children:"#"}),e.jsx(_,{children:"Status"}),!s&&e.jsx(_,{children:"Pipeline"}),!r&&e.jsx(_,{children:"Trigger"}),e.jsx(_,{children:"Started at"}),e.jsx(_,{className:"text-right",children:"Duration"})]})}),e.jsxs(pe,{children:[n.map(o=>e.jsxs(C,{className:"cursor-pointer hover:bg-slate-50 dark:hover:bg-dark-tremor-background-subtle transition-colors",onClick:()=>u(`/pipelines/${o.pipeline_id}/triggers/${o.trigger_id}/runs/${o.id}`),children:[e.jsx(v,{className:"text-right",children:o.id}),e.jsx(v,{children:e.jsx(ts,{status:o.status})}),!s&&e.jsx(v,{children:e.jsx(D,{to:`/pipelines/${o.pipeline_id}`,className:"link--arrow",title:"View pipeline details",onClick:x=>x.stopPropagation(),children:o.pipeline_id})}),!r&&e.jsx(v,{children:e.jsx(D,{to:`/pipelines/${o.pipeline_id}/triggers/${o.trigger_id}`,className:"link--arrow",title:"View trigger details",onClick:x=>x.stopPropagation(),children:o.trigger_id})}),e.jsx(v,{title:G(o.start_time,!0),children:e.jsx(l,{children:Vs(new Date,o.start_time)<=1?xe(o.start_time,{addSuffix:!0,includeSeconds:!0}):G(o.start_time)})}),e.jsxs(v,{className:"text-right",children:[o.status!=="running"?(o.duration/1e3).toFixed(2):e.jsx(rs,{startTime:o.start_time})," ","s"]})]},o.id)),(t.isFetching||t.isPending)&&e.jsx(Bt,{columns:g}),t.isError&&e.jsx(C,{children:e.jsx(v,{colSpan:g,children:e.jsx(Te,{query:t})})})]})]})]})},Kt=()=>{const s=R(we());return e.jsx(se,{header:e.jsx(e.Fragment,{children:e.jsx(w,{children:"Plombery"})}),children:e.jsxs(P,{numItemsMd:2,className:"gap-6 mt-6",children:[e.jsx(A,{children:e.jsx(Ht,{})}),e.jsx(A,{children:e.jsx(Se,{query:s})})]})})},Qt=()=>e.jsx("div",{className:"bg-slate-100 dark:bg-slate-950 h-screen flex justify-center items-center",children:e.jsxs(y,{className:"w-auto",children:[e.jsx("div",{className:"w-12 rounded-full mx-auto mb-4",children:e.jsx("img",{src:"/mario-pipe-flower.png",alt:"Plombery logo"})}),e.jsx(w,{className:"mb-6",children:"Welcome to Plombery"}),e.jsx(N,{onClick:()=>{location.href=`${ve()}/auth/login`},size:"lg",color:"indigo",className:"shadow-none w-full",children:"Login"})]})}),O=()=>e.jsx(l,{children:"/"}),Re=({pipeline:s,trigger:t,run:r,className:n})=>{if(r&&!t)throw new Error;return e.jsxs(h,{className:`gap-x-2 justify-start flex-wrap ${n||""}`,children:[e.jsx(l,{children:e.jsx(D,{to:"/",children:"Pipelines"})}),e.jsx(O,{}),e.jsx(l,{children:t?e.jsx(D,{to:`/pipelines/${s.id}`,children:s.name}):s.name}),t&&e.jsxs(e.Fragment,{children:[e.jsx(O,{}),e.jsx(l,{children:"Triggers"}),e.jsx(O,{}),e.jsx(l,{children:r?e.jsx(D,{to:`/pipelines/${s.id}/triggers/${t.id}`,children:t.name}):t.name})]}),r&&t&&e.jsxs(e.Fragment,{children:[e.jsx(O,{}),e.jsx(l,{children:"Runs"}),e.jsx(O,{}),e.jsxs(l,{children:["#",r.id]})]})]})},Me=s=>(s/1e3).toFixed(1)+" s",Jt=()=>e.jsxs(y,{children:[e.jsx(l,{children:"Duration (AVG)"}),e.jsx(ns,{}),e.jsx(Gt,{className:"mt-6"})]}),as=({query:s})=>{if(s.isPending)return e.jsx(Jt,{});if(s.isError)return e.jsx(y,{children:e.jsx(Te,{query:s})});const t=s.data.filter(n=>n.status==="completed").reverse(),r=t.reduce((n,a)=>n+a.duration,0)/t.length||0;return e.jsxs(y,{children:[e.jsx(h,{className:"items-start",children:e.jsx(l,{children:"Duration (AVG)"})}),e.jsx(h,{className:"justify-start items-baseline space-x-3 truncate",children:e.jsx(Y,{children:Me(r)})}),e.jsx(Us,{data:t,index:"id",categories:["duration"],colors:["indigo"],valueFormatter:Me,yAxisWidth:40,showLegend:!1,autoMinValue:!0,className:"mt-6 h-28"})]})},Wt=({subject:s})=>e.jsxs(y,{children:[e.jsx(l,{children:"Successful runs"}),e.jsx(ns,{}),e.jsxs(l,{className:"mt-4",children:[s," health"]}),e.jsx(zt,{}),e.jsxs(h,{className:"mt-2",children:[e.jsx(me,{className:"w-20"}),e.jsx(me,{className:"w-20"})]})]}),is=({query:s,subject:t})=>{var c,g;if(s.isPending||s.isFetching)return e.jsx(Wt,{subject:t});if(s.isError)return e.jsx(y,{children:e.jsx(Te,{query:s})});const r=[...s.data].reverse(),a=r.filter(o=>o.status==="completed").length/r.length*100||0,i=(c=r[0])==null?void 0:c.start_time,u=(g=r[r.length-1])==null?void 0:g.start_time;return e.jsxs(y,{children:[e.jsx(h,{className:"items-start",children:e.jsx(l,{children:"Successful runs"})}),e.jsx(h,{className:"justify-start items-baseline space-x-3 truncate",children:e.jsxs(Y,{children:[a.toFixed(1)," ",e.jsx("span",{className:"text-lg",children:"%"})]})}),r.length?e.jsxs(e.Fragment,{children:[e.jsx(h,{className:"mt-4",children:e.jsxs(l,{children:[t," health"]})}),e.jsx(qs,{className:"mt-2",data:r.map(o=>({key:o.id,color:z[o.status],tooltip:`#${o.id} ${o.status}`}))})]}):e.jsx(l,{className:"text-center mt-8",children:e.jsxs(zs,{children:["This ",t.toLowerCase()," has no runs yet"]})}),e.jsxs(h,{className:"mt-2",children:[e.jsx(l,{children:i&&i.toDateString()}),e.jsx(l,{children:u&&u.toDateString()})]})]})},Xt=({pipeline:s})=>{const t=W();return e.jsxs(y,{children:[e.jsx(w,{children:"Triggers"}),e.jsxs(ge,{children:[e.jsx(je,{className:"sticky top-0 bg-tremor-background dark:bg-dark-tremor-background shadow dark:shadow-tremor-dropdown z-10",children:e.jsxs(C,{children:[e.jsx(_,{children:"Name"}),e.jsx(_,{children:"Interval"}),e.jsx(_,{children:"Next Fire Time"})]})}),e.jsxs(pe,{children:[s.triggers.map(r=>e.jsxs(C,{className:"cursor-pointer hover:bg-slate-50 dark:hover:bg-dark-tremor-background-subtle transition-colors",onClick:()=>t(`/pipelines/${s.id}/triggers/${r.id}`),children:[e.jsx(v,{children:r.name}),e.jsx(v,{children:e.jsx(l,{children:r.schedule})}),e.jsx(v,{children:xe(s.getNextFireTime(),{includeSeconds:!0,addSuffix:!0})})]},r.id)),s.triggers.length===0&&e.jsx(C,{children:e.jsxs(v,{colSpan:3,children:[e.jsx(l,{className:"text-center italic",children:"This pipeline has no triggers, can be run only manually."}),e.jsx("div",{className:"text-center mt-2 text-sm",children:e.jsxs("a",{href:"https://lucafaggianelli.github.io/plombery/triggers/",target:"_blank",className:"inline-flex items-center gap-2 bg-indigo-50/30 hover:bg-indigo-50 dark:bg-indigo-950/50 dark:hover:bg-indigo-950 rounded-sm px-4 py-2 text-indigo-500 transition-colors duration-300 cursor-pointer no-underline",rel:"noopener noreferrer",children:["How to create triggers",e.jsx(S,{icon:M,size:"sm",className:"p-0",color:"indigo"})]})})]})})]})]})]})},Yt=({className:s,content:t})=>{const[r,n]=d.useState(!1),a=d.useRef();return e.jsx(N,{variant:"light",color:"indigo",size:"sm",icon:r?Gs:Bs,tooltip:"Click to copy",className:s,onClick:()=>{navigator.clipboard.writeText(t),n(!0),a.current=setTimeout(()=>n(!1),3e3)}})},os=({pipelineId:s,triggerId:t})=>{const[r,n]=d.useState(!1),a=document.documentElement.classList.contains("dark"),i=[{language:"python",name:"Python",code:`import httpx

httpx.post('${Pe(s)}', json={${t?`
  "trigger_id": "${t}",`:""}
  "params": {
    "name": "value",
  }
})`},{language:"js",name:"JavaScript",code:`fetch('${Pe(s)}', {
  method: "POST",
  headers: {
    "Content-Type": "application/json",
  },
  body: JSON.stringify({${t?`
    trigger_id: '${t}',`:""}
    params: {},
  }),
})`}];return e.jsxs(e.Fragment,{children:[e.jsx(N,{color:"indigo",variant:"secondary",size:"xs",icon:qe,onClick:()=>n(!0)}),e.jsx(V,{isOpen:r,title:"Run via HTTP request",subtitle:"You can run pipelines and triggers via HTTP requests",onClose:()=>n(!1),children:e.jsxs(Ve,{children:[e.jsx(Ue,{className:"mt-8",children:i.map(u=>e.jsx(q,{children:u.name},u.name))}),e.jsx(Ks,{children:i.map(u=>e.jsx(Qs,{children:e.jsxs("div",{className:"mt-6 relative group",children:[e.jsx(Js,{language:u.language,style:a?Ws:Xs,customStyle:{borderRadius:8},children:u.code}),e.jsx(Yt,{content:u.code,className:"absolute top-2 right-2 opacity-0 group-hover:opacity-100 transition-opacity bg-slate-200/80 dark:bg-slate-800/80 rounded p-2"})]})},u.name))})]})})]})},Zt=()=>{const t=fe().pipelineId,r=R(Ne(t)),n=R(we(t));if(r.isPending)return e.jsx("div",{children:"Loading..."});if(r.isError)return e.jsx("div",{children:"An error has occurred"});const a=r.data;return e.jsxs(se,{header:e.jsxs("div",{children:[e.jsxs(h,{className:"items-start",children:[e.jsxs(h,{className:"justify-start items-start md:items-center flex-col md:flex-row min-w-0",children:[e.jsxs(w,{className:"truncate max-w-full",children:["Pipeline ",a.name]}),a.description&&e.jsxs(l,{className:"truncate max-w-full",children:[e.jsx("span",{className:"hidden md:inline mx-2",children:"·"}),a.description]})]}),e.jsx(_e,{pipeline:a})]}),e.jsx(Re,{pipeline:a,className:"mt-4 md:mt-0"})]}),children:[e.jsxs(P,{numItemsMd:2,numItemsLg:3,className:"gap-6 mt-6",children:[e.jsxs(y,{className:"flex flex-col h-full",children:[e.jsx(w,{children:"Tasks"}),e.jsxs(J,{children:[a.tasks.map(i=>e.jsx(I,{children:e.jsxs("div",{className:"max-w-full",children:[e.jsx(l,{children:e.jsx(L,{children:i.name})}),i.description&&e.jsx("div",{className:"truncate",title:i.description,children:i.description})]})},i.id)),a.tasks.length===0&&e.jsxs("div",{className:"mt-4",children:[e.jsx(l,{className:"text-center italic",children:"This pipeline has no tasks so it can't be run."}),e.jsx("div",{className:"text-center mt-2 text-sm",children:e.jsxs("a",{href:"https://lucafaggianelli.github.io/plombery/tasks/",target:"_blank",className:"inline-flex items-center gap-2 bg-indigo-50/30 hover:bg-indigo-50 dark:bg-indigo-950/50 dark:hover:bg-indigo-950 rounded-sm px-4 py-2 text-indigo-500 transition-colors duration-300 cursor-pointer no-underline",rel:"noopener noreferrer",children:["How to create tasks",e.jsx(S,{icon:M,size:"sm",className:"p-0",color:"indigo"})]})})]})]}),e.jsx("div",{style:{flexGrow:1}}),e.jsxs(h,{className:"justify-between gap-8",children:[e.jsx(l,{children:"Run URL"}),e.jsx(os,{pipelineId:t})]})]}),e.jsx(is,{subject:"Pipeline",query:n}),e.jsx(as,{query:n})]}),e.jsxs(P,{numItems:1,numItemsSm:1,numItemsMd:1,numItemsLg:2,className:"gap-6 mt-6",children:[e.jsx(A,{children:e.jsx(Xt,{pipeline:a})}),e.jsx(A,{children:e.jsx(Se,{query:n,pipelineId:t})})]})]})},er=({trigger:s})=>{const[t,r]=d.useState(!1);return e.jsxs(e.Fragment,{children:[e.jsx(N,{color:"indigo",variant:"light",size:"sm",icon:Ys,onClick:()=>r(!0),children:"Show params"}),e.jsx(V,{isOpen:t,title:"Trigger params",subtitle:s.name,footer:e.jsx(N,{variant:"primary",color:"indigo",onClick:()=>{r(!1)},children:"Close"}),onClose:()=>r(!1),children:e.jsx("pre",{className:"p-3 bg-slate-100 dark:bg-dark-tremor-background-subtle dark:text-dark-tremor-content-emphasis rounded-md",children:JSON.stringify(s.params,null,2)})})]})},K={id:"_manual",name:"Manual",description:"Special trigger that identifies pipelines run manually by the user"},sr=()=>{const s=W(),t=fe(),r=t.pipelineId,n=t.triggerId,a=R(Ne(r)),i=R({...we(r,n),enabled:!!n}),u=ze({...Xe(r,n),onSuccess(p){s(`/pipelines/${p.pipeline_id}/triggers/${p.trigger_id}/runs/${p.id}`)}});if(a.isPending)return e.jsx("div",{children:"Loading..."});if(a.isError)return e.jsx("div",{children:"An error has occurred"});const c=a.data,g=n===K.id,o=g?K:c.triggers.find(p=>p.id===n);if(!o)return e.jsx("div",{children:"Trigger not found"});const x=g?e.jsx(_e,{pipeline:c}):e.jsx(N,{size:"xs",color:"indigo",variant:"secondary",icon:oe,onClick:()=>{u.mutateAsync()},children:"Run"});return e.jsxs(se,{header:e.jsxs("div",{children:[e.jsxs(h,{className:"items-start",children:[e.jsxs(h,{className:"justify-start items-start md:items-center flex-col md:flex-row min-w-0",children:[e.jsxs(w,{className:"truncate max-w-full",children:["Trigger ",o.name]}),o.description&&e.jsxs(l,{className:"truncate max-w-full",children:[e.jsx("span",{className:"hidden md:inline mx-2",children:"·"}),o.description]})]}),x]}),e.jsx(Re,{pipeline:c,trigger:o,className:"mt-4 md:mt-0"})]}),children:[e.jsxs(P,{numItemsMd:2,numItemsLg:3,className:"gap-6 mt-6",children:[e.jsxs(y,{className:"flex flex-col h-full",children:[e.jsx(w,{children:o.name}),e.jsx(Q,{children:o.description}),e.jsx("div",{style:{flexGrow:1}}),e.jsxs(I,{children:[e.jsx(l,{children:"Schedule"}),e.jsx(l,{children:e.jsx(L,{children:o.schedule})})]}),e.jsxs(I,{children:[e.jsx(l,{children:"Params"}),o.params?e.jsx(er,{trigger:o}):e.jsx(l,{children:e.jsx("em",{children:"No params"})})]}),e.jsxs(h,{className:"",children:[e.jsx(l,{children:"Run URL"}),e.jsx(os,{pipelineId:r,triggerId:n})]})]}),e.jsx(is,{subject:"Trigger",query:i}),e.jsx(as,{query:i})]}),e.jsx("div",{className:"mt-6",children:e.jsx(Se,{query:i,pipelineId:r,triggerId:n})})]})},tr=({logEntry:s})=>{const[t,r]=d.useState(!1);return e.jsxs(h,{className:"mt-1",children:[e.jsx(N,{color:"rose",variant:"secondary",size:"xs",onClick:()=>r(!0),children:"Traceback info"}),e.jsx(V,{isOpen:t,title:"Traceback info",footer:e.jsx(N,{variant:"primary",color:"indigo",onClick:()=>{r(!1)},children:"Close"}),onClose:()=>r(!1),children:e.jsx("div",{className:"flex flex-col",children:e.jsx("div",{style:{minWidth:350,maxWidth:"100%",overflow:"auto",flexGrow:1,maxHeight:"70vh"},className:"p-3 my-3 bg-tremor-background-subtle dark:bg-dark-tremor-background-subtle rounded-md whitespace-pre font-mono",children:s.exc_info})})})]})},rr=30,Ae={DEBUG:"slate",INFO:"sky",WARNING:"amber",ERROR:"rose"},nr=({pipeline:s,run:t})=>{const[r,n]=d.useState({levels:[],tasks:[]}),[a,i]=d.useState(!0),u=he(),c=d.createRef(),g=R(vt(t.id)),o=d.useCallback(m=>{u.setQueryData(["logs",t.id],(j=[])=>{const b=JSON.parse(m);return b.id=j.length,b.timestamp=new Date(b.timestamp),[...j,b]})},[t.id]),x=d.useCallback(m=>{var Ee;const j=(Ee=c.current)==null?void 0:Ee.parentElement;if(!j)return;const b=m;let $=Math.max(j.scrollTop+j.clientHeight+b.deltaY,0);$=Math.min($,j.scrollHeight);const ls=j.scrollHeight-$<rr;i(ls)},[c]);d.useEffect(()=>{var m,j;return(j=(m=c.current)==null?void 0:m.parentElement)==null||j.addEventListener("wheel",x),()=>{var b,$;($=(b=c.current)==null?void 0:b.parentElement)==null||$.removeEventListener("wheel",x)}},[c]),d.useEffect(()=>{var m;if(a){const j=(m=c.current)==null?void 0:m.parentElement;j==null||j.scrollTo({top:j.scrollHeight,behavior:"smooth"})}}),d.useEffect(()=>(E.on(`logs.${t.id}`,o),()=>{E.off(`logs.${t.id}`,o)}),[]);const p=d.useCallback(m=>{n(j=>({...j,...m}))},[]);if(g.isPending)return e.jsx("div",{children:"Loading..."});if(g.isError)return e.jsx("div",{children:"Error loading logs"});const T=g.data.filter(m=>(r.levels.length===0||r.levels.includes(m.level))&&(r.tasks.length===0||r.tasks.includes(m.task))),k=ss(s.tasks),f=["running","pending"].includes(t.status);return e.jsxs(h,{flexDirection:"col",alignItems:"stretch",style:{maxHeight:600},children:[e.jsxs(P,{numItemsMd:3,className:"gap-6 items-start",children:[e.jsxs("div",{children:[e.jsx(l,{children:"Tasks"}),e.jsx($e,{className:"mt-1 z-20",onValueChange:m=>{p({tasks:m})},children:s.tasks.map(m=>e.jsx(Ce,{value:m.id,children:m.name},m.id))})]}),e.jsxs("div",{children:[e.jsx(l,{children:"Log level"}),e.jsx($e,{className:"mt-1 z-20",onValueChange:m=>{p({levels:m})},children:Object.keys(Ae).map(m=>e.jsx(Ce,{value:m},m))})]}),f&&e.jsxs(h,{justifyContent:"end",className:"order-first md:order-last",children:[e.jsx(S,{icon:Zs,variant:"light",color:a?"indigo":"gray",tooltip:"Automatically scroll to the latest logs. Click to toggle",className:"mr-4",style:{cursor:"pointer"},onClick:()=>{i(!a)}}),e.jsxs("span",{className:"relative flex h-3 w-3",children:[e.jsx("span",{className:"animate-ping absolute inline-flex h-full w-full rounded-full bg-indigo-400 opacity-75"}),e.jsx("span",{className:"relative inline-flex rounded-full h-3 w-3 bg-indigo-500"})]}),e.jsx(l,{className:"ml-2 opacity-80",children:"Live logs"})]})]}),e.jsxs(ge,{className:"mt-6 flex-grow",ref:c,children:[e.jsx(je,{className:"sticky top-0 bg-tremor-background dark:bg-dark-tremor-background shadow dark:shadow-tremor-dropdown z-10",children:e.jsxs(C,{children:[e.jsx(_,{children:"Time"}),e.jsx(_,{children:"Level"}),e.jsx(_,{children:"Task"}),e.jsx(_,{children:"Message"})]})}),e.jsx(pe,{children:T.map((m,j)=>{const b=j!==0?m.timestamp.getTime()-T[j-1].timestamp.getTime():-1;return e.jsxs(C,{children:[e.jsx(v,{children:e.jsxs(l,{className:"font-mono text-xs",children:[e.jsx("span",{title:B(m.timestamp,!0),children:B(m.timestamp)}),b>=0&&e.jsxs("span",{className:"text-slate-400 ml-2",children:["+",qt(b)," ms"]})]})}),e.jsx(v,{children:e.jsx(Ke,{size:"xs",color:Ae[m.level],children:m.level})}),e.jsx(v,{children:e.jsxs(h,{children:[e.jsx("div",{className:`h-2 w-2 mr-2 rounded-full ${k[m.task]}`}),m.task]})}),e.jsxs(v,{className:"w-full",children:[e.jsx(l,{children:m.message}),m.exc_info&&e.jsx(tr,{logEntry:m})]})]},m.id)})})]})]})},ar=be.lazy(()=>Qe(()=>import("./HandsonTable-BRdkCBfa.js"),__vite__mapDeps([0,1,2]))),ir=be.lazy(()=>Qe(()=>import("./main-CTQXcDgT.js").then(s=>s.m),__vite__mapDeps([3,1]))),or=({data:s})=>{const t=document.documentElement.classList.contains("dark");return e.jsx("div",{className:"border dark:border-slate-800 rounded-lg",children:e.jsx(d.Suspense,{fallback:e.jsx("div",{children:"Loading table UI..."}),children:e.jsx(ir,{src:s,collapseStringsAfterLength:50,iconStyle:"triangle",theme:t?"summerfruit":"summerfruit:inverted",style:{padding:24,borderRadius:"inherit"}})})})},lr=({data:s})=>e.jsx("div",{className:"border dark:border-slate-800 rounded-lg p-6",children:JSON.stringify(s)}),cr=({data:s})=>Array.isArray(s)&&typeof s[0]=="object"?e.jsx(d.Suspense,{fallback:e.jsx("div",{children:"Loading table UI..."}),children:e.jsx(ar,{data:s,rowHeaders:!0,colHeaders:Object.keys(s[0]),height:"70vh",width:"700px",licenseKey:"non-commercial-and-evaluation"})}):typeof s=="object"&&s!==null?e.jsx(or,{data:s}):e.jsx(lr,{data:s}),dr=({runId:s,taskId:t,open:r,onClose:n})=>{const a=R({...Nt(s,t),enabled:r});return e.jsx(e.Fragment,{children:e.jsxs(V,{title:t,subtitle:"View data",isOpen:r,footer:e.jsxs(e.Fragment,{children:[e.jsx(N,{variant:"secondary",color:"indigo",onClick:()=>n(),children:"Close"}),e.jsxs("a",{href:`${ve()}/${We(s,t)}`,target:"_blank",className:"tremor-Button-root flex-shrink-0 inline-flex justify-center items-center group font-medium outline-none rounded-tremor-default shadow-tremor-input dark:shadow-dark-tremor-input border px-4 py-2 text-sm bg-indigo-500 border-indigo-500 text-white hover:bg-indigo-600 hover:border-indigo-700 no-underline hover:text-inherit",rel:"noopener noreferrer",children:[e.jsx(et,{className:"tremor-Button-icon shrink-0 h-5 w-5 -ml-1 mr-1.5"}),"Download"]})]}),onClose:n,children:[a.isPending&&e.jsx("div",{children:"Loading..."}),a.isError&&(a.error.response.status===404?e.jsx(l,{children:"The task has no data"}):e.jsxs(l,{color:"rose",children:["Error fetching task data: ",a.error.message]})),!a.isPending&&!a.isError&&e.jsx(cr,{data:a.data})]})})},ur=({pipeline:s,run:t})=>{const[r,n]=d.useState(),a=ss(s.tasks);return e.jsxs(y,{children:[e.jsx(dr,{runId:t.id,taskId:r||"",open:!!r,onClose:()=>n(void 0)}),e.jsx(w,{children:"Tasks"}),e.jsx(J,{children:s.tasks.map((i,u)=>{var c;return e.jsxs(I,{className:"space-x-4",children:[t.tasks_run&&t.tasks_run[u]?e.jsx(S,{variant:"light",icon:de[t.tasks_run[u].status],color:z[t.tasks_run[u].status]}):e.jsx(S,{variant:"light",icon:de.pending,color:z.pending}),e.jsxs("div",{className:"truncate flex-grow",children:[e.jsxs(h,{className:"justify-start",children:[e.jsx("div",{className:`h-2 w-2 mr-2 rounded-full ${a[i.id]}`}),e.jsx(Q,{className:"truncate text-base text-tremor-content-emphasis dark:text-dark-tremor-content-emphasis",children:i.name})]}),i.description&&e.jsx(l,{className:"truncate",children:i.description})]}),t.tasks_run&&((c=t.tasks_run[u])==null?void 0:c.has_output)&&e.jsx(N,{variant:"light",color:"indigo",size:"xs",icon:st,onClick:()=>n(i.id),children:"Data"})]},i.id)})})]})},mr=()=>{const s=he(),t=fe(),r=t.pipelineId,n=t.triggerId,a=parseInt(t.runId);d.useEffect(()=>{const f=()=>{s.invalidateQueries({queryKey:Le(r,n,a).queryKey})};return E.on("run-update",f),()=>{E.off("run-update",f)}},[r]);const i=R(Ne(r)),u=R(Le(r,n,a));if(i.isPending)return e.jsx("div",{children:"Loading..."});if(i.isError)return e.jsx("div",{children:"Error"});const c=i.data,o=n===K.id?K:c.triggers.find(f=>f.id===n),x=u.data;if(!x)return e.jsx("div",{children:"Run not found"});if(!o)return e.jsx("div",{children:"Trigger not found"});const p=(x.tasks_run||[]).reduce((f,m)=>f+m.duration,0),T=(x.tasks_run||[]).map(f=>p?f.duration/p*100:0),k=tt(x.start_time,x.duration);return e.jsxs(se,{header:e.jsxs(e.Fragment,{children:[e.jsxs(w,{children:["Run #",a]}),e.jsx(Re,{pipeline:c,trigger:o,run:x})]}),children:[e.jsxs(P,{numItemsMd:3,className:"gap-6 mt-6",children:[e.jsx(ur,{pipeline:c,run:x}),e.jsxs(y,{children:[e.jsxs(h,{className:"items-start",children:[e.jsx(l,{children:"Duration"}),e.jsx(ts,{status:x.status})]}),e.jsx(h,{className:"justify-start items-baseline space-x-3 truncate",children:e.jsxs(Y,{children:[x.status!=="running"?(x.duration/1e3).toFixed(2):e.jsx(rs,{startTime:x.start_time})," ","s"]})}),e.jsx(rt,{values:T,colors:ue,showLabels:!1,className:"mt-3"}),e.jsxs(h,{alignItems:"start",className:"mt-2",children:[e.jsxs("div",{children:[e.jsx(l,{children:e.jsx(L,{title:G(x.start_time,!0),children:B(x.start_time)})}),e.jsx(l,{className:"mt-1",children:Oe(x.start_time)})]}),e.jsxs("div",{className:"text-right",children:[e.jsx(l,{children:e.jsx(L,{title:G(k,!0),children:B(k)})}),!nt(x.start_time,k)&&e.jsx(l,{children:Oe(k)})]})]})]})]}),e.jsx("div",{className:"mt-6",children:e.jsx(y,{children:e.jsx(nr,{pipeline:c,run:x})})})]})},xr=({children:s})=>{const{isAuthenticated:t,isLoading:r}=ke(),n=at();return!t&&!r?e.jsx(it,{to:"/login",replace:!0,state:{from:n}}):e.jsx(e.Fragment,{children:s})},hr=Object.assign({"./pages/index.tsx":Kt,"./pages/login.tsx":Qt,"./pages/pipelines/[pipelineId]/index.tsx":Zt,"./pages/pipelines/[pipelineId]/triggers/[triggerId]/index.tsx":sr,"./pages/pipelines/[pipelineId]/triggers/[triggerId]/runs/[runId]/index.tsx":mr}),gr=Object.entries(hr).map(([s,t])=>{const r=s.slice(7).replace(/(index)?\.tsx$/,"").split("/").map(n=>n.replace(/\[(.+)\]/,":$1")).join("/");return{path:r,element:r!=="/login"?e.jsx(xr,{children:e.jsx(t,{})}):e.jsx(t,{})}}),jr=()=>e.jsx(ot,{children:gr.map(s=>e.jsx(lt,{path:s.path,element:s.element},s.path))}),pr=({children:s})=>{const[t,r]=d.useState(E.connected);return d.useEffect(()=>{function n(){r(!0)}function a(){r(!1)}return E.on("connect",n),E.on("disconnect",a),()=>{E.off("connect",n),E.off("disconnect",a)}},[]),s},fr=new ct({defaultOptions:{queries:{retry:!1}}});function br(){return e.jsx(dt,{client:fr,children:e.jsx(pr,{children:e.jsx(ut,{children:e.jsx(_t,{children:e.jsx(jr,{})})})})})}mt.createRoot(document.getElementById("root")).render(e.jsx(be.StrictMode,{children:e.jsx(br,{})}));
