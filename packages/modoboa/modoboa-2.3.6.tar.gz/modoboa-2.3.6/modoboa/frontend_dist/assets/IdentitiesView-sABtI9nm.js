import{b as T,af as P,O as X,G as c,i as N,d as Z,r as ne,o as y,c as A,w as e,a as t,I as j,S as g,t as _,f as v,R as W,J as ee,V as se,Q as re,U as q,a0 as te,ag as ue,a4 as de,e as E,ab as me,_ as ce,ah as O,a2 as pe,a3 as fe}from"./index-Bbkf9DIc.js";import{_ as Q}from"./MenuItems-DQdkh9BG.js";import{_ as Y}from"./ConfirmDialog-DXHV8KLb.js";import{V as ve}from"./VDataTable-BfFW1vg6.js";import{V as ae,a as ye}from"./VToolbar-BMyNQ6K-.js";import{V as G}from"./VMenu-pbjiSmmM.js";import{g as R,h as _e}from"./index-CDn75bM3.js";import{V as le,a as J,b as H}from"./forwardRefs-zpUiuLw8.js";import{V as oe}from"./VSpacer-CPtHAmtO.js";import{V as Ve}from"./VTextField-Djz_9Wz9.js";import{V as be}from"./VChip-DoOT6ijG.js";import{V as ke}from"./VCheckbox-C7p6F9aZ.js";import{c as ge}from"./VCard-DLgKmdoO.js";import{_ as xe,a as we}from"./AliasRecipientForm-BEepROZ-.js";import{_ as ie}from"./CreationForm-1iVTGfYL.js";import{_ as Ce,a as Ae,A as he,b as Ie}from"./AccountAliasForm-Cvcrn5AS.js";import{V as D,a as K}from"./VRow-DnWvWxV-.js";import{_ as Se,i as $e}from"./importExport-CR4SWg8M.js";import{V as B}from"./VDialog-CLTUldPN.js";import{V as Fe}from"./VSwitch-MOiUeFZQ.js";import"./tag-BgJ4tZGv.js";import"./VProgressCircular-o4TPEeLK.js";import"./VSelect-0_bFDN-s.js";import"./dimensions-CxFA8Z4w.js";import"./VAvatar-CcSwNzJ2.js";import"./filter-BVTKTv4O.js";import"./ssrBoot-C8G7_1W2.js";/* empty css              */import"./EmailField-Dmv0bzOI.js";import"./VForm-BCtIZQOE.js";import"./VTextarea-CCOY15Y4.js";import"./VWindowItem-D5SUtcL1.js";import"./VContainer-D7EM81q4.js";import"./VSheet-DBaZUbyz.js";import"./ChoiceField-2xK3jpng.js";import"./VAlert-Da5j80B0.js";import"./AccountPasswordSubForm-Deeun_9B.js";const Ue={__name:"IdentityList",setup($){const{$gettext:i}=T(),a=P(),F=X(),C=c([{title:i("Name"),key:"identity"},{title:i("Fullname/recipient"),key:"name_or_rcpt"},{title:i("Tags"),key:"tags"},{title:i("Actions"),key:"actions",sortable:!1,align:"end"}]),x=N(()=>a.identities),V=N(()=>a.identitiesLoaded),b=c(""),w=c([]),k=c(!1),o=c(),l=c();function r(){a.getIdentities().then(()=>{w.value=[]})}function h(n){const u=[];return n.type==="account"?(n.possible_actions.forEach(I=>{u.push({label:I.label,icon:I.icon,onClick:()=>{I.type,r()}})}),u.push({label:i("Edit"),icon:"mdi-circle-edit-outline",onClick:S}),u.push({label:i("Delete"),icon:"mdi-delete-outline",onClick:L,color:"red"})):n.type==="alias"&&(u.push({label:i("Edit"),icon:"mdi-circle-edit-outline",onClick:z}),u.push({label:i("Delete"),icon:"mdi-delete-outline",onClick:f,color:"red"})),u}function U(){const n=[];return w.value.length>0&&n.push({label:i("Delete"),icon:"mdi-delete-outline",onClick:M,color:"red"}),n}function S(n){F.push({name:"AccountEdit",params:{id:n.pk}})}async function L(n){await l.value.open(i("Warning"),i("Are you sure you want to delete this identity ?"),{color:"error",agreeLabel:i("Yes"),cancelLabel:i("No")})&&a.deleteIdentity(n.type,n.pk,{keepdir:k.value}).then(()=>{k.value=!1})}function z(){}function M(){}async function f(n){await o.value.open(i("Warning"),i("Are you sure you want to delete this alias?"),{color:"error",agreeLabel:i("Yes"),cancelLabel:i("No")})&&a.deleteIdentity(n.type,n.pk)}return Z(()=>{x.value.length<1&&r()}),(n,u)=>{const I=ne("router-link");return y(),A(ge,{class:"mt-6"},{default:e(()=>[t(ve,{modelValue:w.value,"onUpdate:modelValue":u[1]||(u[1]=d=>w.value=d),headers:C.value,items:x.value,search:b.value,loading:!V.value,"item-value":"identity",class:"elevation-0","show-select":""},{top:e(()=>[t(ae,{flat:"",color:"white"},{default:e(()=>[t(G,{location:"bottom"},{activator:e(({props:d})=>[t(R,j({"append-icon":"mdi-chevron-down"},d,{size:"small",variant:"flat"}),{default:e(()=>[g(_(v(i)("Actions")),1)]),_:2},1040)]),default:e(()=>[t(le,{density:"compact"},{default:e(()=>[t(Q,{items:U()},null,8,["items"])]),_:1})]),_:1}),t(R,{variant:"text",icon:"mdi-reload",onClick:r}),t(oe),t(Ve,{modelValue:b.value,"onUpdate:modelValue":u[0]||(u[0]=d=>b.value=d),"prepend-inner-icon":"mdi-magnify",placeholder:v(i)("Search"),variant:"outlined","hide-details":"","single-line":"",flat:""},null,8,["modelValue","placeholder"])]),_:1})]),"item.identity":e(({item:d})=>[d.type==="account"?(y(),A(I,{key:0,to:{name:"AccountDetail",params:{id:d.pk}}},{default:e(()=>[g(_(d.identity),1)]),_:2},1032,["to"])):(y(),A(I,{key:1,to:{name:"AliasDetail",params:{id:d.pk}}},{default:e(()=>[g(_(d.identity),1)]),_:2},1032,["to"]))]),"item.tags":e(({item:d})=>[(y(!0),W(ee,null,se(d.tags,(s,m)=>(y(),A(be,{key:s.name,color:s.type!=="idt"?"primary":"default",class:re(m>0?"ml-2":""),size:"small"},{default:e(()=>[g(_(s.label),1)]),_:2},1032,["color","class"]))),128))]),"item.actions":e(({item:d})=>[d.possible_actions!==void 0&&d.possible_actions.length!==0?(y(),A(_e,{key:0,size:"2.5em",color:"blue"},{default:e(()=>[g("mdi-circle-small")]),_:1})):q("",!0),t(G,{location:"bottom"},{activator:e(({props:s})=>[t(R,j(s,{size:"small",icon:"mdi-dots-horizontal",variant:"text"}),null,16)]),default:e(()=>[t(Q,{items:h(d),obj:d},null,8,["items","obj"])]),_:2},1024)]),_:2},1032,["modelValue","headers","items","search","loading"]),t(Y,{ref_key:"confirmAlias",ref:o},null,512),t(Y,{ref_key:"confirmAccount",ref:l},{default:e(()=>[t(ke,{modelValue:k.value,"onUpdate:modelValue":u[2]||(u[2]=d=>k.value=d),label:v(i)("Do not delete account folder"),"hide-details":""},null,8,["modelValue","label"])]),_:1},512)]),_:1})}}},Ee={__name:"AliasCreationForm",emits:["close","created"],setup($,{emit:i}){const{$gettext:a}=T(),F=te(),C=P(),x=X(),V=i,b=c(),w=c(),k={general:b,recipients:w},o=N(()=>{const f=[{title:a("General"),items:[{key:a("Random address"),value:l.value.random,type:"yesno"},{key:a("Address"),value:l.value.address}]}];return l.value.expire_at!==void 0&&f[0].items.push({key:a("Expire at"),value:l.value.expire_at}),l.value.description!==void 0&&f[0].items.push({key:a("Description"),value:l.value.description}),f.push({title:a("Recipients"),items:[{key:a("Recipients"),value:l.value.recipients.join(", ")}]}),f}),l=c(U()),r=c([{name:"general",title:a("General")},{name:"recipients",title:a("Recipients")}]);function h(){l.value=U(),V("close")}function U(){return{random:!1,enabled:!0,recipients:[]}}function S(f){return k.step[f.name]}function L(f){return k[f.name].value.vFormRef}function z(){const f={...l.value};f.recipients.length===0&&delete f.recipients;const n=ue.validate(f);return n.catch(u=>{u.response.status===409&&u.response.data.id!==void 0&&(F.displayNotification({msg:a("Alias already exists, redirecting to edit page"),type:"warning"}),x.push({name:"AliasEdit",params:{id:u.response.data.id}}))}),n}function M(){l.value.domain!==void 0&&delete l.value.domain,C.createIdentity("alias",l.value).then(()=>{V("created"),h()})}return(f,n)=>(y(),A(ie,{ref:"form",title:v(a)("New alias"),steps:r.value,"form-getter":S,"get-v-form-ref":L,"validate-object":z,"summary-sections":o.value,onClose:h,onCreate:M},{"form.general":e(()=>[t(xe,{ref_key:"general",ref:b,modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=u=>l.value=u)},null,8,["modelValue"])]),"form.recipients":e(()=>[t(we,{ref_key:"recipients",ref:w,modelValue:l.value.recipients,"onUpdate:modelValue":n[1]||(n[1]=u=>l.value.recipients=u)},null,8,["modelValue"])]),_:2},1032,["title","steps","summary-sections"]))}},Re={class:"grey--text"},De={__name:"AccountCreationForm",emits:["close","created"],setup($,{emit:i}){const{$gettext:a}=T(),F=te(),C=de(),x=P(),V=i,b=N(()=>o.value.role!=="SuperAdmins"&&o.value.username&&o.value.username.indexOf("@")!==-1),w=N(()=>{const s=[{title:a("Role"),items:[{key:a("Role"),value:o.value.role}]},{title:a("Identification"),items:[{key:a("Username"),value:o.value.username},{key:a("First name"),value:o.value.first_name},{key:a("Last name"),value:o.value.last_name},{name:"random_password",key:a("Random password"),value:o.value.random_password,type:"yesno"},{key:a("Enabled"),value:o.value.is_active,type:"yesno"}]}];return b.value?s.concat([{title:a("Mailbox"),items:[{key:a("Email"),value:o.value.mailbox.full_address},{key:a("Quota"),value:o.value.mailbox.use_domain_quota?a("Domain default value"):o.value.mailbox.quota},{key:a("Message sending limit"),value:o.value.mailbox.message_limit},{key:a("Send only account"),value:o.value.mailbox.is_send_only,type:"yesno"}]},{title:a("Aliases"),items:[{key:a("Aliases"),value:o.value.aliases,type:"list"}]}]):s}),k=N(()=>{const s=[{name:"role",title:a("Role")},{name:"identification",title:a("Identification")}];return b.value?s.concat([{name:"mailbox",title:a("Mailbox")},{name:"aliases",title:a("Aliases")}]):s}),o=c({aliases:[],is_active:!0,role:"SimpleUsers",mailbox:{use_domain_quota:!0},random_password:!1}),l=c(),r=c(),h=c(),U=c(),S={role:l,identification:r,mailbox:h,aliases:U};function L(){navigator.clipboard.writeText(o.value.password).then(()=>{F.displayNotification({msg:a("Password copied to clipboard")})})}function z(s){return S.step[s.name]}function M(s){return S[s.name].value.vFormRef}function f(s,m){const p=k.value[s-1].name;S[p].value.formErrors&&(S[p].value.formErrors.value=m)}function n(s){const m={...s};return m.role==="SuperAdmins"&&m.username&&m.username.indexOf("@")===-1&&delete m.mailbox,m.mailbox&&m.mailbox.message_limit===""&&(m.mailbox.message_limit=null),m}function u(){const s=n({...o.value});return me.validate(s)}function I(){V("close")}function d(){const s=n({...o.value});x.createIdentity("account",s).then(()=>{V("created"),I()})}return Z(()=>{C.getDomains()}),(s,m)=>(y(),A(ie,{ref:"form",title:v(a)("New account"),steps:k.value,"form-getter":z,"get-v-form-ref":M,"validate-object":u,"summary-sections":w.value,onClose:I,onCreate:d,onValidationError:f},{"form.role":e(()=>[t(Ce,{ref_key:"role",ref:l,modelValue:o.value,"onUpdate:modelValue":m[0]||(m[0]=p=>o.value=p)},null,8,["modelValue"])]),"form.identification":e(()=>[t(Ae,{ref_key:"identification",ref:r,modelValue:o.value,"onUpdate:modelValue":m[1]||(m[1]=p=>o.value=p)},null,8,["modelValue"])]),"form.mailbox":e(()=>[t(he,{ref_key:"mailbox",ref:h,modelValue:o.value,"onUpdate:modelValue":m[2]||(m[2]=p=>o.value=p)},null,8,["modelValue"])]),"form.aliases":e(()=>[t(Ie,{ref_key:"aliases",ref:U,modelValue:o.value,"onUpdate:modelValue":m[3]||(m[3]=p=>o.value=p)},null,8,["modelValue"])]),"item.random_password":e(({item:p})=>[p.value?(y(),A(D,{key:0,cols:"12",class:"highligth text-white"},{default:e(()=>[t(K,null,{default:e(()=>[t(D,null,{default:e(()=>[E("span",null,_(p.key),1)]),_:2},1024),p.type==="yesno"?(y(),A(D,{key:0,class:"text-right"},{default:e(()=>[g(_(s.$yesno(p.value)),1)]),_:2},1024)):q("",!0)]),_:2},1024),t(K,null,{default:e(()=>[t(D,{class:"text-right py-1"},{default:e(()=>[t(R,{"append-icon":"mdi-clipboard-multiple-outline",color:"white",variant:"text",title:v(a)("Copy to clipboard"),onClick:L},{default:e(()=>[g(_(o.value.password),1)]),_:1},8,["title"])]),_:1})]),_:1})]),_:2},1024)):(y(),W(ee,{key:1},[t(D,null,{default:e(()=>[E("span",Re,_(p.key),1)]),_:2},1024),p.type==="yesno"?(y(),A(D,{key:0,class:"text-right"},{default:e(()=>[g(_(s.$yesno(p.value)),1)]),_:2},1024)):q("",!0)],64))]),_:2},1032,["title","steps","summary-sections"]))}},Ne=$=>(pe("data-v-117ae2bb"),$=$(),fe(),$),Le=Ne(()=>E("ul",null,[E("li",null,[E("em",null,"account; loginname; password; first name; last name; enabled; group; address; quota; [, domain, ...]")]),E("li",null,[E("em",null,"alias; address; enabled; recipient; [more recipients; ...]")])],-1)),ze={__name:"IdentitiesView",setup($){const{$gettext:i}=T(),{importContent:a,exportContent:F}=$e(),C=c(!1),x=c(!1),V=c(!1),b=c();function w(){O.exportAll().then(o=>{F(o.data,"identities",i)})}function k(o,l){o.append("crypt_passwords",l.crypt_passwords),a(O,o,b,i)}return(o,l)=>(y(),W("div",null,[t(ae,{flat:""},{default:e(()=>[t(ye,null,{default:e(()=>[g(_(v(i)("Identities")),1)]),_:1}),t(oe),t(R,{class:"mr-2",title:v(i)("Import accounts and aliases from CSV file"),variant:"elevated",icon:"mdi-file-import-outline",onClick:l[0]||(l[0]=r=>V.value=!0)},null,8,["title"]),t(R,{class:"mr-2",title:v(i)("Export accounts and aliases to CSV"),icon:"mdi-file-export-outline",variant:"elevated",onClick:w},null,8,["title"]),t(G,{"offset-y":""},{activator:e(({props:r})=>[t(R,j({color:"primary",variant:"flat"},r,{"prepend-icon":"mdi-plus"}),{default:e(()=>[g(_(v(i)("New")),1)]),_:2},1040)]),default:e(()=>[t(le,{density:"compact"},{default:e(()=>[t(J,{onClick:l[1]||(l[1]=r=>C.value=!0)},{default:e(()=>[t(H,null,{default:e(()=>[g(_(v(i)("Account")),1)]),_:1})]),_:1}),t(J,{onClick:l[2]||(l[2]=r=>x.value=!0)},{default:e(()=>[t(H,null,{default:e(()=>[g(_(v(i)("Alias")),1)]),_:1})]),_:1})]),_:1})]),_:1})]),_:1}),t(Ue),t(B,{modelValue:x.value,"onUpdate:modelValue":l[4]||(l[4]=r=>x.value=r),fullscreen:"",scrollable:"","z-index":"10"},{default:e(()=>[t(Ee,{onClose:l[3]||(l[3]=r=>x.value=!1)})]),_:1},8,["modelValue"]),t(B,{modelValue:C.value,"onUpdate:modelValue":l[6]||(l[6]=r=>C.value=r),fullscreen:"",scrollable:"","z-index":"10"},{default:e(()=>[t(De,{onClose:l[5]||(l[5]=r=>C.value=!1)})]),_:1},8,["modelValue"]),t(B,{modelValue:V.value,"onUpdate:modelValue":l[8]||(l[8]=r=>V.value=r),persistent:"","max-width":"800px"},{default:e(()=>[t(v(Se),{ref_key:"importForm",ref:b,title:v(i)("Import identities"),onSubmit:k,onClose:l[7]||(l[7]=r=>V.value=!1)},{help:e(()=>[Le]),extraFields:e(({form:r})=>[t(Fe,{modelValue:r.crypt_passwords,"onUpdate:modelValue":h=>r.crypt_passwords=h,label:v(i)("Crypt passwords"),color:"primary",density:"compact",hint:v(i)("Check this option if passwords contained in your file are not crypted"),"persistent-hint":""},null,8,["modelValue","onUpdate:modelValue","label","hint"])]),_:1},8,["title"])]),_:1},8,["modelValue"])]))}},gt=ce(ze,[["__scopeId","data-v-117ae2bb"]]);export{gt as default};
