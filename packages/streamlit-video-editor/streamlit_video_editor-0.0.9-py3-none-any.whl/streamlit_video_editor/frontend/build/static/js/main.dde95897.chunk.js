(this["webpackJsonpstreamlit-video-timeline"]=this["webpackJsonpstreamlit-video-timeline"]||[]).push([[0],{15:function(e,t,r){},16:function(e,t,r){"use strict";r.r(t);var o=r(1),n=r.n(o),a=r(5),c=r.n(a),s=r(4),l=r(0);var i=Object(s.b)((e=>{let{args:t,theme:r}=e;const n=Object(o.useRef)(!1),a=Object(o.useRef)(null),c=r||{base:"light",primaryColor:"#000",backgroundColor:"#fff",secondaryBackgroundColor:"#f0f0f0",textColor:"#000",font:"sans-serif"},i=Object(o.useRef)(null),d=Object(o.useRef)(null),[u,m]=Object(o.useState)(!1),[b,j]=Object(o.useState)(0),[h,f]=Object(o.useState)(0),[v,g]=Object(o.useState)(0),[O,x]=Object(o.useState)([]),p=Object(o.useRef)(null),A=Object(o.useRef)(null),[C,y]=Object(o.useState)(100),[k,w]=Object(o.useState)(100);Object(o.useEffect)((()=>{s.a.setComponentReady();const e=i.current;if(e)return e.addEventListener("loadedmetadata",(()=>{console.log(`Video loaded with duration: ${e.duration} seconds`),g(e.duration);const t=Math.min(300,Math.max(50,Math.ceil(e.duration/3)));console.log(`Setting thumbnail count to: ${t} based on duration: ${e.duration}`),y(t);const r=Math.min(1e3,Math.max(100,Math.ceil(2*e.duration)));console.log(`Setting waveform count to: ${r} based on duration: ${e.duration}`),w(r),R(e)})),e.addEventListener("error",(t=>{var r,o;console.error("Video loading error:",t),console.error("Video error code:",null===(r=e.error)||void 0===r?void 0:r.code),console.error("Video error message:",null===(o=e.error)||void 0===o?void 0:o.message)})),()=>{p.current&&p.current.close(),e.removeEventListener("loadedmetadata",(()=>{}))}}),[]);const N=e=>{const t=Math.floor(e/60),r=Math.floor(e%60);return`${t}:${r<10?"0"+r:r}`},M=e=>t=>{n.current=!0,a.current=e,document.addEventListener("mousemove",E),document.addEventListener("mouseup",$)},E=e=>{if(!n.current||!d.current||!a.current)return;const t=d.current.getBoundingClientRect(),r=t.width,o=t.left;let c=(e.clientX-o)/r;c=Math.max(0,Math.min(1,c));const s=c*v;"start"===a.current?s<h&&(j(s),i.current&&(i.current.currentTime=s)):s>b&&(f(s),i.current&&(i.current.currentTime=s))},$=()=>{n.current=!1,a.current=null,document.removeEventListener("mousemove",E),document.removeEventListener("mouseup",$)},S=e=>()=>{i.current&&(i.current.currentTime=e)},R=e=>{const t=new AudioContext,r=t.createAnalyser();r.fftSize=256;const o=r.frequencyBinCount,n=new Uint8Array(o);t.createMediaElementSource(e).connect(r),r.connect(t.destination),p.current=t,A.current=r;const a=()=>{A.current&&(A.current.getByteFrequencyData(n),x(Array.from(n)),requestAnimationFrame(a))};a()};return Object(l.jsx)("div",{style:{fontFamily:c.font,color:c.textColor,backgroundColor:c.backgroundColor,padding:"10px"},children:Object(l.jsxs)("div",{className:"container",children:[Object(l.jsxs)("video",{ref:i,controls:!0,style:{width:"100%",maxWidth:"100%"},onLoadedData:()=>console.log("Video data loaded successfully"),onError:e=>console.error("Video loading error:",e),onTimeUpdate:()=>{i.current&&console.log(`Current time: ${i.current.currentTime}, Duration: ${i.current.duration}`)},children:[Object(l.jsx)("source",{src:t.video_url,type:"video/mp4"}),"Your browser does not support the video tag."]}),Object(l.jsxs)("div",{className:"timeline-wrapper",ref:d,children:[Object(l.jsxs)("div",{className:"timeline-labels",children:[Object(l.jsx)("div",{className:"timeline-label",style:{paddingBottom:"10px",paddingTop:"10px"},children:"VIDEO"}),Object(l.jsx)("div",{className:"timeline-label",children:"AUDIO"})]}),Object(l.jsxs)("div",{className:"timeline-container",children:[Object(l.jsx)("div",{className:"video-track",children:Object(l.jsx)("div",{className:"frame-thumbnails",children:t.frame_data&&t.frame_data.length>0?t.frame_data.map(((e,r)=>Object(l.jsx)("div",{className:"frame-thumbnail",style:{backgroundImage:`url("${e}")`,width:100/t.frame_data.length+"%"}},r))):Array.from({length:C}).map(((e,t)=>Object(l.jsx)("div",{className:"frame-thumbnail",style:{backgroundImage:'url("data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==")',width:100/C+"%"}},t)))})}),Object(l.jsx)("div",{className:"audio-track",children:Object(l.jsx)("div",{className:"audio-waveform",children:t.waveform_data&&t.waveform_data.length>0?t.waveform_data.map(((e,t)=>{const r=100*Math.max(e,.2);return Object(l.jsx)("div",{className:"waveform-bar",style:{height:`${r}%`,backgroundColor:c.primaryColor||"rgba(255, 75, 75, 0.8)"}},t)})):Array.from({length:k}).map(((e,t)=>{const r=20+15*Math.sin(t*Math.PI/10);return Object(l.jsx)("div",{className:"waveform-bar",style:{height:`${r}%`,backgroundColor:c.primaryColor||"rgba(255, 75, 75, 0.8)",flexBasis:100/k+"%",minWidth:0}},t)}))})}),u&&Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("div",{className:"crop-marker",style:{left:b/v*100+"%",cursor:"ew-resize"},onMouseDown:M("start"),onDoubleClick:S(b),children:Object(l.jsx)("div",{className:"crop-label",children:N(b)})}),Object(l.jsx)("div",{className:"crop-marker",style:{left:h/v*100+"%",cursor:"ew-resize"},onMouseDown:M("end"),onDoubleClick:S(h),children:Object(l.jsx)("div",{className:"crop-label",children:N(h)})})]})]})]}),Object(l.jsx)("div",{className:"button-container",children:u?Object(l.jsxs)(l.Fragment,{children:[Object(l.jsx)("button",{className:"btn",onClick:()=>{s.a.setComponentValue({start:b,end:h,shouldRefreshTaskList:!0}),m(!1)},style:{backgroundColor:c.primaryColor},children:"Aplicar Corte"}),Object(l.jsx)("button",{className:"btn",onClick:()=>m(!1),style:{backgroundColor:c.primaryColor},children:"Cancelar"})]}):Object(l.jsx)("button",{className:"btn",onClick:()=>{if(!u){console.log(`Setting crop markers for toggle: video duration = ${v}`);const e=1,t=Math.max(v-1,.75*v);console.log(`Setting crop markers at: start=${e}, end=${t}`),j(e),f(t)}m(!u)},style:{backgroundColor:c.primaryColor},children:"Modo de Corte"})})]})})}));r(15);c.a.render(Object(l.jsx)(n.a.StrictMode,{children:Object(l.jsx)(i,{})}),document.getElementById("root"))}},[[16,1,2]]]);