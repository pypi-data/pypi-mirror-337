import{r,E as k,_ as V,n as u,B as ft,z as N,j as n,ba as J,bu as mt,C as F,bp as Q,b5 as Z,bo as U,a$ as yt,bG as Ct,bj as vt,bH as b,bs as It,F as tt,bh as bt,bI as xt,M as R,bl as wt,bk as St}from"./index.B28jf8c_.js";import{g as Ft,F as $,C as zt,I as Et,E as Ut,a as Tt,s as Ht,u as Bt,b as Rt}from"./FileHelper.aCeQQwv9.js";import{I as Dt}from"./InputInstructions.CxNXqmaa.js";import{i as Lt}from"./inputUtils.CQWz5UKz.js";import{a as q}from"./index.t--hEgTQ.js";import{U as et}from"./UploadFileInfo.C-jY39rj.js";import{T as Mt}from"./textarea.DFCEFjUj.js";import"./base-input.B02pchZb.js";var ot=r.forwardRef(function(t,e){var i={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(k,V({iconAttrs:i,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),r.createElement("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 015 0v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5a2.5 2.5 0 005 0V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"}))});ot.displayName="AttachFile";var nt=r.forwardRef(function(t,e){var i={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(k,V({iconAttrs:i,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("path",{d:"M11 15h2v2h-2v-2zm0-8h2v6h-2V7zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}))});nt.displayName="ErrorOutline";var at=r.forwardRef(function(t,e){var i={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return r.createElement(k,V({iconAttrs:i,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},t,{ref:e}),r.createElement("rect",{width:24,height:24,fill:"none"}),r.createElement("path",{d:"M3 5.51v3.71c0 .46.31.86.76.97L11 12l-7.24 1.81c-.45.11-.76.51-.76.97v3.71c0 .72.73 1.2 1.39.92l15.42-6.49c.82-.34.82-1.5 0-1.84L4.39 4.58C3.73 4.31 3 4.79 3 5.51z"}))});at.displayName="Send";const $t=u("div",{target:"e1togvvn0"})("border:none;position:relative;display:flex;"),kt=u("div",{target:"e1togvvn1"})(({theme:t,extended:e})=>({border:`${t.sizes.borderWidth} solid`,borderColor:t.colors.widgetBorderColor??t.colors.transparent,borderRadius:t.radii.chatInput,backgroundColor:t.colors.secondaryBg,position:"relative",flexGrow:1,display:"flex",alignItems:"center",paddingLeft:t.spacing.lg,maxHeight:e?"none":t.sizes.minElementHeight,gap:t.spacing.sm,overflow:"hidden",":focus-within":{borderColor:t.colors.primary}})),Vt=u("button",{target:"e1togvvn2"})(({theme:t,disabled:e,extended:i})=>{const c=ft(t),[f,p]=c?[t.colors.gray60,t.colors.gray80]:[t.colors.gray80,t.colors.gray40];return{border:"none",backgroundColor:t.colors.transparent,borderTopRightRadius:i?"0":t.radii.chatInput,borderTopLeftRadius:i?t.radii.default:"0",borderBottomRightRadius:t.radii.chatInput,display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:t.lineHeights.none,margin:t.spacing.none,padding:t.spacing.sm,color:e?f:p,pointerEvents:"auto","&:focus":{outline:"none"},":focus":{outline:"none"},"&:focus-visible":{backgroundColor:c?t.colors.gray10:t.colors.gray90},"&:hover":{color:t.colors.primary},"&:disabled, &:disabled:hover, &:disabled:active":{backgroundColor:t.colors.transparent,borderColor:t.colors.transparent,color:t.colors.gray,cursor:"not-allowed"}}}),Nt=u("div",{target:"e1togvvn3"})(({theme:t})=>({display:"flex",alignItems:"flex-end",height:"100%",position:"absolute",right:0,marginBottom:`-${t.sizes.borderWidth}`,pointerEvents:"none"})),Wt=u("div",{target:"e1togvvn4"})(({theme:t})=>({position:"absolute",bottom:"0px",right:`calc(${t.iconSizes.xl} + 2 * ${t.spacing.sm} + ${t.spacing.sm})`})),At=u("div",{target:"e15560op0"})(({theme:t,height:e})=>({backgroundColor:t.colors.transparent,position:"absolute",left:0,bottom:0,minHeight:`max(${t.sizes.emptyDropdownHeight}, ${e})`,width:"100%",zIndex:t.zIndices.priority})),Pt=u("div",{target:"e15560op1"})(({theme:t,height:e})=>({border:`${t.sizes.borderWidth} solid`,borderColor:t.colors.primary,borderRadius:t.radii.chatInput,backgroundColor:t.colors.secondaryBg,color:t.colors.primary,display:"flex",alignItems:"center",justifyContent:"center",height:e,width:"100%",fontWeight:t.fontWeights.bold})),Kt=u("div",{target:"e15560op2"})(({theme:t,disabled:e})=>({display:"flex",alignItems:"top",height:"100%",marginTop:`-${t.sizes.borderWidth}`,cursor:e?"not-allowed":"auto"})),Ot=u("div",{target:"e15560op3"})(({disabled:t})=>({pointerEvents:t?"none":"auto"})),_t=u("div",{target:"e15560op4"})(({theme:t})=>({marginTop:"0.625em",marginLeft:t.spacing.sm,height:t.spacing.xl,width:t.sizes.borderWidth,backgroundColor:t.colors.fadedText20})),Xt=u("div",{target:"e15560op5"})(({theme:t})=>({left:0,right:0,lineHeight:t.lineHeights.tight,paddingLeft:t.spacing.sm,paddingRight:t.spacing.sm,overflowX:"auto"})),Gt=u("div",{target:"e15560op6"})({display:"flex"}),jt=u("div",{target:"e15560op7"})({flex:"0 0 auto"}),Yt=u("div",{target:"e15560op8"})(({theme:t})=>({display:"flex",alignItems:"center",padding:t.spacing.sm,gap:t.spacing.twoXS})),qt=u("div",{target:"e15560op9"})(({theme:t})=>({color:t.colors.fadedText60})),Jt=u("div",{target:"e15560op10"})(({theme:t,fileStatus:e})=>({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:e.type==="uploaded"?t.colors.bodyText:t.colors.fadedText60})),Qt=u("div",{target:"e15560op11"})(({theme:t})=>({marginRight:t.spacing.md,color:t.colors.fadedText60})),Zt=u("small",{target:"e15560op12"})(({theme:t})=>({display:"flex",alignItems:"center",maxHeight:t.sizes.smallElementHeight,color:t.colors.fadedText60,"& :hover":{color:t.colors.bodyText}}));function te({children:t,content:e}){const i=N();return n(mt,{content:e,placement:J.TOP,overrides:{Body:{style:{top:`-${i.sizes.minElementHeight}`}}},children:t})}const ee=({fileInfo:t})=>{const e=N(),{type:i}=t.status;switch(i){case"uploading":return n(Ct,{usingCustomTheme:!1,"data-testid":"stChatInputFileIconSpinner",size:"lg",margin:"0",padding:"0"});case"error":return n(te,{content:t.status.errorMessage,children:n(U,{color:e.colors.red,content:nt,size:"lg"})});case"uploaded":return n(U,{content:Et,size:"lg"});default:return yt(i),null}},oe=({fileInfo:t,onDelete:e})=>F(Yt,{className:"stChatInputFile","data-testid":"stChatInputFile",children:[n(qt,{children:n(ee,{fileInfo:t})}),n(Jt,{className:"stChatInputFileName","data-testid":"stChatInputFileName",title:t.name,fileStatus:t.status,children:t.name}),n(Qt,{children:Ft(t.size,$.Byte)}),n(Zt,{"data-testid":"stChatInputDeleteBtn",children:n(Q,{onClick:()=>e(t.id),kind:Z.MINIMAL,children:n(U,{content:zt,size:"lg"})})})]}),ne=r.memo(oe),ae=({items:t,onDelete:e})=>n(Xt,{"data-testid":"stChatUploadedFiles",children:n(Gt,{children:t.map(i=>n(jt,{children:n(ne,{fileInfo:i,onDelete:e})},i.id))})}),re=r.memo(ae),ie=({getNextLocalFileId:t,addFiles:e,updateFile:i,uploadClient:c,element:f,onUploadProgress:p,onUploadComplete:m})=>(x,h)=>{const y=q.CancelToken.source(),g=new et(h.name,h.size,t(),{type:"uploading",cancelToken:y,progress:1});e([g]),c.uploadFile({formId:"",...f},x.uploadUrl,h,d=>p(d,g.id),y.token).then(()=>m(g.id,x)).catch(d=>{q.isCancel(d)||i(g.id,g.setStatus({type:"error",errorMessage:d?d.toString():"Unknown error"}))})},se=({acceptMultipleFiles:t,maxFileSize:e,uploadClient:i,uploadFile:c,addFiles:f,getNextLocalFileId:p,deleteExistingFiles:m,onUploadComplete:x})=>(h,y)=>{if(!t&&h.length===0&&y.length>1){const g=y.findIndex(d=>{var C;return((C=d.errors)==null?void 0:C[0].code)===Ut.TooManyFiles});g>=0&&(h.push(y[g].file),y.splice(g,1))}if(!t&&h.length>0&&m(),i.fetchFileURLs(h).then(g=>{vt(g,h).forEach(([d,C])=>{c(d,C)})}).catch(g=>{f(h.map(d=>new et(d.name,d.size,p(),{type:"error",errorMessage:g})))}),y.length>0){const g=y.map(d=>Tt(d,p(),e));f(g)}x()},le=({getRootProps:t,getInputProps:e,acceptFile:i,disabled:c,theme:f})=>F(Kt,{disabled:c,children:[F(Ot,{"data-testid":"stChatInputFileUploadButton",disabled:c,...t(),children:[n("input",{...e()}),n(It,{content:`Upload or drag and drop ${i===b.Multiple?"files":"a file"}`,placement:J.TOP,onMouseEnterDelay:500,children:n(Q,{kind:Z.MINIMAL,disabled:c,children:n(U,{content:ot,size:"lg",color:c?f.colors.fadedText40:f.colors.fadedText60})})})]}),n(_t,{})]}),de=r.memo(le),ce=({getRootProps:t,getInputProps:e,acceptFile:i,inputHeight:c})=>F(tt,{children:[n(At,{height:c,...t(),children:n("input",{...e()})}),n(Pt,{height:c,children:`Drag and drop ${i===b.Multiple?"files":"a file"} here`})]}),pe=r.memo(ce),ue=6.5,D=1,L=(t,e,i)=>i.map(c=>c.id===t?e:c),M=(t,e)=>e.find(i=>i.id===t);function ge({disabled:t,element:e,widgetMgr:i,fragmentId:c,uploadClient:f}){const p=N(),m=r.useRef(null),x=r.useRef(0),h=r.useRef({minHeight:0,maxHeight:0}),[y,g]=bt(),[d,C]=r.useState(e.default),[z,W]=r.useState(0),[T,rt]=r.useState(!1),[w,S]=r.useState([]),[E,H]=r.useState(!1),B=r.useMemo(()=>w.some(o=>o.status.type==="uploading")?!1:d!==""||w.length>0,[w,d]),I=xt(e.acceptFile),A=Ht(e.maxUploadSizeMb,$.Megabyte,$.Byte),P=r.useCallback(o=>S(a=>[...a,...o]),[]),K=r.useCallback(o=>{S(a=>{const l=M(o,a);return R(l)?a:(l.status.type==="uploading"&&l.status.cancelToken.cancel(),l.status.type==="uploaded"&&l.status.fileUrls.deleteUrl&&f.deleteFile(l.status.fileUrls.deleteUrl),a.filter(s=>s.id!==o))})},[f]),it=()=>{const o=w.filter(a=>a.status.type==="uploaded").map(a=>{const{name:l,size:s,status:v}=a,{fileId:gt,fileUrls:ht}=v;return new wt({fileId:gt,fileUrls:ht,name:l,size:s})});return new St({uploadedFileInfo:o})},O=()=>x.current++,st=se({acceptMultipleFiles:I===b.Multiple,maxFileSize:A,uploadClient:f,uploadFile:ie({getNextLocalFileId:O,addFiles:P,updateFile:(o,a)=>{S(l=>L(o,a,l))},uploadClient:f,element:e,onUploadProgress:(o,a)=>{S(l=>{const s=M(a,l);if(R(s)||s.status.type!=="uploading")return l;const v=Math.round(o.loaded*100/o.total);return s.status.progress===v?l:L(a,s.setStatus({type:"uploading",cancelToken:s.status.cancelToken,progress:v}),l)})},onUploadComplete:(o,a)=>{S(l=>{const s=M(o,l);return R(s)||s.status.type!=="uploading"?l:L(s.id,s.setStatus({type:"uploaded",fileId:a.fileId,fileUrls:a}),l)})}}),addFiles:P,getNextLocalFileId:O,deleteExistingFiles:()=>w.forEach(o=>K(o.id)),onUploadComplete:()=>{m.current&&m.current.focus()}}),{getRootProps:_,getInputProps:X}=Bt({onDrop:st,multiple:I===b.Multiple,accept:Rt(e.fileType),maxSize:A}),lt=()=>{let o=0;const{current:a}=m;if(a){const l=a.placeholder;a.placeholder="",a.style.height="auto",o=a.scrollHeight,a.placeholder=l,a.style.height=""}return o},G=()=>{if(m.current&&m.current.focus(),!B||t)return;const o={data:d,fileUploaderState:it()};i.setChatInputValue(e,o,{fromUi:!0},c),S([]),C(""),W(0)},dt=o=>{const{metaKey:a,ctrlKey:l,shiftKey:s}=o;Lt(o)&&!s&&!l&&!a&&(o.preventDefault(),G())},ct=o=>{const{value:a}=o.target,{maxChars:l}=e;l!==0&&a.length>l||(C(a),W(lt()))};r.useEffect(()=>{if(e.setValue){e.setValue=!1;const o=e.value||"";C(o)}},[e]),r.useLayoutEffect(()=>{if(m.current){const{offsetHeight:o}=m.current;h.current.minHeight=o,h.current.maxHeight=o*ue}},[m]),r.useEffect(()=>{const o=s=>{var v;s.preventDefault(),s.stopPropagation(),!E&&((v=s.dataTransfer)!=null&&v.types.includes("Files"))&&H(!0)},a=s=>{s.preventDefault(),s.stopPropagation(),E&&(s.clientX<=0&&s.clientY<=0||s.clientX>=window.innerWidth&&s.clientY>=window.innerHeight)&&H(!1)},l=s=>{s.preventDefault(),s.stopPropagation(),E&&H(!1)};return window.addEventListener("dragover",o),window.addEventListener("drop",l),window.addEventListener("dragleave",a),()=>{window.removeEventListener("dragover",o),window.removeEventListener("drop",l),window.removeEventListener("dragleave",a)}},[E]),r.useLayoutEffect(()=>{const{minHeight:o}=h.current;rt(z>0&&m.current?Math.abs(z-o)>D:!1)},[z]);const{placeholder:j,maxChars:pt}=e,{maxHeight:Y}=h.current,ut=I!==b.None&&E;return F(tt,{children:[I===b.None?null:n(re,{items:[...w],onDelete:K}),n($t,{className:"stChatInput","data-testid":"stChatInput",ref:g,children:ut?n(pe,{getRootProps:_,getInputProps:X,acceptFile:I,inputHeight:T?`${z+D}px`:p.sizes.minElementHeight}):F(kt,{extended:T,children:[I===b.None?null:n(de,{getRootProps:_,getInputProps:X,acceptFile:I,disabled:t,theme:p}),n(Mt,{inputRef:m,value:d,placeholder:j,onChange:ct,onKeyDown:dt,"aria-label":j,disabled:t,rows:1,overrides:{Root:{style:{minHeight:p.sizes.minElementHeight,outline:"none",borderLeftWidth:"0",borderRightWidth:"0",borderTopWidth:"0",borderBottomWidth:"0",borderTopLeftRadius:"0",borderTopRightRadius:"0",borderBottomRightRadius:"0",borderBottomLeftRadius:"0"}},Input:{props:{"data-testid":"stChatInputTextArea"},style:{lineHeight:p.lineHeights.inputWidget,"::placeholder":{opacity:"0.7"},height:T?`${z+D}px`:"auto",maxHeight:Y?`${Y}px`:"none",paddingLeft:p.spacing.none,paddingBottom:p.spacing.sm,paddingTop:p.spacing.sm,paddingRight:`calc(${p.iconSizes.xl} + 2 * ${p.spacing.sm} + ${p.spacing.sm})`}}}}),y>p.breakpoints.hideWidgetDetails&&n(Wt,{children:n(Dt,{dirty:B,value:d,maxLength:pt,type:"chat",inForm:!1})}),n(Nt,{children:n(Vt,{onClick:G,disabled:!B||t,extended:T,"data-testid":"stChatInputSubmitButton",children:n(U,{content:at,size:"xl",color:"inherit"})})})]})})]})}const xe=r.memo(ge);export{xe as default};
