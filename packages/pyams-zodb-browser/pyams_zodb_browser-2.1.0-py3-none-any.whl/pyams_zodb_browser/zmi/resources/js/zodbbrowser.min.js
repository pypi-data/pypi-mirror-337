"use strict";void 0===window.$&&(window.$=MyAMS.$);const zodbbrowser={filterAll:function(){$(".filter").attr("checked",!0),zodbbrowser.filterHistory(!0)},filterNone:()=>{$(".filter").attr("checked",!1),zodbbrowser.filterHistory()},filterHistory:o=>{const e=$("div.transaction"),r=$(".filter"),t=Array();for(let o=0;o<r.length;o++){const e=r[o];e.checked&&(t["map"+e.name]=e.checked)}for(let r=0;r<e.length;r++){const n=e[r],i=$(n).children("div.diff").children("div.diffitem");let a=0;for(let e=0;e<i.length;e++){"map"+$($(i[e]).children()[0]).text()in t||o?$(i[e]).show():($(i[e]).hide(),a+=1)}let s=null;1===a?s="1 item hidden":a&&(s=a+" items hidden"),$(n).children(".filtered").remove(),s&&$(n).append('<div class="filtered">'+s+"</div>")}},collapseOrExpand:function(o){const e=$(o.currentTarget),r=e.next(),t=e.children("img");r.is(":hidden")?($(t).attr("src",$("#collapseImg").attr("src")),r.slideDown()):($(t).attr("src",$("#expandImg").attr("src")),r.slideUp())},hideItemsIfTooMany:function(){$(".items").each((function(){const o=$(this).children(".expander")[0],e=$(this).children(".collapsible")[0];if(e.childNodes.length>100&&!$(e).is(":hidden")){const r=$(o).children("img");$(r).attr("src",$("#expandImg").attr("src")),$(e).hide()}}))},showGoTo:function(){$("#path").hide(),$("#goto").show(),$("#gotoInput").focus()},hideGoTo:function(){$("#goto").hide(),$("#path").show(),setTimeout((function(){$("#pathError").slideUp()}),50)},ajaxErrorHandler:function(o,e,r){let t="";t='<span class="error"> '+(t="parsererror"===e?"Server returned malformed data":"error"===e?"Unknown error (maybe server is offline?)":"timeout"===e?"Server timeout":"notmodified"===e?"Server error (says resource not modified)":"Unknown error")+"</strong>",$("#pathError").html(t)},ajaxSuccessHandler:function(o,e){o.url?(window.location=o.url,$("#pathError").text("Found.").slideDown().slideUp()):o.error?($("#pathError").text(o.error).show(),o.partial_url&&$("#pathError").append(', would you like to <a href="'+o.partial_url+'">go to '+o.partial_path+"</a> instead?")):$("#pathError").text(e).show()},activateGoTo:function(){const o=$("#gotoInput").val();$("#pathError").text("Loading...").slideDown(),$.ajax({url:"zodbbrowser_path_to_oid",dataType:"json",data:"path="+o,timeout:7e3,success:zodbbrowser.ajaxSuccessHandler,error:zodbbrowser.ajaxErrorHandler})},cancelRollback:function(o){$("#confirmation").remove(),$("div.transaction").removeClass("focus"),$("input.rollbackbtn").show()},pressRollback:function(o){o.preventDefault(),zodbbrowser.cancelRollback(),$(o.target).hide();const e=$(o.target).closest("div.transaction");e.addClass("focus"),$('<div id="confirmation"><form action="" method="post"><div class="message">This is a dangerous operation that may break data integrity. Are you really sure you want to do this?</div><input type="BUTTON" value="Really revert to this state" onclick="zodbbrowser.doRollback()"><input type="BUTTON" value="Cancel" onclick="zodbbrowser.cancelRollback()"></form></div>').appendTo(e)},doRollback:function(){const o=$("#confirmation").closest("div.transaction").find("form.rollback");o.find('input[name="confirmed"]').val("1"),o.submit()},initElement:function(o){const e=$(".zodbbrowser").data("ams-zodbbrowser-css");MyAMS.core.getCSS(e,"zodbbrowser").then(()=>{zodbbrowser.hideItemsIfTooMany(),$("#path a",o).click((function(o){o.stopPropagation()})),$("#path",o).click(zodbbrowser.showGoTo),$("#gotoInput",o).blur(zodbbrowser.hideGoTo),$("#gotoInput",o).keypress((function(o){13===o.which&&zodbbrowser.activateGoTo()})),$("#gotoInput",o).keydown((function(o){27===o.keyCode&&zodbbrowser.hideGoTo()})),$(document).keypress((function(e){103===e.which&&$("#goto",o).is(":hidden")&&(zodbbrowser.showGoTo(),e.preventDefault())})),$("input.rollbackbtn",o).click(zodbbrowser.pressRollback),$("span.truncated",o).click((function(o){o.preventDefault();const e=$(this),r=e.attr("id");$.ajax({url:"zodbbrowser_truncated",data:"id="+r,success:function(o,r){e.replaceWith(o)}})}))})}};window.MyAMS&&(MyAMS.config.modules.push("zodbbrowser"),MyAMS.zodbbrowser=zodbbrowser,console.debug("MyAMS: zodbbrowser module loaded..."));
