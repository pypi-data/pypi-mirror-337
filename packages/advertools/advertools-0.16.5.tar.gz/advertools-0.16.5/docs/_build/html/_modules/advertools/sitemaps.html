<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>advertools.sitemaps &mdash;  Python</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=81998473"></script>
        <script src="../../_static/doctools.js?v=9bcbadda"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
        <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
        <script async="async" src="https://unpkg.com/thebe@0.8.2/lib/index.js"></script>
        <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            advertools
          </a>
              <div class="version">
                0.16.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">About advertools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.survey.html">Survey - your feedback</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.cli.cli.html">Command Line Interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SEM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.kw_generate.html">Generate SEM Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.ad_create.html">Create Text Ads on a Large Scale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.ad_from_string.html">Create Text Ads From Description Text</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SEO</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.robotstxt.html">robots.txt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.sitemaps.html">XML Sitemaps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.spider.html">SEO Spider / Crawler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.code_recipes.spider_strategies.html">Crawl Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.crawlytics.html">Crawl Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.header_spider.html">Crawl headers (HEAD method only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.image_spider.html">Crawl images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.logs.html">Python Log File Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.logs.html#parse-and-analyze-crawl-logs-in-a-dataframe">Parse and Analyze Crawl Logs in a Dataframe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.reverse_dns_lookup.html">Reverse DNS Lookup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.serp.html">Analyze Search Engine Results (SERPs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.knowledge_graph.html">Google's Knowledge Graph</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Text &amp; Content Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.urlytics.html">URL Structure Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.emoji.html">Emoji Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.extract.html">Extract Structured Entities from Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.stopwords.html">Stop Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.word_frequency.html">Text Analysis (absolute &amp; weighted word frequency)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.word_tokenize.html">Word Tokenization (N-grams)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Social Media</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.twitter.html">Twitter Data API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.youtube.html">YouTube Data API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Index &amp; Change Log</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../include_changelog.html">Index &amp; Change Log</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">advertools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">advertools.sitemaps</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for advertools.sitemaps</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. _sitemaps:</span>

<span class="sd">Download, Parse, and Analyze XML Sitemaps</span>
<span class="sd">=========================================</span>

<span class="sd">One of the fastest and easiest ways to get insights on a website&#39;s content is</span>
<span class="sd">to simply download its XML sitemap(s).</span>

<span class="sd">Sitemaps are also important SEO tools as they reveal a lot of information about</span>
<span class="sd">the website, and help search engines in indexing those pages. You might want to</span>
<span class="sd">run an SEO audit and check if the URLs in the sitemap properly correspond to</span>
<span class="sd">the actual URLs of the site, so this would be an easy way to get them.</span>

<span class="sd">Sitemaps basically contain a log of publishing activity, and if they have rich</span>
<span class="sd">URLs then you can do some good analysis on their content over time as well.</span>

<span class="sd">The :func:`sitemap_to_df` function is very simple to use, and only requires the</span>
<span class="sd">URL of a sitemap, a sitemap index, or even a robots.txt file. It goes through</span>
<span class="sd">the sitemap(s) and returns a DataFrame containing all the tags and their</span>
<span class="sd">information.</span>

<span class="sd">*  `loc`: The location of the URLs of hte sitemaps.</span>
<span class="sd">*  `lastmod`: The datetime of the date when each URL was last modified, if</span>
<span class="sd">   available.</span>
<span class="sd">*  `sitemap`: The URL of the sitemap from which the URL on this row was</span>
<span class="sd">   retreived.</span>
<span class="sd">*  `etag`: The entity tag of the response header, if provided.</span>
<span class="sd">*  `sitemap_last_modified`: The datetime when the sitemap file was last</span>
<span class="sd">   modified, if provided.</span>
<span class="sd">*  `sitemap_size_mb`: The size of the sitemap in mega bytes</span>
<span class="sd">   (1MB = 1,024 x 1,024 bytes)</span>
<span class="sd">*  `download_date`: The datetime when the sitemap was downloaded.</span>

<span class="sd">Sitemap Index</span>
<span class="sd">-------------</span>
<span class="sd">Large websites typically have a sitmeapindex file, which contains links to all</span>
<span class="sd">other regular sitemaps that belong to the site. The :func:`sitemap_to_df`</span>
<span class="sd">function retreives all sub-sitemaps recursively by default.</span>
<span class="sd">In some cases, especially with very large sites, it might be better to first</span>
<span class="sd">get the sitemap index, explore its structure, and then decide which sitemaps</span>
<span class="sd">you want to get, or if you want them all. Even with smaller websites, it still</span>
<span class="sd">might be interesting to get the index only and see how it is structured.</span>

<span class="sd">This behavior can be modified by the ``recursive`` parameter, which is set to</span>
<span class="sd">`True` by default. Set it to `False` if you want only the index file.</span>

<span class="sd">Another interesting thing you might want to do is to provide a robots.txt URL,</span>
<span class="sd">and set `recursive=False` to get all available sitemap index files.</span>

<span class="sd">&gt;&gt;&gt; sitemap_to_df(&quot;https://example.com/robots.txt&quot;, recursive=False)</span>

<span class="sd">Let&#39;s now go through a quick example of what can be done with sitemaps. We can</span>
<span class="sd">start by getting one of the BBC&#39;s sitemaps.</span>

<span class="sd">Regular XML Sitemaps</span>
<span class="sd">--------------------</span>

<span class="sd">.. thebe-button::</span>
<span class="sd">    Run this code</span>

<span class="sd">.. code-block::</span>
<span class="sd">    :class: thebe, thebe-init</span>

<span class="sd">    import advertools as adv</span>

<span class="sd">    bbc_sitemap = adv.sitemap_to_df(&#39;https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml&#39;)</span>
<span class="sd">    bbc_sitemap.head(10)</span>

<span class="sd">====  =============================================================================  =========================  ============================================================  ================================  =========================  =================  ================================</span>
<span class="sd">  ..  loc                                                                            lastmod                    sitemap                                                       etag                              sitemap_last_modified        sitemap_size_mb  download_date</span>
<span class="sd">====  =============================================================================  =========================  ============================================================  ================================  =========================  =================  ================================</span>
<span class="sd">   0  https://www.bbc.com/arabic/middleeast/2009/06/090620_as_iraq_explosion_tc2     2009-06-20 14:10:48+00:00  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml  e7e15811c65f406f89f89fe10aef29f5  2021-11-05 20:52:56+00:00            7.63124  2022-02-12 01:37:39.461037+00:00</span>
<span class="sd">   1  https://www.bbc.com/arabic/middleeast/2009/06/090620_iraq_blast_tc2            2009-06-20 21:07:43+00:00  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml  e7e15811c65f406f89f89fe10aef29f5  2021-11-05 20:52:56+00:00            7.63124  2022-02-12 01:37:39.461037+00:00</span>
<span class="sd">   2  https://www.bbc.com/arabic/business/2009/06/090622_me_worldbank_tc2            2009-06-22 12:41:48+00:00  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml  e7e15811c65f406f89f89fe10aef29f5  2021-11-05 20:52:56+00:00            7.63124  2022-02-12 01:37:39.461037+00:00</span>
<span class="sd">   3  https://www.bbc.com/arabic/multimedia/2009/06/090624_me_inpictures_brazil_tc2  2009-06-24 15:27:24+00:00  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml  e7e15811c65f406f89f89fe10aef29f5  2021-11-05 20:52:56+00:00            7.63124  2022-02-12 01:37:39.461037+00:00</span>
<span class="sd">   4  https://www.bbc.com/arabic/business/2009/06/090618_tomtest                     2009-06-18 15:32:54+00:00  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml  e7e15811c65f406f89f89fe10aef29f5  2021-11-05 20:52:56+00:00            7.63124  2022-02-12 01:37:39.461037+00:00</span>
<span class="sd">   5  https://www.bbc.com/arabic/multimedia/2009/06/090625_sf_tamim_verdict_tc2      2009-06-25 09:46:39+00:00  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml  e7e15811c65f406f89f89fe10aef29f5  2021-11-05 20:52:56+00:00            7.63124  2022-02-12 01:37:39.461037+00:00</span>
<span class="sd">   6  https://www.bbc.com/arabic/middleeast/2009/06/090623_iz_cairo_russia_tc2       2009-06-23 13:10:56+00:00  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml  e7e15811c65f406f89f89fe10aef29f5  2021-11-05 20:52:56+00:00            7.63124  2022-02-12 01:37:39.461037+00:00</span>
<span class="sd">   7  https://www.bbc.com/arabic/sports/2009/06/090622_me_egypt_us_tc2               2009-06-22 15:37:07+00:00  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml  e7e15811c65f406f89f89fe10aef29f5  2021-11-05 20:52:56+00:00            7.63124  2022-02-12 01:37:39.461037+00:00</span>
<span class="sd">   8  https://www.bbc.com/arabic/sports/2009/06/090624_mz_wimbledon_tc2              2009-06-24 13:57:18+00:00  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml  e7e15811c65f406f89f89fe10aef29f5  2021-11-05 20:52:56+00:00            7.63124  2022-02-12 01:37:39.461037+00:00</span>
<span class="sd">   9  https://www.bbc.com/arabic/worldnews/2009/06/090623_mz_leaders_lifespan_tc2    2009-06-23 13:24:23+00:00  https://www.bbc.com/sitemaps/https-sitemap-com-archive-1.xml  e7e15811c65f406f89f89fe10aef29f5  2021-11-05 20:52:56+00:00            7.63124  2022-02-12 01:37:39.461037+00:00</span>
<span class="sd">====  =============================================================================  =========================  ============================================================  ================================  =========================  =================  ================================</span>

<span class="sd">.. thebe-button::</span>
<span class="sd">    Run this code</span>

<span class="sd">.. code-block::</span>
<span class="sd">    :class: thebe, thebe-init</span>

<span class="sd">    print(bbc_sitemap.shape)</span>
<span class="sd">    print(bbc_sitemap.dtypes)</span>

<span class="sd">.. code-block::</span>

<span class="sd">    (49999, 7)</span>

<span class="sd">    loc                                   object</span>
<span class="sd">    lastmod                  datetime64[ns, UTC]</span>
<span class="sd">    sitemap                               object</span>
<span class="sd">    etag                                  object</span>
<span class="sd">    sitemap_last_modified    datetime64[ns, UTC]</span>
<span class="sd">    sitemap_size_mb                      float64</span>
<span class="sd">    download_date            datetime64[ns, UTC]</span>
<span class="sd">    dtype: object</span>

<span class="sd">Since ``lastmod`` is a ``datetime`` object, we can easily use it for various</span>
<span class="sd">time-related operations.</span>
<span class="sd">Here we look at how many articles have been published (last modified) per year.</span>

<span class="sd">.. thebe-button::</span>
<span class="sd">    Run this code</span>

<span class="sd">.. code-block::</span>
<span class="sd">    :class: thebe, thebe-init</span>

<span class="sd">    bbc_sitemap.set_index(&#39;lastmod&#39;).resample(&#39;A&#39;)[&#39;loc&#39;].count()</span>

<span class="sd">.. code-block::</span>

<span class="sd">    lastmod</span>
<span class="sd">    2008-12-31 00:00:00+00:00     2287</span>
<span class="sd">    2009-12-31 00:00:00+00:00    47603</span>
<span class="sd">    2010-12-31 00:00:00+00:00        0</span>
<span class="sd">    2011-12-31 00:00:00+00:00        0</span>
<span class="sd">    2012-12-31 00:00:00+00:00        0</span>
<span class="sd">    2013-12-31 00:00:00+00:00        0</span>
<span class="sd">    2014-12-31 00:00:00+00:00        0</span>
<span class="sd">    2015-12-31 00:00:00+00:00        0</span>
<span class="sd">    2016-12-31 00:00:00+00:00        0</span>
<span class="sd">    2017-12-31 00:00:00+00:00        0</span>
<span class="sd">    2018-12-31 00:00:00+00:00        0</span>
<span class="sd">    2019-12-31 00:00:00+00:00       99</span>
<span class="sd">    2020-12-31 00:00:00+00:00       10</span>
<span class="sd">    Freq: A-DEC, Name: loc, dtype: int64</span>

<span class="sd">As the majority are in 2009 with a few in other years, it seems these were</span>
<span class="sd">later updated, but we would have to check to verify (in this special case BBC&#39;s</span>
<span class="sd">URLs contain date information, which can be compared to ``lastmod`` to check if</span>
<span class="sd">there is a difference between them).</span>

<span class="sd">We can take a look at a sample of the URLs to get the URL template that they</span>
<span class="sd">use.</span>

<span class="sd">.. thebe-button::</span>
<span class="sd">    Run this code</span>

<span class="sd">.. code-block::</span>
<span class="sd">    :class: thebe, thebe-init</span>

<span class="sd">    bbc_sitemap[&#39;loc&#39;].sample(10).tolist()</span>

<span class="sd">.. code-block::</span>

<span class="sd">    [&#39;https://www.bbc.com/russian/rolling_news/2009/06/090628_rn_pakistani_soldiries_ambush&#39;,</span>
<span class="sd">    &#39;https://www.bbc.com/urdu/pakistan/2009/04/090421_mqm_speaks_rza&#39;,</span>
<span class="sd">    &#39;https://www.bbc.com/arabic/middleeast/2009/07/090723_ae_silwan_tc2&#39;,</span>
<span class="sd">    &#39;https://www.bbc.com/portuguese/noticias/2009/07/090729_iraquerefenbritsfn&#39;,</span>
<span class="sd">    &#39;https://www.bbc.com/portuguese/noticias/2009/06/090623_egitomilitaresfn&#39;,</span>
<span class="sd">    &#39;https://www.bbc.com/portuguese/noticias/2009/03/090302_gazaconferenciaml&#39;,</span>
<span class="sd">    &#39;https://www.bbc.com/portuguese/noticias/2009/07/090715_hillary_iran_cq&#39;,</span>
<span class="sd">    &#39;https://www.bbc.com/vietnamese/culture/2009/04/090409_machienhuu_revisiting&#39;,</span>
<span class="sd">    &#39;https://www.bbc.com/portuguese/noticias/2009/05/090524_paquistaoupdateg&#39;,</span>
<span class="sd">    &#39;https://www.bbc.com/arabic/worldnews/2009/06/090629_om_pakistan_report_tc2&#39;]</span>

<span class="sd">It seems the pattern is</span>

<span class="sd">    **https://www.bbc.com/{language}/{topic}/{YYYY}/{MM}/{YYMMDD_article_title}**</span>

<span class="sd">This is quite a rich structure, full of useful information. We can</span>
<span class="sd">:ref:`analyze the URL structure &lt;urlytics&gt;` using the ``url_to_df`` function:</span>

<span class="sd">.. thebe-button::</span>
<span class="sd">    Run this code</span>

<span class="sd">.. code-block::</span>
<span class="sd">    :class: thebe, thebe-init</span>

<span class="sd">    url_df = adv.url_to_df(bbc_sitemap[&#39;loc&#39;])</span>
<span class="sd">    url_df</span>

<span class="sd">=====  =============================================================================  ========  ===========  ==========================================================  =======  ==========  ==========  ==========  =======  =======  ===============================  =======  =======  ===============================</span>
<span class="sd">   ..  url                                                                            scheme    netloc       path                                                        query    fragment    dir_1       dir_2         dir_3    dir_4  dir_5                              dir_6    dir_7  last_dir</span>
<span class="sd">=====  =============================================================================  ========  ===========  ==========================================================  =======  ==========  ==========  ==========  =======  =======  ===============================  =======  =======  ===============================</span>
<span class="sd">    0  https://www.bbc.com/arabic/middleeast/2009/06/090620_as_iraq_explosion_tc2     https     www.bbc.com  /arabic/middleeast/2009/06/090620_as_iraq_explosion_tc2                          arabic      middleeast     2009       06  090620_as_iraq_explosion_tc2         nan      nan  090620_as_iraq_explosion_tc2</span>
<span class="sd">    1  https://www.bbc.com/arabic/middleeast/2009/06/090620_iraq_blast_tc2            https     www.bbc.com  /arabic/middleeast/2009/06/090620_iraq_blast_tc2                                 arabic      middleeast     2009       06  090620_iraq_blast_tc2                nan      nan  090620_iraq_blast_tc2</span>
<span class="sd">    2  https://www.bbc.com/arabic/business/2009/06/090622_me_worldbank_tc2            https     www.bbc.com  /arabic/business/2009/06/090622_me_worldbank_tc2                                 arabic      business       2009       06  090622_me_worldbank_tc2              nan      nan  090622_me_worldbank_tc2</span>
<span class="sd">    3  https://www.bbc.com/arabic/multimedia/2009/06/090624_me_inpictures_brazil_tc2  https     www.bbc.com  /arabic/multimedia/2009/06/090624_me_inpictures_brazil_tc2                       arabic      multimedia     2009       06  090624_me_inpictures_brazil_tc2      nan      nan  090624_me_inpictures_brazil_tc2</span>
<span class="sd">    4  https://www.bbc.com/arabic/business/2009/06/090618_tomtest                     https     www.bbc.com  /arabic/business/2009/06/090618_tomtest                                          arabic      business       2009       06  090618_tomtest                       nan      nan  090618_tomtest</span>
<span class="sd">49994  https://www.bbc.com/vietnamese/world/2009/08/090831_dalailamataiwan            https     www.bbc.com  /vietnamese/world/2009/08/090831_dalailamataiwan                                 vietnamese  world          2009       08  090831_dalailamataiwan               nan      nan  090831_dalailamataiwan</span>
<span class="sd">49995  https://www.bbc.com/vietnamese/world/2009/09/090901_putin_regret_pact          https     www.bbc.com  /vietnamese/world/2009/09/090901_putin_regret_pact                               vietnamese  world          2009       09  090901_putin_regret_pact             nan      nan  090901_putin_regret_pact</span>
<span class="sd">49996  https://www.bbc.com/vietnamese/culture/2009/09/090901_tiananmen_movie          https     www.bbc.com  /vietnamese/culture/2009/09/090901_tiananmen_movie                               vietnamese  culture        2009       09  090901_tiananmen_movie               nan      nan  090901_tiananmen_movie</span>
<span class="sd">49997  https://www.bbc.com/vietnamese/pictures/2009/08/090830_ugc_ddh_sand            https     www.bbc.com  /vietnamese/pictures/2009/08/090830_ugc_ddh_sand                                 vietnamese  pictures       2009       08  090830_ugc_ddh_sand                  nan      nan  090830_ugc_ddh_sand</span>
<span class="sd">49998  https://www.bbc.com/vietnamese/business/2009/09/090901_japecontask             https     www.bbc.com  /vietnamese/business/2009/09/090901_japecontask                                  vietnamese  business       2009       09  090901_japecontask                   nan      nan  090901_japecontask</span>
<span class="sd">=====  =============================================================================  ========  ===========  ==========================================================  =======  ==========  ==========  ==========  =======  =======  ===============================  =======  =======  ===============================</span>

<span class="sd">It seems that the ``dir_1`` is where they have the language information, so we</span>
<span class="sd">can easily count how many articles they have per language:</span>

<span class="sd">.. thebe-button::</span>
<span class="sd">    Run this code</span>

<span class="sd">.. code-block::</span>
<span class="sd">    :class: thebe, thebe-init</span>

<span class="sd">    url_df[&#39;dir_1&#39;].value_counts()</span>

<span class="sd">.. code-block::</span>

<span class="sd">    russian       14022</span>
<span class="sd">    persian       10968</span>
<span class="sd">    portuguese     5403</span>
<span class="sd">    urdu           5068</span>
<span class="sd">    mundo          5065</span>
<span class="sd">    vietnamese     3561</span>
<span class="sd">    arabic         2984</span>
<span class="sd">    hindi          1677</span>
<span class="sd">    turkce          706</span>
<span class="sd">    ukchina         545</span>
<span class="sd">    Name: dir_1, dtype: int64</span>

<span class="sd">We can also get a subset of articles written in a certain language, and see how</span>
<span class="sd">many articles they publish per month, week, year, etc.</span>

<span class="sd">.. thebe-button::</span>
<span class="sd">    Run this code</span>

<span class="sd">.. code-block::</span>
<span class="sd">    :class: thebe, thebe-init</span>

<span class="sd">    (bbc_sitemap[bbc_sitemap[&#39;loc&#39;]</span>
<span class="sd">     .str.contains(&#39;/russian/&#39;)]</span>
<span class="sd">     .set_index(&#39;lastmod&#39;)</span>
<span class="sd">     .resample(&#39;M&#39;)[&#39;loc&#39;].count())</span>

<span class="sd">.. code-block::</span>

<span class="sd">    lastmod</span>
<span class="sd">    2009-04-30 00:00:00+00:00    1506</span>
<span class="sd">    2009-05-31 00:00:00+00:00    2910</span>
<span class="sd">    2009-06-30 00:00:00+00:00    3021</span>
<span class="sd">    2009-07-31 00:00:00+00:00    3250</span>
<span class="sd">    2009-08-31 00:00:00+00:00    2769</span>
<span class="sd">                                 ...</span>
<span class="sd">    2019-09-30 00:00:00+00:00       8</span>
<span class="sd">    2019-10-31 00:00:00+00:00      17</span>
<span class="sd">    2019-11-30 00:00:00+00:00      11</span>
<span class="sd">    2019-12-31 00:00:00+00:00      24</span>
<span class="sd">    2020-01-31 00:00:00+00:00       6</span>
<span class="sd">    Freq: M, Name: loc, Length: 130, dtype: int64</span>

<span class="sd">The topic or category of the article seems to be in ``dir_2`` for which we can</span>
<span class="sd">do the same and count the values.</span>

<span class="sd">.. thebe-button::</span>
<span class="sd">    Run this code</span>

<span class="sd">.. code-block::</span>
<span class="sd">    :class: thebe, thebe-init</span>

<span class="sd">    url_df[&#39;dir_2&#39;].value_counts()[:20]</span>

<span class="sd">.. code-block::</span>

<span class="sd">    rolling_news        9044</span>
<span class="sd">    world               5050</span>
<span class="sd">    noticias            4224</span>
<span class="sd">    iran                3682</span>
<span class="sd">    pakistan            2103</span>
<span class="sd">    afghanistan         1959</span>
<span class="sd">    multimedia          1657</span>
<span class="sd">    internacional       1555</span>
<span class="sd">    sport               1350</span>
<span class="sd">    international       1293</span>
<span class="sd">    india               1285</span>
<span class="sd">    america_latina      1274</span>
<span class="sd">    business            1204</span>
<span class="sd">    cultura_sociedad     913</span>
<span class="sd">    middleeast           874</span>
<span class="sd">    worldnews            872</span>
<span class="sd">    russia               841</span>
<span class="sd">    radio                769</span>
<span class="sd">    science              755</span>
<span class="sd">    football             674</span>
<span class="sd">    Name: dir_2, dtype: int64</span>

<span class="sd">There is much more you can do, and a lot depends on the URL structure, which</span>
<span class="sd">you have to explore and run the right operation.</span>

<span class="sd">For example, we can use the ``last_dir`` column which contains the slugs</span>
<span class="sd">of the articles, replace underscores with spaces, split, concatenate all, put</span>
<span class="sd">in a ``pd.Series`` and count the values. This way we see how many times each</span>
<span class="sd">word occurred in an article. The same code can also be run after filtering for</span>
<span class="sd">articles in a particular language to get a more meaningful list of words.</span>

<span class="sd">.. thebe-button::</span>
<span class="sd">    Run this code</span>

<span class="sd">.. code-block::</span>
<span class="sd">    :class: thebe, thebe-init</span>

<span class="sd">    url_df[&#39;last_dir&#39;].str.split(&#39;_&#39;).str[1:].explode().value_counts()[:20]</span>

<span class="sd">.. code-block::</span>

<span class="sd">    rn          8808</span>
<span class="sd">    tc2         3153</span>
<span class="sd">    iran        1534</span>
<span class="sd">    video        973</span>
<span class="sd">    obama        882</span>
<span class="sd">    us           862</span>
<span class="sd">    china        815</span>
<span class="sd">    ir88         727</span>
<span class="sd">    russia       683</span>
<span class="sd">    si           640</span>
<span class="sd">    np           638</span>
<span class="sd">    afghan       632</span>
<span class="sd">    ka           565</span>
<span class="sd">    an           556</span>
<span class="sd">    iraq         554</span>
<span class="sd">    pakistan     547</span>
<span class="sd">    nh           533</span>
<span class="sd">    cq           520</span>
<span class="sd">    zs           510</span>
<span class="sd">    ra           491</span>
<span class="sd">    Name: last_dir, dtype: int64</span>

<span class="sd">This was a quick overview and data preparation for a sample sitemap. Once you</span>
<span class="sd">are familiar with the sitemap&#39;s structure, you can more easily start analyzing</span>
<span class="sd">the content.</span>

<span class="sd">.. note::</span>

<span class="sd">    There is a bug currently with tags that contain multiple values in</span>
<span class="sd">    sitemaps. If an image column in a news sitemap contains multiple images,</span>
<span class="sd">    only the last one is retreived. The same applies for any other sitemap that</span>
<span class="sd">    has a tag with multiple values.</span>


<span class="sd">News Sitemaps</span>
<span class="sd">-------------</span>

<span class="sd">.. thebe-button::</span>
<span class="sd">    Run this code</span>

<span class="sd">.. code-block::</span>
<span class="sd">    :class: thebe, thebe-init</span>

<span class="sd">    nyt_news = adv.sitemap_to_df(&#39;https://www.nytimes.com/sitemaps/new/news.xml.gz&#39;)</span>
<span class="sd">    print(nyt_news.shape)</span>
<span class="sd">    # (5085, 16)</span>
<span class="sd">    nyt_news</span>

<span class="sd">====  =======================================================================================================  =========================  ======  ==================  ==================  ======================  =======================  ====================================================================================  ========================================================================================================================  =======  ==================================================================================================================================================================================  ==================================================  ================================  =========================  =================  ================================</span>
<span class="sd">  ..  loc                                                                                                      lastmod                    news    news_publication    publication_name    publication_language    news_publication_date    news_title                                                                            news_keywords                                                                                                             image    image_loc                                                                                                                                                                           sitemap                                             etag                              sitemap_last_modified        sitemap_size_mb  download_date</span>
<span class="sd">====  =======================================================================================================  =========================  ======  ==================  ==================  ======================  =======================  ====================================================================================  ========================================================================================================================  =======  ==================================================================================================================================================================================  ==================================================  ================================  =========================  =================  ================================</span>
<span class="sd">   0  https://www.nytimes.com/interactive/2021/us/ottawa-ohio-covid-cases.html                                 2022-02-12 00:00:00+00:00                              The New York Times  en                      2021-01-27T17:00:00Z     Ottawa County, Ohio Covid Case and Exposure Risk Tracker                              Coronavirus (2019-nCoV), States (US), Deaths (Fatalities), United States, Disease Rates                                            https://static01.nyt.com/images/2020/03/29/us/ohio-coronavirus-cases-promo-1585539358901/ohio-coronavirus-cases-promo-1585539358901-articleLarge-v274.png                           https://www.nytimes.com/sitemaps/new/news-6.xml.gz  0cff645fbb74c21791568b78a888967d  2022-02-12 20:17:31+00:00          0.0774069  2022-02-12 20:18:39.744247+00:00</span>
<span class="sd">   1  https://www.nytimes.com/interactive/2021/us/hopewell-virginia-covid-cases.html                           2022-02-12 00:00:00+00:00                              The New York Times  en                      2021-01-27T17:00:00Z     Hopewell, Virginia Covid Case and Exposure Risk Tracker                               Coronavirus (2019-nCoV), States (US), Deaths (Fatalities), United States, Disease Rates                                            https://static01.nyt.com/images/2020/03/29/us/virginia-coronavirus-cases-promo-1585539536519/virginia-coronavirus-cases-promo-1585539536519-articleLarge-v271.png                   https://www.nytimes.com/sitemaps/new/news-6.xml.gz  0cff645fbb74c21791568b78a888967d  2022-02-12 20:17:31+00:00          0.0774069  2022-02-12 20:18:39.744247+00:00</span>
<span class="sd">   2  https://www.nytimes.com/interactive/2021/us/box-butte-nebraska-covid-cases.html                          2022-02-12 00:00:00+00:00                              The New York Times  en                      2021-01-27T17:00:00Z     Box Butte County, Nebraska Covid Case and Exposure Risk Tracker                       Coronavirus (2019-nCoV), States (US), Deaths (Fatalities), United States, Disease Rates                                            https://static01.nyt.com/images/2020/03/29/us/nebraska-coronavirus-cases-promo-1585539237156/nebraska-coronavirus-cases-promo-1585539237156-articleLarge-v281.png                   https://www.nytimes.com/sitemaps/new/news-6.xml.gz  0cff645fbb74c21791568b78a888967d  2022-02-12 20:17:31+00:00          0.0774069  2022-02-12 20:18:39.744247+00:00</span>
<span class="sd">   3  https://www.nytimes.com/interactive/2021/us/stearns-minnesota-covid-cases.html                           2022-02-12 00:00:00+00:00                              The New York Times  en                      2021-01-27T17:00:00Z     Stearns County, Minnesota Covid Case and Exposure Risk Tracker                        Coronavirus (2019-nCoV), States (US), Deaths (Fatalities), United States, Disease Rates                                            https://static01.nyt.com/images/2020/03/29/us/minnesota-coronavirus-cases-promo-1585539172701/minnesota-coronavirus-cases-promo-1585539172701-articleLarge-v282.png                 https://www.nytimes.com/sitemaps/new/news-6.xml.gz  0cff645fbb74c21791568b78a888967d  2022-02-12 20:17:31+00:00          0.0774069  2022-02-12 20:18:39.744247+00:00</span>
<span class="sd">   4  https://www.nytimes.com/interactive/2021/us/benton-iowa-covid-cases.html                                 2022-02-12 00:00:00+00:00                              The New York Times  en                      2021-01-27T17:00:00Z     Benton County, Iowa Covid Case and Exposure Risk Tracker                              Coronavirus (2019-nCoV), States (US), Deaths (Fatalities), United States, Disease Rates                                            https://static01.nyt.com/images/2020/03/29/us/iowa-coronavirus-cases-promo-1585539039190/iowa-coronavirus-cases-promo-1585539039190-articleLarge-v286.png                           https://www.nytimes.com/sitemaps/new/news-6.xml.gz  0cff645fbb74c21791568b78a888967d  2022-02-12 20:17:31+00:00          0.0774069  2022-02-12 20:18:39.744247+00:00</span>
<span class="sd">5080  https://www.nytimes.com/interactive/2021/us/hodgeman-kansas-covid-cases.html                             2022-02-12 00:00:00+00:00                              The New York Times  en                      2021-01-27T17:00:00Z     Hodgeman County, Kansas Covid Case and Exposure Risk Tracker                          Coronavirus (2019-nCoV), States (US), Deaths (Fatalities), United States, Disease Rates                                            https://static01.nyt.com/images/2020/03/29/us/kansas-coronavirus-cases-promo-1585539054298/kansas-coronavirus-cases-promo-1585539054298-articleLarge-v285.png                       https://www.nytimes.com/sitemaps/new/news-2.xml.gz  f53301c8286f9bf59ef297f0232dcfc1  2022-02-12 20:17:31+00:00          0.914107   2022-02-12 20:18:39.995323+00:00</span>
<span class="sd">5081  https://www.nytimes.com/interactive/2021/us/miller-georgia-covid-cases.html                              2022-02-12 00:00:00+00:00                              The New York Times  en                      2021-01-27T17:00:00Z     Miller County, Georgia Covid Case and Exposure Risk Tracker                           Coronavirus (2019-nCoV), States (US), Deaths (Fatalities), United States, Disease Rates                                            https://static01.nyt.com/images/2020/03/29/us/georgia-coronavirus-cases-promo-1585538956622/georgia-coronavirus-cases-promo-1585538956622-articleLarge-v290.png                     https://www.nytimes.com/sitemaps/new/news-2.xml.gz  f53301c8286f9bf59ef297f0232dcfc1  2022-02-12 20:17:31+00:00          0.914107   2022-02-12 20:18:39.995323+00:00</span>
<span class="sd">5082  https://www.nytimes.com/interactive/2020/11/03/us/elections/results-west-virginia-house-district-1.html  2022-02-12 00:00:00+00:00                              The New York Times  en                      2020-11-03T17:00:00Z     West Virginia First Congressional District Results: David McKinley vs. Natalie Cline  Elections, Presidential Election of 2020, United States, internal-election-open, House of Representatives, West Virginia           https://static01.nyt.com/images/2020/11/03/us/elections/eln-promo-race-west-virginia-house-1WINNER-mckinleyd/eln-promo-race-west-virginia-house-1WINNER-mckinleyd-articleLarge.png  https://www.nytimes.com/sitemaps/new/news-2.xml.gz  f53301c8286f9bf59ef297f0232dcfc1  2022-02-12 20:17:31+00:00          0.914107   2022-02-12 20:18:39.995323+00:00</span>
<span class="sd">5083  https://www.nytimes.com/interactive/2020/11/03/us/elections/results-maine-senate.html                    2022-02-12 00:00:00+00:00                              The New York Times  en                      2020-11-03T17:00:00Z     Maine Senate Results: Susan Collins Defeats Sara Gideon                               Elections, Presidential Election of 2020, United States, internal-election-open, Senate, Maine                                     https://static01.nyt.com/images/2020/11/03/us/elections/eln-promo-race-maine-senateWINNER-collinss/eln-promo-race-maine-senateWINNER-collinss-articleLarge.png                      https://www.nytimes.com/sitemaps/new/news-2.xml.gz  f53301c8286f9bf59ef297f0232dcfc1  2022-02-12 20:17:31+00:00          0.914107   2022-02-12 20:18:39.995323+00:00</span>
<span class="sd">5084  https://www.nytimes.com/interactive/2021/us/randolph-missouri-covid-cases.html                           2022-02-12 00:00:00+00:00                              The New York Times  en                      2021-01-27T17:00:00Z     Randolph County, Missouri Covid Case and Exposure Risk Tracker                        Coronavirus (2019-nCoV), States (US), Deaths (Fatalities), United States, Disease Rates                                            https://static01.nyt.com/images/2020/03/29/us/missouri-coronavirus-cases-promo-1585539206866/missouri-coronavirus-cases-promo-1585539206866-articleLarge-v282.png                   https://www.nytimes.com/sitemaps/new/news-2.xml.gz  f53301c8286f9bf59ef297f0232dcfc1  2022-02-12 20:17:31+00:00          0.914107   2022-02-12 20:18:39.995323+00:00</span>
<span class="sd">====  =======================================================================================================  =========================  ======  ==================  ==================  ======================  =======================  ====================================================================================  ========================================================================================================================  =======  ==================================================================================================================================================================================  ==================================================  ================================  =========================  =================  ================================</span>

<span class="sd">Video Sitemaps</span>
<span class="sd">--------------</span>

<span class="sd">.. thebe-button::</span>
<span class="sd">    Run this code</span>

<span class="sd">.. code-block::</span>
<span class="sd">    :class: thebe, thebe-init</span>

<span class="sd">    wired_video = adv.sitemap_to_df(&#39;https://www.wired.com/video/sitemap.xml&#39;)</span>
<span class="sd">    print(wired_video.shape)</span>
<span class="sd">    # (2955, 14)</span>
<span class="sd">    wired_video</span>

<span class="sd">====  ==============================================================================================================  =======  ======================================================================================================================================================================================================================================  ==============================================================================  ==========================================================================================================================================================================================================================================================================================================================================  ========================================================================================================  ================  =========================  =======================  =========  =======================================  ==================================  =================  ================================</span>
<span class="sd">  ..  loc                                                                                                             video    video_thumbnail_loc                                                                                                                                                                                                                     video_title                                                                     video_description                                                                                                                                                                                                                                                                                                                           video_content_loc                                                                                           video_duration  video_publication_date       video_expiration_date  lastmod    sitemap                                  etag                                  sitemap_size_mb  download_date</span>
<span class="sd">====  ==============================================================================================================  =======  ======================================================================================================================================================================================================================================  ==============================================================================  ==========================================================================================================================================================================================================================================================================================================================================  ========================================================================================================  ================  =========================  =======================  =========  =======================================  ==================================  =================  ================================</span>
<span class="sd">   0  https://www.wired.com/video/watch/autocomplete-inverviews-owen-wilson-answers-the-webs-most-searched-questions           http://dwgyu36up6iuz.cloudfront.net/heru80fdn/image/upload/c_fill,d_placeholder_thescene.jpg,fl_progressive,g_face,h_180,q_80,w_320/v1644595412/wired_autocomplete-inverviews-owen-wilson-answers-the-webs-most-searched-questions.jpg  Autocomplete Interview - Owen Wilson Answers The Web’s Most Searched Questions  Owen Wilson takes the WIRED Autocomplete Interview and answers the internet&#39;s most searched questions about himself. How did Owen Wilson break his nose? How many movies is he in with Ben Stiller? Is Owen in every Wes Anderson movie? Is he a good skateboarder? Owen answers all these questions and much more!                         http://dp8hsntg6do36.cloudfront.net/62067f085577c277dd9acf42/39687acb-505b-4c69-94f1-afaa7cb5e636low.mp4               645  2022-02-11T17:00:00+00:00                      nan  NaT        https://www.wired.com/video/sitemap.xml  W/90b11f47f8b2ab57cb180cbd3c6f06f9            2.86199  2022-02-12 20:24:55.841851+00:00</span>
<span class="sd">   1  https://www.wired.com/video/watch/wired-news-and-science-samsung-s22                                                     http://dwgyu36up6iuz.cloudfront.net/heru80fdn/image/upload/c_fill,d_placeholder_thescene.jpg,fl_progressive,g_face,h_180,q_80,w_320/v1644418652/wired_wired-news-and-science-samsung-s22.jpg                                            Currents - Samsung S22 Ultra Explained in 3 Minutes                             Julian Chokkattu, Reviews Editor for WIRED, walks us through a few of the Samsung S22 Ultra&#39;s new features.                                                                                                                                                                                                                                 http://dp8hsntg6do36.cloudfront.net/6203cd7b5577c23d19622259/fe546b9b-a320-4883-9cbd-0d790f23c36dlow.mp4               184  2022-02-10T17:00:00+00:00                      nan  NaT        https://www.wired.com/video/sitemap.xml  W/90b11f47f8b2ab57cb180cbd3c6f06f9            2.86199  2022-02-12 20:24:55.841851+00:00</span>
<span class="sd">   2  https://www.wired.com/video/watch/first-look-samsung-galaxy-unpacked-2022                                                http://dwgyu36up6iuz.cloudfront.net/heru80fdn/image/upload/c_fill,d_placeholder_thescene.jpg,fl_progressive,g_face,h_180,q_80,w_320/v1644381627/wired_first-look-samsung-galaxy-unpacked-2022.jpg                                       First Look: Samsung Galaxy Unpacked 2022                                        Samsung has debuted three new smartphones—the Galaxy S22 Ultra, S22+, S22—and three Android tablets in various sizes at Samsung Unpacked 2022. WIRED&#39;s Julian Chokkattu takes a look at the newest features.                                                                                                                                http://dp8hsntg6do36.cloudfront.net/620345a15577c23d46622256/d74930cf-11e1-466e-b023-1d9b91664204low.mp4               373  2022-02-09T15:00:00+00:00                      nan  NaT        https://www.wired.com/video/sitemap.xml  W/90b11f47f8b2ab57cb180cbd3c6f06f9            2.86199  2022-02-12 20:24:55.841851+00:00</span>
<span class="sd">   3  https://www.wired.com/video/watch/reinventing-with-data                                                                  http://dwgyu36up6iuz.cloudfront.net/heru80fdn/image/upload/c_fill,d_placeholder_thescene.jpg,fl_progressive,g_face,h_180,q_80,w_320/v1642801328/wired_reinventing-with-data.jpg                                                         Reinventing With Data | WIRED Brand Lab                                         Produced by WIRED Brand Lab with AWS | What can the Seattle Seahawks winning strategy teach businesses?                                                                                                                                                                                                                                     http://dp8hsntg6do36.cloudfront.net/619bd9be1d75db41adee6b58/d4889b15-4f34-41b0-b935-0c79465a9793low.mp4               292  2022-02-09T13:00:00+00:00                      nan  NaT        https://www.wired.com/video/sitemap.xml  W/90b11f47f8b2ab57cb180cbd3c6f06f9            2.86199  2022-02-12 20:24:55.841851+00:00</span>
<span class="sd">                                                                                                                                                                                                                                                                                                                                                                                                                                                       Swami Sivasubramanian, VP of AI at Amazon Web Services helps us to understand how the Seattle Seahawks are using data and AI to remain a top performing team in the NFL, and how their process of data capture, storage, and machine learning to gain strategic insights is a model for making better business decision across industries.</span>
<span class="sd">   4  https://www.wired.com/video/watch/seth-rogen-answers-the-webs-most-searched-questions                                    http://dwgyu36up6iuz.cloudfront.net/heru80fdn/image/upload/c_fill,d_placeholder_thescene.jpg,fl_progressive,g_face,h_180,q_80,w_320/v1644335726/wired_seth-rogen-answers-the-webs-most-searched-questions.jpg                           Autocomplete Interview - Seth Rogen Answers The Web’s Most Searched Questions   &quot;Pam &amp;amp; Tommy&quot; star Seth Rogen takes the WIRED Autocomplete Interview once again and answers the internet&#39;s most searched questions about himself. Who does Seth Rogen look like? Does Seth have a podcast? Does he sell pottery? Does he celebrate Christmas? Does he play Call of Duty?                                                http://dp8hsntg6do36.cloudfront.net/6201430a1d75db06ae1f62e8/488ed635-91d0-4281-9e64-34be9bf74f00low.mp4               635  2022-02-08T17:00:00+00:00                      nan  NaT        https://www.wired.com/video/sitemap.xml  W/90b11f47f8b2ab57cb180cbd3c6f06f9            2.86199  2022-02-12 20:24:55.841851+00:00</span>

<span class="sd">                                                                                                                                                                                                                                                                                                                                                                                                                                                       Pam &amp;amp; Tommy premieres February 2 on Hulu (finale on March 9)</span>
<span class="sd">2950  https://www.wired.com/video/genres/how-to                                                                       nan      nan                                                                                                                                                                                                                                     nan                                                                             nan                                                                                                                                                                                                                                                                                                                                         nan                                                                                                                    nan  nan                                            nan  NaT        https://www.wired.com/video/sitemap.xml  W/90b11f47f8b2ab57cb180cbd3c6f06f9            2.86199  2022-02-12 20:24:55.841851+00:00</span>
<span class="sd">2951  https://www.wired.com/video/genres/movies-tv                                                                    nan      nan                                                                                                                                                                                                                                     nan                                                                             nan                                                                                                                                                                                                                                                                                                                                         nan                                                                                                                    nan  nan                                            nan  NaT        https://www.wired.com/video/sitemap.xml  W/90b11f47f8b2ab57cb180cbd3c6f06f9            2.86199  2022-02-12 20:24:55.841851+00:00</span>
<span class="sd">2952  https://www.wired.com/video/genres/events                                                                       nan      nan                                                                                                                                                                                                                                     nan                                                                             nan                                                                                                                                                                                                                                                                                                                                         nan                                                                                                                    nan  nan                                            nan  NaT        https://www.wired.com/video/sitemap.xml  W/90b11f47f8b2ab57cb180cbd3c6f06f9            2.86199  2022-02-12 20:24:55.841851+00:00</span>
<span class="sd">2953  https://www.wired.com/video/genres/promotion                                                                    nan      nan                                                                                                                                                                                                                                     nan                                                                             nan                                                                                                                                                                                                                                                                                                                                         nan                                                                                                                    nan  nan                                            nan  NaT        https://www.wired.com/video/sitemap.xml  W/90b11f47f8b2ab57cb180cbd3c6f06f9            2.86199  2022-02-12 20:24:55.841851+00:00</span>
<span class="sd">2954  https://www.wired.com/video/genres/transportation                                                               nan      nan                                                                                                                                                                                                                                     nan                                                                             nan                                                                                                                                                                                                                                                                                                                                         nan                                                                                                                    nan  nan                                            nan  NaT        https://www.wired.com/video/sitemap.xml  W/90b11f47f8b2ab57cb180cbd3c6f06f9            2.86199  2022-02-12 20:24:55.841851+00:00</span>
<span class="sd">====  ==============================================================================================================  =======  ======================================================================================================================================================================================================================================  ==============================================================================  ==========================================================================================================================================================================================================================================================================================================================================  ========================================================================================================  ================  =========================  =======================  =========  =======================================  ==================================  =================  ================================</span>

<span class="sd">Request Headers</span>
<span class="sd">---------------</span>
<span class="sd">You can set and change any request header while runnig this function if you want to</span>
<span class="sd">modify its behavior. This can be done using a simple dictionary, where the keys are the</span>
<span class="sd">names of the headers and values are their values.</span>

<span class="sd">For example, one of the common use-cases is to set a different User-agent than the</span>
<span class="sd">default one:</span>

<span class="sd">.. thebe-button::</span>
<span class="sd">    Run this code</span>

<span class="sd">.. code-block::</span>
<span class="sd">    :class: thebe, thebe-init</span>

<span class="sd">    adv.sitemap_to_df(&quot;https://www.ft.com/sitemaps/news.xml&quot;, headers={&quot;User-agent&quot;: &quot;YOUR-USER-AGENT&quot;})</span>

<span class="sd">Another interesting thing you might want to do is utilize the `If-None-Match` header.</span>
<span class="sd">In many cases the sitemaps return an etag for the sitemap. This is to make it easier to</span>
<span class="sd">know whether or not a sitemap has changed. A different etag means the sitemap has been</span>
<span class="sd">updated/changed.</span>

<span class="sd">With large sitemaps, where many sub-sitemaps don&#39;t change that much you don&#39;t need to</span>
<span class="sd">re-download the sitemap every time. You can simply use this header which would download</span>
<span class="sd">the sitemap only if it has a different etag. This can also be useful with frequently</span>
<span class="sd">changing sitemaps like news sitemaps for example. In this case you probably want to</span>
<span class="sd">constantly check but only fetch the sitemap if it was changed.</span>


<span class="sd">.. thebe-button::</span>
<span class="sd">    Run this code</span>

<span class="sd">.. code-block::</span>
<span class="sd">    :class: thebe, thebe-init</span>

<span class="sd">    # First time:</span>
<span class="sd">    ft = adv.sitemap_to_df(&quot;https://www.ft.com/sitemaps/news.xml&quot;)</span>
<span class="sd">    etag = ft[&#39;etag&#39;][0]</span>

<span class="sd">    # Second time:</span>
<span class="sd">    ft = adv.sitemap_to_df(&quot;https://www.ft.com/sitemaps/news.xml&quot;, headers={&quot;If-None-Match&quot;: etag})</span>
<span class="sd">&quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">concurrent</span> <span class="kn">import</span> <span class="n">futures</span>
<span class="kn">from</span> <span class="nn">gzip</span> <span class="kn">import</span> <span class="n">BadGzipFile</span><span class="p">,</span> <span class="n">GzipFile</span>
<span class="kn">from</span> <span class="nn">urllib.request</span> <span class="kn">import</span> <span class="n">Request</span><span class="p">,</span> <span class="n">urlopen</span>
<span class="kn">from</span> <span class="nn">xml.etree</span> <span class="kn">import</span> <span class="n">ElementTree</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>

<span class="kn">from</span> <span class="nn">advertools</span> <span class="kn">import</span> <span class="n">__version__</span> <span class="k">as</span> <span class="n">version</span>

<span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">)</span>

<span class="n">headers</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;User-Agent&quot;</span><span class="p">:</span> <span class="s2">&quot;advertools-&quot;</span> <span class="o">+</span> <span class="n">version</span><span class="p">}</span>


<span class="k">def</span> <span class="nf">_sitemaps_from_robotstxt</span><span class="p">(</span><span class="n">robots_url</span><span class="p">,</span> <span class="n">request_headers</span><span class="p">):</span>
    <span class="n">sitemaps</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">robots_page</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">robots_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">request_headers</span><span class="p">))</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">robots_page</span><span class="o">.</span><span class="n">readlines</span><span class="p">():</span>
        <span class="n">line_split</span> <span class="o">=</span> <span class="p">[</span><span class="n">s</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">decode</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;:&quot;</span><span class="p">,</span> <span class="n">maxsplit</span><span class="o">=</span><span class="mi">1</span><span class="p">)]</span>
        <span class="k">if</span> <span class="n">line_split</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="o">==</span> <span class="s2">&quot;sitemap&quot;</span><span class="p">:</span>
            <span class="n">sitemaps</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">line_split</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
    <span class="k">return</span> <span class="n">sitemaps</span>


<span class="k">def</span> <span class="nf">_parse_sitemap</span><span class="p">(</span><span class="n">root</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">dict</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
        <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;loc&quot;</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                <span class="n">d</span><span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">text</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>

    <span class="k">def</span> <span class="nf">parse_xml_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node_url</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">d</span>
        <span class="n">keys</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">element</span> <span class="ow">in</span> <span class="n">node</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span><span class="p">:</span>
                <span class="n">tag</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span>
                <span class="n">d</span><span class="p">[</span><span class="n">node_url</span><span class="p">][</span><span class="n">prefix</span> <span class="o">+</span> <span class="n">tag</span><span class="p">]</span> <span class="o">=</span> <span class="n">element</span><span class="o">.</span><span class="n">text</span>
                <span class="n">keys</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">tag</span><span class="p">)</span>
                <span class="n">prefix</span> <span class="o">=</span> <span class="n">prefix</span> <span class="k">if</span> <span class="n">tag</span> <span class="ow">in</span> <span class="n">keys</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
            <span class="k">if</span> <span class="nb">list</span><span class="p">(</span><span class="n">element</span><span class="p">):</span>
                <span class="n">parse_xml_node</span><span class="p">(</span>
                    <span class="n">element</span><span class="p">,</span> <span class="n">node_url</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="n">element</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span>
                <span class="p">)</span>

    <span class="k">for</span> <span class="n">node</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
        <span class="n">node_url</span> <span class="o">=</span> <span class="p">[</span><span class="n">n</span><span class="o">.</span><span class="n">text</span> <span class="k">for</span> <span class="n">n</span> <span class="ow">in</span> <span class="n">node</span> <span class="k">if</span> <span class="s2">&quot;loc&quot;</span> <span class="ow">in</span> <span class="n">n</span><span class="o">.</span><span class="n">tag</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">parse_xml_node</span><span class="p">(</span><span class="n">node</span><span class="p">,</span> <span class="n">node_url</span><span class="o">=</span><span class="n">node_url</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">d</span><span class="o">.</span><span class="n">values</span><span class="p">())</span>


<span class="k">def</span> <span class="nf">_build_request_headers</span><span class="p">(</span><span class="n">user_headers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="c1"># Must ensure lowercase to avoid introducing duplicate keys</span>
    <span class="n">final_headers</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">headers</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
    <span class="k">if</span> <span class="n">user_headers</span><span class="p">:</span>
        <span class="n">user_headers</span> <span class="o">=</span> <span class="p">{</span><span class="n">key</span><span class="o">.</span><span class="n">lower</span><span class="p">():</span> <span class="n">val</span> <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">user_headers</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">final_headers</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="n">user_headers</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">final_headers</span>


<div class="viewcode-block" id="sitemap_to_df">
<a class="viewcode-back" href="../../advertools.sitemaps.html#advertools.sitemaps.sitemap_to_df">[docs]</a>
<span class="k">def</span> <span class="nf">sitemap_to_df</span><span class="p">(</span><span class="n">sitemap_url</span><span class="p">,</span> <span class="n">max_workers</span><span class="o">=</span><span class="mi">8</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">request_headers</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Retrieve all URLs and other available tags of a sitemap(s) and put them in</span>
<span class="sd">    a DataFrame.</span>

<span class="sd">    You can also pass the URL of a sitemap index, or a link to a robots.txt</span>
<span class="sd">    file.</span>

<span class="sd">    :param url sitemap_url: The URL of a sitemap, either a regular sitemap, a</span>
<span class="sd">                            sitemap index, or a link to a robots.txt file.</span>
<span class="sd">                            In the case of a sitemap index or robots.txt, the</span>
<span class="sd">                            function will go through all the sub sitemaps and</span>
<span class="sd">                            retrieve all the included URLs in one DataFrame.</span>
<span class="sd">    :param int max_workers: The maximum number of workers to use for threading.</span>
<span class="sd">                            The higher the faster, but with high numbers you</span>
<span class="sd">                            risk being blocked and/or missing some data as you</span>
<span class="sd">                            might appear like an attacker.</span>
<span class="sd">    :param bool recursive: Whether or not to follow and import all sub-sitemaps</span>
<span class="sd">                           (in case you have a sitemap index), or to only</span>
<span class="sd">                           import the given sitemap. This might be useful in</span>
<span class="sd">                           case you want to explore what sitemaps are available</span>
<span class="sd">                           after which you can decide which ones you are</span>
<span class="sd">                           interested in.</span>
<span class="sd">    :param dict request_headers: One or more request headers to use while</span>
<span class="sd">                                 fetching the sitemap.</span>
<span class="sd">    :return sitemap_df: A pandas DataFrame containing all URLs, as well as</span>
<span class="sd">                        other tags if available (``lastmod``, ``changefreq``,</span>
<span class="sd">                        ``priority``, or others found in news, video, or image</span>
<span class="sd">                        sitemaps).</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">final_headers</span> <span class="o">=</span> <span class="n">_build_request_headers</span><span class="p">(</span><span class="n">request_headers</span><span class="p">)</span>

    <span class="k">if</span> <span class="n">sitemap_url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;robots.txt&quot;</span><span class="p">):</span>
        <span class="k">return</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
            <span class="p">[</span>
                <span class="n">sitemap_to_df</span><span class="p">(</span><span class="n">sitemap</span><span class="p">,</span> <span class="n">recursive</span><span class="o">=</span><span class="n">recursive</span><span class="p">)</span>
                <span class="k">for</span> <span class="n">sitemap</span> <span class="ow">in</span> <span class="n">_sitemaps_from_robotstxt</span><span class="p">(</span><span class="n">sitemap_url</span><span class="p">,</span> <span class="n">final_headers</span><span class="p">)</span>
            <span class="p">],</span>
            <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span>
        <span class="p">)</span>

    <span class="k">if</span> <span class="n">sitemap_url</span><span class="o">.</span><span class="n">endswith</span><span class="p">(</span><span class="s2">&quot;xml.gz&quot;</span><span class="p">):</span>
        <span class="n">final_headers</span><span class="p">[</span><span class="s2">&quot;accept-encoding&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="s2">&quot;gzip&quot;</span>
        <span class="n">xml_text</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span>
            <span class="n">Request</span><span class="p">(</span>
                <span class="n">sitemap_url</span><span class="p">,</span>
                <span class="n">headers</span><span class="o">=</span><span class="n">final_headers</span><span class="p">,</span>
            <span class="p">)</span>
        <span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp_headers</span> <span class="o">=</span> <span class="n">xml_text</span><span class="o">.</span><span class="n">getheaders</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">resp_headers</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">pass</span>
        <span class="n">xml_text</span> <span class="o">=</span> <span class="n">GzipFile</span><span class="p">(</span><span class="n">fileobj</span><span class="o">=</span><span class="n">xml_text</span><span class="p">)</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">xml_string</span> <span class="o">=</span> <span class="n">xml_text</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
        <span class="k">except</span> <span class="n">BadGzipFile</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span>
                <span class="sa">f</span><span class="s2">&quot;&quot;&quot;</span><span class="si">{</span><span class="n">sitemap_url</span><span class="si">}</span><span class="s2"> is not a valid gzip file. Falling back to plain XML parsing.&quot;&quot;&quot;</span>  <span class="c1"># noqa</span>
            <span class="p">)</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="s2">&quot;xml_string&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="nb">locals</span><span class="p">():</span>
        <span class="n">xml_text</span> <span class="o">=</span> <span class="n">urlopen</span><span class="p">(</span><span class="n">Request</span><span class="p">(</span><span class="n">sitemap_url</span><span class="p">,</span> <span class="n">headers</span><span class="o">=</span><span class="n">final_headers</span><span class="p">))</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">resp_headers</span> <span class="o">=</span> <span class="n">xml_text</span><span class="o">.</span><span class="n">getheaders</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">AttributeError</span><span class="p">:</span>
            <span class="n">resp_headers</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
            <span class="k">pass</span>
        <span class="n">xml_string</span> <span class="o">=</span> <span class="n">xml_text</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="n">root</span> <span class="o">=</span> <span class="n">ElementTree</span><span class="o">.</span><span class="n">fromstring</span><span class="p">(</span><span class="n">xml_string</span><span class="p">)</span>

    <span class="n">sitemap_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">root</span><span class="o">.</span><span class="n">tag</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;}&quot;</span><span class="p">)[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span> <span class="o">==</span> <span class="s2">&quot;sitemapindex&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="n">recursive</span><span class="p">:</span>
        <span class="n">multi_sitemap_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>
        <span class="n">sitemap_url_list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">elem</span> <span class="ow">in</span> <span class="n">root</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">el</span> <span class="ow">in</span> <span class="n">elem</span><span class="p">:</span>
                <span class="k">if</span> <span class="s2">&quot;loc&quot;</span> <span class="ow">in</span> <span class="n">el</span><span class="o">.</span><span class="n">tag</span><span class="p">:</span>
                    <span class="k">if</span> <span class="n">el</span><span class="o">.</span><span class="n">text</span> <span class="o">==</span> <span class="n">sitemap_url</span><span class="p">:</span>
                        <span class="n">error_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span>
                            <span class="p">{</span>
                                <span class="s2">&quot;sitemap&quot;</span><span class="p">:</span> <span class="p">[</span><span class="n">sitemap_url</span><span class="p">],</span>
                                <span class="s2">&quot;errors&quot;</span><span class="p">:</span> <span class="p">[</span>
                                    <span class="s2">&quot;WARNING: Sitemap contains a link to itself&quot;</span>
                                <span class="p">],</span>
                            <span class="p">}</span>
                        <span class="p">)</span>
                        <span class="n">multi_sitemap_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                            <span class="p">[</span><span class="n">multi_sitemap_df</span><span class="p">,</span> <span class="n">error_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
                        <span class="p">)</span>
                    <span class="k">else</span><span class="p">:</span>
                        <span class="n">sitemap_url_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">el</span><span class="o">.</span><span class="n">text</span><span class="p">)</span>
        <span class="k">with</span> <span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="n">max_workers</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
            <span class="n">to_do</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">sitemap</span> <span class="ow">in</span> <span class="n">sitemap_url_list</span><span class="p">:</span>
                <span class="n">future</span> <span class="o">=</span> <span class="n">executor</span><span class="o">.</span><span class="n">submit</span><span class="p">(</span><span class="n">sitemap_to_df</span><span class="p">,</span> <span class="n">sitemap</span><span class="p">)</span>
                <span class="n">to_do</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">future</span><span class="p">)</span>
            <span class="n">done_iter</span> <span class="o">=</span> <span class="n">futures</span><span class="o">.</span><span class="n">as_completed</span><span class="p">(</span><span class="n">to_do</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">future</span> <span class="ow">in</span> <span class="n">done_iter</span><span class="p">:</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">multi_sitemap_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">multi_sitemap_df</span><span class="p">,</span> <span class="n">future</span><span class="o">.</span><span class="n">result</span><span class="p">()],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
                <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
                    <span class="n">error_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="nb">dict</span><span class="p">(</span><span class="n">errors</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)),</span> <span class="n">index</span><span class="o">=</span><span class="nb">range</span><span class="p">(</span><span class="mi">1</span><span class="p">))</span>
                    <span class="n">future_str</span> <span class="o">=</span> <span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">future</span><span class="p">))</span>
                    <span class="n">hexes</span> <span class="o">=</span> <span class="p">[</span><span class="nb">hex</span><span class="p">(</span><span class="nb">id</span><span class="p">(</span><span class="n">f</span><span class="p">))</span> <span class="k">for</span> <span class="n">f</span> <span class="ow">in</span> <span class="n">to_do</span><span class="p">]</span>
                    <span class="n">index</span> <span class="o">=</span> <span class="n">hexes</span><span class="o">.</span><span class="n">index</span><span class="p">(</span><span class="n">future_str</span><span class="p">)</span>
                    <span class="n">error_df</span><span class="p">[</span><span class="s2">&quot;sitemap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sitemap_url_list</span><span class="p">[</span><span class="n">index</span><span class="p">]</span>
                    <span class="n">logging</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">sitemap_url_list</span><span class="p">[</span><span class="n">index</span><span class="p">])</span>
                    <span class="n">multi_sitemap_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
                        <span class="p">[</span><span class="n">multi_sitemap_df</span><span class="p">,</span> <span class="n">error_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span>
                    <span class="p">)</span>
        <span class="k">return</span> <span class="n">multi_sitemap_df</span>

    <span class="k">else</span><span class="p">:</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Getting &quot;</span> <span class="o">+</span> <span class="n">sitemap_url</span><span class="p">)</span>
        <span class="n">elem_df</span> <span class="o">=</span> <span class="n">_parse_sitemap</span><span class="p">(</span><span class="n">root</span><span class="p">)</span>
        <span class="n">sitemap_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">sitemap_df</span><span class="p">,</span> <span class="n">elem_df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="n">sitemap_df</span><span class="p">[</span><span class="s2">&quot;sitemap&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">sitemap_url</span><span class="p">]</span> <span class="k">if</span> <span class="n">sitemap_df</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="n">sitemap_url</span>
    <span class="k">if</span> <span class="s2">&quot;lastmod&quot;</span> <span class="ow">in</span> <span class="n">sitemap_df</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sitemap_df</span><span class="p">[</span><span class="s2">&quot;lastmod&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span><span class="n">sitemap_df</span><span class="p">[</span><span class="s2">&quot;lastmod&quot;</span><span class="p">],</span> <span class="n">utc</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="s2">&quot;priority&quot;</span> <span class="ow">in</span> <span class="n">sitemap_df</span><span class="p">:</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">sitemap_df</span><span class="p">[</span><span class="s2">&quot;priority&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">sitemap_df</span><span class="p">[</span><span class="s2">&quot;priority&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">astype</span><span class="p">(</span><span class="nb">float</span><span class="p">)</span>
        <span class="k">except</span> <span class="ne">Exception</span><span class="p">:</span>
            <span class="k">pass</span>
    <span class="k">if</span> <span class="n">resp_headers</span><span class="p">:</span>
        <span class="n">etag_lastmod</span> <span class="o">=</span> <span class="p">{</span>
            <span class="n">header</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot;-&quot;</span><span class="p">,</span> <span class="s2">&quot;_&quot;</span><span class="p">):</span> <span class="n">val</span>
            <span class="k">for</span> <span class="n">header</span><span class="p">,</span> <span class="n">val</span> <span class="ow">in</span> <span class="n">resp_headers</span>
            <span class="k">if</span> <span class="n">header</span><span class="o">.</span><span class="n">lower</span><span class="p">()</span> <span class="ow">in</span> <span class="p">[</span><span class="s2">&quot;etag&quot;</span><span class="p">,</span> <span class="s2">&quot;last-modified&quot;</span><span class="p">]</span>
        <span class="p">}</span>
        <span class="n">sitemap_df</span> <span class="o">=</span> <span class="n">sitemap_df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="n">etag_lastmod</span><span class="p">)</span>
    <span class="k">if</span> <span class="s2">&quot;last_modified&quot;</span> <span class="ow">in</span> <span class="n">sitemap_df</span><span class="p">:</span>
        <span class="n">sitemap_df</span><span class="p">[</span><span class="s2">&quot;sitemap_last_modified&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">to_datetime</span><span class="p">(</span>
            <span class="n">sitemap_df</span><span class="p">[</span><span class="s2">&quot;last_modified&quot;</span><span class="p">]</span>
        <span class="p">)</span>
        <span class="k">del</span> <span class="n">sitemap_df</span><span class="p">[</span><span class="s2">&quot;last_modified&quot;</span><span class="p">]</span>
    <span class="n">sitemap_df</span><span class="p">[</span><span class="s2">&quot;sitemap_size_mb&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">xml_string</span><span class="p">)</span> <span class="o">/</span> <span class="mi">1024</span> <span class="o">/</span> <span class="mi">1024</span>
    <span class="n">sitemap_df</span><span class="p">[</span><span class="s2">&quot;download_date&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">now</span><span class="p">(</span><span class="n">tz</span><span class="o">=</span><span class="s2">&quot;UTC&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">sitemap_df</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Elias Dabbas.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>