<!DOCTYPE html>
<html class="writer-html5" lang="en" data-content_root="../../">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>advertools.knowledge_graph &mdash;  Python</title>
      <link rel="stylesheet" type="text/css" href="../../_static/pygments.css?v=fa44fd50" />
      <link rel="stylesheet" type="text/css" href="../../_static/css/theme.css?v=19f00094" />
      <link rel="stylesheet" type="text/css" href="../../_static/sphinx-thebe.css?v=4fa983c6" />

  
  <!--[if lt IE 9]>
    <script src="../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script src="../../_static/jquery.js?v=5d32c60e"></script>
        <script src="../../_static/_sphinx_javascript_frameworks_compat.js?v=2cd50e6c"></script>
        <script src="../../_static/documentation_options.js?v=81998473"></script>
        <script src="../../_static/doctools.js?v=9bcbadda"></script>
        <script src="../../_static/sphinx_highlight.js?v=dc90522c"></script>
        <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
        <script async="async" src="../../_static/sphinx-thebe.js?v=c100c467"></script>
        <script async="async" src="https://unpkg.com/thebe@0.8.2/lib/index.js"></script>
        <script>const THEBE_JS_URL = "https://unpkg.com/thebe@0.8.2/lib/index.js"; const thebe_selector = ".thebe,.cell"; const thebe_selector_input = "pre"; const thebe_selector_output = ".output, .cell_output"</script>
    <script src="../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >

          
          
          <a href="../../index.html" class="icon icon-home">
            advertools
          </a>
              <div class="version">
                0.16.4
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" aria-label="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <ul>
<li class="toctree-l1"><a class="reference internal" href="../../readme.html">About advertools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.survey.html">Survey - your feedback</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.cli.cli.html">Command Line Interface</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SEM</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.kw_generate.html">Generate SEM Keywords</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.ad_create.html">Create Text Ads on a Large Scale</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.ad_from_string.html">Create Text Ads From Description Text</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">SEO</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.robotstxt.html">robots.txt</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.sitemaps.html">XML Sitemaps</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.spider.html">SEO Spider / Crawler</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.code_recipes.spider_strategies.html">Crawl Strategies</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.crawlytics.html">Crawl Analytics</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.header_spider.html">Crawl headers (HEAD method only)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.image_spider.html">Crawl images</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.logs.html">Python Log File Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.logs.html#parse-and-analyze-crawl-logs-in-a-dataframe">Parse and Analyze Crawl Logs in a Dataframe</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.reverse_dns_lookup.html">Reverse DNS Lookup</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.serp.html">Analyze Search Engine Results (SERPs)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.knowledge_graph.html">Google's Knowledge Graph</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Text &amp; Content Analysis</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.urlytics.html">URL Structure Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.emoji.html">Emoji Tools</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.extract.html">Extract Structured Entities from Text</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.stopwords.html">Stop Words</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.word_frequency.html">Text Analysis (absolute &amp; weighted word frequency)</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.word_tokenize.html">Word Tokenization (N-grams)</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Social Media</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.twitter.html">Twitter Data API</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../advertools.youtube.html">YouTube Data API</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Index &amp; Change Log</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../include_changelog.html">Index &amp; Change Log</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">advertools</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../index.html" class="icon icon-home" aria-label="Home"></a></li>
          <li class="breadcrumb-item"><a href="../index.html">Module code</a></li>
      <li class="breadcrumb-item active">advertools.knowledge_graph</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for advertools.knowledge_graph</h1><div class="highlight"><pre>
<span></span><span class="sd">&quot;&quot;&quot;</span>
<span class="sd">.. _knowledge_graph:</span>

<span class="sd">Import and Analyze Knowledge Graph Results on a Large Scale</span>
<span class="sd">===========================================================</span>

<span class="sd">If :ref:`analyzing SERPs &lt;serp&gt;` is the first step in understanding your</span>
<span class="sd">rankings on search engines, then analyzing the knowledge graph can be thought</span>
<span class="sd">of as step zero.</span>

<span class="sd">SERP positions for a certain keyword show how each page is ranked in comparison</span>
<span class="sd">to all other eligible pages. Knowledge graph scores on the other hand, show the</span>
<span class="sd">ranks of the different meanings that a word can take for Google (a person, a</span>
<span class="sd">city, a brand, etc.).</span>

<span class="sd">.. WARNING:: From `Google&#39;s documentation &lt;https://developers.google.com/knowledge-graph&gt;`_:</span>
<span class="sd">   This API is not suitable for use as a production-critical service. Your</span>
<span class="sd">   product should not form a critical dependence on this API.</span>

<span class="sd">It&#39;s not clear whether this is from a technical reliability or a content</span>
<span class="sd">correctness point of view, but it is what the docs mention. So please keep this</span>
<span class="sd">in mind when using it.</span>

<span class="sd">Account Setup</span>
<span class="sd">*************</span>

<span class="sd">In order to be able to send requests, you will need to `create a project</span>
<span class="sd">&lt;https://console.developers.google.com/&gt;`_, `set up billing</span>
<span class="sd">&lt;https://console.developers.google.com/billing&gt;`_, and `activate the knowledge</span>
<span class="sd">graph API &lt;https://console.developers.google.com/apis/library&gt;`_ for your</span>
<span class="sd">project. You will then need to `create credentials</span>
<span class="sd">&lt;https://console.developers.google.com/apis/credentials&gt;`_ (API Key).</span>
<span class="sd">Once you have that, you can use it as your ``key`` parameter when running</span>
<span class="sd">requests, as shown below.</span>

<span class="sd">How to use Google&#39;s Knowledge Graph API</span>
<span class="sd">***************************************</span>


<span class="sd">What is &quot;google&quot;? Is it a search engine, a company, a brand, a very large</span>
<span class="sd">number? What else is it?</span>

<span class="sd">And if it is all of those things, what is the relative ranking of each? What</span>
<span class="sd">is the source of the information, its URL, images (if any)?</span>

<span class="sd">.. code-block:: python</span>

<span class="sd">    &gt;&gt;&gt; key = &#39;YOUR_GOOGLE_DEVELOPER_KEY&#39;</span>
<span class="sd">    &gt;&gt;&gt; google =  knowledge_graph(key=key, query=&#39;google&#39;)</span>
<span class="sd">    &gt;&gt;&gt; google</span>
<span class="sd">         query	resultScore	                               result.@type                  result.description    result.name</span>
<span class="sd">    0	google	     203191	   [&#39;Corporation&#39;, &#39;Organization&#39;, &#39;Thing&#39;]                  Technology company	        Google</span>
<span class="sd">    1	google	      49462	                       [&#39;WebSite&#39;, &#39;Thing&#39;]                              Google         Search</span>
<span class="sd">    2	google	      19142	                       [&#39;WebSite&#39;, &#39;Thing&#39;]                                 nan          Gmail</span>
<span class="sd">    3	google	      13251	              [&#39;Brand&#39;, &#39;WebSite&#39;, &#39;Thing&#39;]                             Website	   Google Maps</span>
<span class="sd">    4	google	       7549	[&#39;WebSite&#39;, &#39;SoftwareApplication&#39;, &#39;Thing&#39;]                             Website   Google Drive</span>
<span class="sd">    5	google	       6853	                       [&#39;WebSite&#39;, &#39;Thing&#39;]                             Website	   Google Play</span>
<span class="sd">    6	google	       6543	           [&#39;SoftwareApplication&#39;, &#39;Thing&#39;]                         Web browser  Google Chrome</span>
<span class="sd">    7	google	       4312	   [&#39;Corporation&#39;, &#39;Organization&#39;, &#39;Thing&#39;]  Multinational conglomerate company  Alphabet Inc.</span>
<span class="sd">    8	google	       3395	           [&#39;SoftwareApplication&#39;, &#39;Thing&#39;]                                 nan Google Account</span>
<span class="sd">    9	google	       1306	                                  [&#39;Thing&#39;]                                 nan         Google</span>

<span class="sd">    &gt;&gt;&gt; google.columns</span>
<span class="sd">    Index([&#39;query&#39;, &#39;resultScore&#39;, &#39;@type&#39;, &#39;result.@type&#39;, &#39;result.description&#39;,</span>
<span class="sd">       &#39;result.image.contentUrl&#39;, &#39;result.image.url&#39;,</span>
<span class="sd">       &#39;result.detailedDescription.articleBody&#39;,</span>
<span class="sd">       &#39;result.detailedDescription.url&#39;, &#39;result.detailedDescription.license&#39;,</span>
<span class="sd">       &#39;result.url&#39;, &#39;result.name&#39;, &#39;result.@id&#39;, &#39;query_time&#39;],</span>
<span class="sd">      dtype=&#39;object&#39;)</span>



<span class="sd">The above table is a sample response from the :func:`knowledge_graph` function.</span>
<span class="sd">Many more columns are available as you can see in the second line above.</span>
<span class="sd">We can see that &quot;google&quot; is a company, with a result score of 203,191 and it is</span>
<span class="sd">a search engine/website with a result score of 49,462. It is then understood as</span>
<span class="sd">an email application, a mapping application, and so on, as you can see in the</span>
<span class="sd">`result.name` column.</span>

<span class="sd">You can also see that we get the types under which this result falls, in the</span>
<span class="sd">`result.@type` column. Multiple types show the type inheritance, and as you can</span>
<span class="sd">also see, everything is a &quot;Thing&quot;. This is the top element in the type</span>
<span class="sd">hierarchy under which everything belongs.</span>

<span class="sd">Like the :ref:`Google SERP &lt;serp&gt;` and :ref:`YouTube SERP &lt;serp&gt;`, functions</span>
<span class="sd">this funcion works in the same manner, creating, sending, and aggregating the</span>
<span class="sd">product of the arguments passed</span>
<span class="sd">to it.</span>

<span class="sd">For example if you run</span>

<span class="sd">&gt;&gt;&gt; knowledge_graph(key=key, query=[&quot;google&quot;, &quot;bing&quot;], languages=[&quot;en&quot;, &quot;fr&quot;, &quot;de&quot;])</span>

<span class="sd">The function will send 2 (queries) x 3 languages = 6 requests.</span>

<span class="sd">(google, en), (google, fr), (google, de) , (bing, en), (bing, fr), (bing, de)</span>

<span class="sd">This is actually the main value of having this function, because you usually</span>
<span class="sd">want a large sample to evaluate certain keywords across languages or types.</span>

<span class="sd">Let&#39;s check what &quot;seo&quot; and &quot;search engine optimization&quot; mean in different</span>
<span class="sd">languages.</span>

<span class="sd">&gt;&gt;&gt; seo = knowledge_graph(</span>
<span class="sd">...     key=key,</span>
<span class="sd">...     query=[&quot;seo&quot;, &quot;search engine optimization&quot;],</span>
<span class="sd">...     languages=[&quot;en&quot;, &quot;es&quot;, &quot;de&quot;],</span>
<span class="sd">... )</span>
<span class="sd">&gt;&gt;&gt; seo</span>
<span class="sd">        query	                        languages	resultScore	    result.name	                     result.@type	                                   result.description</span>
<span class="sd">0	search engine optimization	de      	       3587	    Suchmaschinenoptimierung	         [&#39;Thing&#39;]                                         nan</span>
<span class="sd">1	search engine optimization	de      	        321	    Lokale Suchmaschinenoptimierung	 [&#39;Thing&#39;]                                         nan</span>
<span class="sd">2	search engine optimization	de      	        252	    Suchmaschinenmarketing	         [&#39;Thing&#39;]                                         nan</span>
<span class="sd">4	search engine optimization	en      	      71756	    Search engine optimization	         [&#39;Thing&#39;]                                         nan</span>
<span class="sd">5	search engine optimization	en      	       5056	    Search engine marketing	         [&#39;Thing&#39;]                                         nan</span>
<span class="sd">6	search engine optimization	en      	        576	    SEOP, Inc.	                         [&#39;Organization&#39;, &#39;Corporation&#39;, &#39;Thing&#39;]	   Company</span>
<span class="sd">13	seo	                        de      	       3313	    Seoul	                         [&#39;AdministrativeArea&#39;, &#39;Thing&#39;, &#39;City&#39;, &#39;Place&#39;]  Hauptstadt von Südkorea</span>
<span class="sd">14	seo	                        de      	       1509	    Seo Yea-ji	                         [&#39;Thing&#39;, &#39;Person&#39;]	                           Schauspielerin</span>
<span class="sd">15	seo	                        de      	        584	    Suchmaschinenoptimierung	         [&#39;Thing&#39;]	                                   nan</span>
<span class="sd">33	seo	                        es      	       1509	    Seo Ye-ji	                         [&#39;Person&#39;, &#39;Thing&#39;]	                           Actriz</span>
<span class="sd">34	seo	                        es      	        584	    Posicionamiento en buscadores	 [&#39;Thing&#39;]	                                   nan</span>
<span class="sd">35	seo	                        es      	        316	    Jin	                                 [&#39;Person&#39;, &#39;Thing&#39;]	                           Cantante</span>
<span class="sd">53	seo	                        en      	       8760	    Search engine optimization	         [&#39;Thing&#39;]	                                   nan</span>
<span class="sd">54	seo	                        en      	       3313	    Seoul	                         [&#39;AdministrativeArea&#39;, &#39;Thing&#39;, &#39;City&#39;, &#39;Place&#39;]  Capital of South Korea</span>
<span class="sd">55	seo	                        en      	       1435	    Sulli	                         [&#39;Thing&#39;, &#39;Person&#39;]	                           South Korean actress</span>

<span class="sd">&gt;&gt;&gt; seo.columns</span>
<span class="sd">Index([&#39;query&#39;, &#39;languages&#39;, &#39;resultScore&#39;, &#39;@type&#39;, &#39;result.name&#39;,</span>
<span class="sd">       &#39;result.@type&#39;, &#39;result.@id&#39;, &#39;result.image.contentUrl&#39;,</span>
<span class="sd">       &#39;result.image.url&#39;, &#39;result.detailedDescription.license&#39;,</span>
<span class="sd">       &#39;result.detailedDescription.url&#39;,</span>
<span class="sd">       &#39;result.detailedDescription.articleBody&#39;, &#39;result.description&#39;,</span>
<span class="sd">       &#39;result.url&#39;, &#39;query_time&#39;],</span>
<span class="sd">      dtype=&#39;object&#39;)</span>

<span class="sd">It&#39;s interesting to see how the same word can mean different things in</span>
<span class="sd">different contexts.</span>

<span class="sd">&quot;&quot;&quot;</span>  <span class="c1"># noqa: E501</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">concurrent</span> <span class="kn">import</span> <span class="n">futures</span>

<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">requests</span>

<span class="kn">from</span> <span class="nn">advertools.serp</span> <span class="kn">import</span> <span class="n">_dict_product</span>

<span class="n">param_regex</span> <span class="o">=</span> <span class="s2">&quot;^query$|^ids$|^languages$|^types$|^prefix$|^limit$&quot;</span>


<div class="viewcode-block" id="knowledge_graph">
<a class="viewcode-back" href="../../advertools.knowledge_graph.html#advertools.knowledge_graph.knowledge_graph">[docs]</a>
<span class="k">def</span> <span class="nf">knowledge_graph</span><span class="p">(</span>
    <span class="n">key</span><span class="p">,</span> <span class="n">query</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">ids</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">languages</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">types</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">prefix</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">limit</span><span class="o">=</span><span class="kc">None</span>
<span class="p">):</span>
<span class="w">    </span><span class="sd">&quot;&quot;&quot;Query Google&#39;s Knowledge Graph with any combination of parameters.</span>

<span class="sd">    Note that Google&#39;s documentation states that &quot;This API is not suitable for</span>
<span class="sd">    use as a production-critical service.&quot; So please keep this in mind.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>
<span class="sd">    key : str</span>
<span class="sd">      Your Google developer key.</span>
<span class="sd">    query : str</span>
<span class="sd">      A literal string to search for in the Knowledge Graph.</span>
<span class="sd">    ids : list</span>
<span class="sd">      A list of entity IDs to search for in the Knowledge Graph.</span>
<span class="sd">    languages : list</span>
<span class="sd">      The list of language codes (defined in ISO 639) to run the query with, for</span>
<span class="sd">      instance `en`.</span>
<span class="sd">    types : str</span>
<span class="sd">      Restricts returned entities to those of the specified types. For example,  you can</span>
<span class="sd">      specify `Person` (as defined in http://schema.org/Person)  to restrict the results</span>
<span class="sd">      to entities representing people. If multiple types are specified,  returned</span>
<span class="sd">      entities will contain one or more of these types.</span>
<span class="sd">    prefix : bool</span>
<span class="sd">      Enables prefix (initial substring) match against names and aliases of  entities.</span>
<span class="sd">      For example, a prefix `Jung` will match entities and aliases such as `Jung`,</span>
<span class="sd">      `Jungle`, and `Jung-ho Kang`.</span>
<span class="sd">    limit : int</span>
<span class="sd">      Limits the number of entities to be returned. Maximum is 500. Default is 20.</span>
<span class="sd">      Requests with high limits have a higher chance of timing out.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>
<span class="sd">    kg_df : pandas.DataFrame</span>
<span class="sd">      A DataFrame of all responses.</span>

<span class="sd">    https://developers.google.com/knowledge-graph/reference/rest/v1</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">params</span> <span class="o">=</span> <span class="nb">locals</span><span class="p">()</span>
    <span class="n">base_url</span> <span class="o">=</span> <span class="s2">&quot;https://kgsearch.googleapis.com/v1/entities:search?&quot;</span>
    <span class="n">supplied_params</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">params</span><span class="o">.</span><span class="n">items</span><span class="p">()</span> <span class="k">if</span> <span class="n">params</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="ow">is</span> <span class="ow">not</span> <span class="kc">None</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">p</span> <span class="ow">in</span> <span class="n">supplied_params</span><span class="p">:</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">supplied_params</span><span class="p">[</span><span class="n">p</span><span class="p">],</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="n">supplied_params</span><span class="p">[</span><span class="n">p</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">supplied_params</span><span class="p">[</span><span class="n">p</span><span class="p">]]</span>

    <span class="n">params_list</span> <span class="o">=</span> <span class="n">_dict_product</span><span class="p">(</span><span class="n">supplied_params</span><span class="p">)</span>
    <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">single_request</span><span class="p">(</span><span class="n">param</span><span class="p">):</span>
        <span class="k">nonlocal</span> <span class="n">result_df</span>
        <span class="n">resp</span> <span class="o">=</span> <span class="n">requests</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">base_url</span><span class="p">,</span> <span class="n">params</span><span class="o">=</span><span class="n">param</span><span class="p">)</span>
        <span class="n">param_log</span> <span class="o">=</span> <span class="s2">&quot;, &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">k</span> <span class="o">+</span> <span class="s2">&quot;=&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">v</span><span class="p">)</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">param</span><span class="o">.</span><span class="n">items</span><span class="p">()])</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="n">msg</span><span class="o">=</span><span class="s2">&quot;Requesting: &quot;</span> <span class="o">+</span> <span class="n">param_log</span><span class="p">)</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">json_normalize</span><span class="p">(</span><span class="n">resp</span><span class="o">.</span><span class="n">json</span><span class="p">(),</span> <span class="n">record_path</span><span class="o">=</span><span class="s2">&quot;itemListElement&quot;</span><span class="p">)</span>
        <span class="k">del</span> <span class="n">param</span><span class="p">[</span><span class="s2">&quot;key&quot;</span><span class="p">]</span>
        <span class="n">param_columns</span> <span class="o">=</span> <span class="p">{</span><span class="n">k</span><span class="p">:</span> <span class="p">[</span><span class="n">v</span><span class="p">]</span> <span class="k">if</span> <span class="n">df</span><span class="o">.</span><span class="n">empty</span> <span class="k">else</span> <span class="n">v</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> <span class="n">param</span><span class="o">.</span><span class="n">items</span><span class="p">()}</span>
        <span class="n">df</span> <span class="o">=</span> <span class="n">df</span><span class="o">.</span><span class="n">assign</span><span class="p">(</span><span class="o">**</span><span class="n">param_columns</span><span class="p">)</span>
        <span class="n">result_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">result_df</span><span class="p">,</span> <span class="n">df</span><span class="p">],</span> <span class="n">ignore_index</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">with</span> <span class="n">futures</span><span class="o">.</span><span class="n">ThreadPoolExecutor</span><span class="p">(</span><span class="n">max_workers</span><span class="o">=</span><span class="mi">16</span><span class="p">)</span> <span class="k">as</span> <span class="n">executor</span><span class="p">:</span>
        <span class="n">executor</span><span class="o">.</span><span class="n">map</span><span class="p">(</span><span class="n">single_request</span><span class="p">,</span> <span class="n">params_list</span><span class="p">)</span>

    <span class="n">reordered_df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">(</span>
        <span class="p">[</span>
            <span class="n">result_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="n">param_regex</span><span class="p">),</span>
            <span class="n">result_df</span><span class="o">.</span><span class="n">filter</span><span class="p">(</span><span class="n">regex</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;^(?!</span><span class="si">{</span><span class="n">param_regex</span><span class="si">}</span><span class="s2">)&quot;</span><span class="p">),</span>
        <span class="p">],</span>
        <span class="n">axis</span><span class="o">=</span><span class="mi">1</span><span class="p">,</span>
    <span class="p">)</span>
    <span class="n">reordered_df</span><span class="p">[</span><span class="s2">&quot;query_time&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">Timestamp</span><span class="o">.</span><span class="n">utcnow</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">reordered_df</span></div>

</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2024, Elias Dabbas.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>