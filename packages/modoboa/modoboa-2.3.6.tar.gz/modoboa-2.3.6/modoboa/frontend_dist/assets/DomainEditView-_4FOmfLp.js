import{O as M,b as j,u as q,a4 as G,i as U,G as f,d as K,f as u,o as s,c as d,R as p,a,w as e,S as c,t as o,e as V,U as L,_ as Q,J as z,N as H}from"./index-Bbkf9DIc.js";import{_ as W,a as X,b as Y,c as Z}from"./DomainTransportForm-C3p8Cij1.js";import{L as ee}from"./LoadingData-DaBVNfjg.js";import{p as ae}from"./parameters-0JGAlobG.js";import{_ as te}from"./ResourcesForm-Duu6t3va.js";import{s as E,h as T,g as P}from"./index-CDn75bM3.js";import{V as F,c as h,a as x,b as le}from"./VExpansionPanels-C3Er6iaF.js";import{a as _,V as i}from"./VRow-DnWvWxV-.js";import{V as oe,a as se}from"./VToolbar-BMyNQ6K-.js";import"./ChoiceField-2xK3jpng.js";import"./VForm-BCtIZQOE.js";import"./tag-BgJ4tZGv.js";import"./VTextField-Djz_9Wz9.js";import"./VProgressCircular-o4TPEeLK.js";import"./forwardRefs-zpUiuLw8.js";import"./ssrBoot-C8G7_1W2.js";import"./dimensions-CxFA8Z4w.js";import"./VAvatar-CcSwNzJ2.js";import"./VSwitch-MOiUeFZQ.js";import"./VChip-DoOT6ijG.js";import"./VAutocomplete-BqJxkVxD.js";import"./VSelect-0_bFDN-s.js";import"./VMenu-pbjiSmmM.js";import"./filter-BVTKTv4O.js";import"./VCheckbox-C7p6F9aZ.js";import"./VContainer-D7EM81q4.js";/* empty css              */const ue={key:1},re={key:0},ne={key:0},ie={key:0},me={class:"mr-2"},de={class:"mr-2"},ce={class:"mr-2"},fe={key:0},_e={class:"mr-2"},pe={class:"mt-4 d-flex justify-end"},ve={__name:"DomainEditForm",props:{domain:{type:Object,default:null}},setup($){const S=M(),{$gettext:r}=j(),b=q(),v=G(),D=$,y=U(()=>b.authUser),g=f({}),N=f(0),k=f(!1),l=U(()=>D.domain),C=f(),A=f(),R=f(),B=f(),O=f(),I=U(()=>{const m={generalForm:C,limitationForm:B,dnsForm:O};return l.value.type==="relaydomain"&&(m.transportForm=R),g.value.params&&g.value.params.enable_domain_limits&&(y.value.role==="SuperAdmins"||y.value.role==="Resellers")&&(m.resourcesForm=A),m}),w=f(!1);async function J(){w.value=!1,N.value=[];for(const[m,n]of Object.entries(I.value))if(n.value!=null){const{valid:t}=await n.value.vFormRef.validate();t||(w.value=!0,N.value.push(m))}if(!w.value){k.value=!0;try{const m=JSON.parse(JSON.stringify(l.value));m.transport===null&&delete m.transport,m.type==="relaydomain"&&R.value.checkSettingTypes(m),v.updateDomain(m).then(()=>{S.go(-1)})}finally{k.value=!1}}}return K(()=>{ae.getApplication("limits").then(m=>{g.value.data=m.data})}),(m,n)=>!u(v).domainsLoaded||k.value?(s(),d(ee,{key:0})):(s(),p("div",ue,[a(le,{modelValue:N.value,"onUpdate:modelValue":n[5]||(n[5]=t=>N.value=t),multiple:w.value},{default:e(()=>[a(F,{eager:"",value:"generalForm"},{default:e(()=>[a(h,null,{default:e(({expanded:t})=>[a(_,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(o(u(r)("General")),1)]),_:1}),a(i,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(E,{"leave-absolute":""},{default:e(()=>[t?(s(),p("span",re)):(s(),d(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(i,{cols:"6"},{default:e(()=>[c(o(u(r)("Name: "))+" "+o(l.value.name),1)]),_:1}),a(i,{cols:"6"},{default:e(()=>[c(o(u(r)("Type: "))+" "+o(l.value.type),1)]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(x,null,{default:e(()=>[a(W,{ref_key:"generalForm",ref:C,modelValue:l.value,"onUpdate:modelValue":n[0]||(n[0]=t=>l.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),a(F,{eager:"",value:"dnsForm"},{default:e(()=>[a(h,null,{default:e(({expanded:t})=>[a(_,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(o(u(r)("DNS")),1)]),_:1}),a(i,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(E,{"leave-absolute":""},{default:e(()=>[t?(s(),p("span",ne)):(s(),d(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(i,{cols:"6"},{default:e(()=>[c(o(u(r)("DNS checks"))+" ",1),l.value.enable_dns_checks?(s(),d(T,{key:0,color:"success",icon:"mdi-check-circle-outline"})):(s(),d(T,{key:1,icon:"mdi-check-circle-outline"}))]),_:1}),a(i,{cols:"6"},{default:e(()=>[c(o(u(r)("DKIM signing"))+" ",1),l.value.enable_dkim?(s(),d(T,{key:0,color:"success",icon:"mdi-check-circle-outline"})):(s(),d(T,{key:1,icon:"mdi-close-circle-outline"}))]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(x,null,{default:e(()=>[a(X,{ref_key:"dnsForm",ref:O,modelValue:l.value,"onUpdate:modelValue":n[1]||(n[1]=t=>l.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),a(F,{eager:"",value:"limitationForm"},{default:e(()=>[a(h,null,{default:e(({expanded:t})=>[a(_,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(o(u(r)("Limitations")),1)]),_:1}),a(i,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(E,{"leave-absolute":""},{default:e(()=>[t?(s(),p("span",ie)):(s(),d(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(i,{cols:"6"},{default:e(()=>[V("div",me,o(u(r)("Quota: "))+" "+o(l.value.quota),1)]),_:1}),l.value.message_limit?(s(),d(i,{key:0,cols:"6"},{default:e(()=>[V("div",de,o(u(r)("Sending limit: "))+" "+o(l.value.message_limit),1)]),_:1})):(s(),d(i,{key:1,cols:"6"},{default:e(()=>[V("div",ce,o(u(r)("No sending limit")),1)]),_:1}))]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(x,null,{default:e(()=>[a(Y,{ref_key:"limitationForm",ref:B,modelValue:l.value,"onUpdate:modelValue":n[2]||(n[2]=t=>l.value=t)},null,8,["modelValue"])]),_:1})]),_:1}),l.value.type==="relaydomain"?(s(),d(F,{key:0,value:"transportForm",eager:""},{default:e(()=>[a(h,null,{default:e(({expanded:t})=>[a(_,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(o(u(r)("Transport")),1)]),_:1}),a(i,{cols:"8",class:"text-medium-emphasis"},{default:e(()=>[a(E,{"leave-absolute":""},{default:e(()=>[t?(s(),p("span",fe)):(s(),d(_,{key:1,"no-gutters":"",style:{width:"100%"}},{default:e(()=>[a(i,{cols:"6"},{default:e(()=>[V("div",_e,o(u(r)("Service: "))+" "+o(l.value.transport.service),1)]),_:1})]),_:1}))]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:1}),a(x,null,{default:e(()=>[a(Z,{ref_key:"transportForm",ref:R,modelValue:l.value.transport,"onUpdate:modelValue":n[3]||(n[3]=t=>l.value.transport=t)},null,8,["modelValue"])]),_:1})]),_:1})):L("",!0),g.value.params&&g.value.params.enable_domain_limits&&(y.value.role==="SuperAdmins"||y.value.role==="Resellers")?(s(),d(F,{key:1,value:"resourcesForm",eager:""},{default:e(()=>[a(h,null,{default:e(()=>[a(_,{"no-gutters":""},{default:e(()=>[a(i,{cols:"4"},{default:e(()=>[c(o(u(r)("Resources")),1)]),_:1})]),_:1})]),_:1}),a(x,null,{default:e(()=>[a(te,{ref_key:"resourcesForm",ref:A,modelValue:l.value.resources,"onUpdate:modelValue":n[4]||(n[4]=t=>l.value.resources=t)},null,8,["modelValue"])]),_:1})]),_:1})):L("",!0)]),_:1},8,["modelValue","multiple"]),V("div",pe,[a(P,{loading:k.value,onClick:n[6]||(n[6]=t=>u(S).go(-1))},{default:e(()=>[c(o(u(r)("Cancel")),1)]),_:1},8,["loading"]),a(P,{class:"ml-4",color:"primary darken-1",loading:k.value,onClick:J},{default:e(()=>[c(o(u(r)("Save")),1)]),_:1},8,["loading"])])]))}},ye={__name:"DomainEditView",setup($){const{$gettext:S}=j(),r=G(),b=H(),v=f({pk:b.params.id});return r.getDomain(b.params.id).then(D=>v.value=D.data),(D,y)=>(s(),p(z,null,[a(oe,{flat:""},{default:e(()=>[a(se,null,{default:e(()=>[c(o(u(S)("Edit domain")),1)]),_:1})]),_:1}),a(u(ve),{domain:v.value},null,8,["domain"])],64))}},qe=Q(ye,[["__scopeId","data-v-cef8ecfe"]]);export{qe as default};
