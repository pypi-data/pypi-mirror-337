import{ac as ze,b as X,a0 as ne,u as ie,i as z,G as _,d as me,k as he,o as R,c as D,w as d,a as s,S as A,t as g,f as m,W as ce,e as k,aN as ye,aO as se,aw as Me,q as xe,ao as Qe,z as He,F as Ke,a6 as Ye,H as We,K as qe,ak as Ge,J as Q,I as ke,aP as Ve,R as $,U as q,V as Ne,aM as Y,Z as Je,aQ as Xe,_ as Ze}from"./index-Bbkf9DIc.js";import{_ as je}from"./AccountPasswordSubForm-Deeun_9B.js";import{V as ee,r as te}from"./VForm-BCtIZQOE.js";import{V as Ee,c as Re,a as Pe,b as et}from"./VExpansionPanels-C3Er6iaF.js";import{V as K,g as tt,b as at,u as ot,c as nt}from"./VTextField-Djz_9Wz9.js";import{V as lt}from"./VAutocomplete-BqJxkVxD.js";import{g as H,h as ge}from"./index-CDn75bM3.js";import{V as pe,a as G,c as J,b as be}from"./VCard-DLgKmdoO.js";import{a as de,V as ue}from"./VRow-DnWvWxV-.js";import{V as Z}from"./VAlert-Da5j80B0.js";import{c as rt}from"./VMenu-pbjiSmmM.js";import{V as st}from"./VProgressCircular-o4TPEeLK.js";import{m as ut,u as it}from"./dimensions-CxFA8Z4w.js";import{u as dt}from"./tag-BgJ4tZGv.js";import{r as Fe}from"./VDataTable-BfFW1vg6.js";import{V as ct}from"./VSpacer-CPtHAmtO.js";import{V as Te}from"./VDialog-CLTUldPN.js";import{V as Ie}from"./VTextarea-CCOY15Y4.js";import{V as Ue}from"./VCheckbox-C7p6F9aZ.js";import{_ as _e}from"./ConfirmDialog-DXHV8KLb.js";import{V as ft}from"./VDataTableVirtual-BU6jal2B.js";import{V as vt,a as mt}from"./VToolbar-BMyNQ6K-.js";import{V as pt,a as ht,b as le,c as re}from"./VTabs-DXxJe3KI.js";import"./VSwitch-MOiUeFZQ.js";import"./VChip-DoOT6ijG.js";import"./VAvatar-CcSwNzJ2.js";import"./forwardRefs-zpUiuLw8.js";import"./ssrBoot-C8G7_1W2.js";import"./VSelect-0_bFDN-s.js";import"./filter-BVTKTv4O.js";/* empty css              */import"./VWindowItem-D5SUtcL1.js";const gt="languages",_t={getAll(){return ze.get(`/${gt}/`)}},yt={class:"m-label"},bt={class:"m-label"},wt={class:"m-label"},Ct={class:"text-disabled"},At={href:"https://explore.transifex.com/tonio/modoboa/",target:"_blank"},kt={href:"https://github.com/modoboa/modoboa/issues/new/choose",target:"_blank"},Vt={class:"m-label"},Et={class:"m-label"},Rt={__name:"ProfileForm",setup(r){const{$gettext:l,available:i}=X(),u=ne(),c=ie(),p=z(()=>c.authUser),o=_({}),e=_(),t=_(),a=_([]),n=_(0),f=_(!1),v=_(!1),h=_("");function y(w){o.value={first_name:w.first_name,last_name:w.last_name,language:w.language,phone_number:w.phone_number,secondary_email:w.secondary_email}}async function C(){const{valid:w}=await e.value.validate();w&&(f.value=!0,c.updateAccount(o.value).then(()=>{u.displayNotification({msg:l("Profile updated")}),console.log(c.accountLanguage),console.log(i),c.accountLanguage in i||(h.value=l("Language does no exist"))}).finally(()=>f.value=!1))}async function T(){const{valid:w}=await t.value.validate();w&&(v.value=!0,c.updateAccount({password:o.value.password}).then(()=>{u.displayNotification({msg:l("Password updated")})}).finally(()=>v.value=!1))}return me(()=>{y(p.value),_t.getAll().then(w=>{a.value=w.data})}),he(()=>p,w=>{w?y(w):o.value={}}),(w,S)=>(R(),D(et,{modelValue:n.value,"onUpdate:modelValue":S[6]||(S[6]=M=>n.value=M),flat:""},{default:d(()=>[s(Ee,null,{default:d(()=>[s(Re,null,{default:d(()=>[A(g(m(l)("General settings")),1)]),_:1}),s(Pe,null,{default:d(()=>[s(ee,{ref_key:"profileForm",ref:e,onSubmit:ce(C,["prevent"])},{default:d(()=>[k("label",yt,g(m(l)("First name")),1),s(K,{modelValue:o.value.first_name,"onUpdate:modelValue":S[0]||(S[0]=M=>o.value.first_name=M),variant:"outlined",density:"compact"},null,8,["modelValue"]),k("label",bt,g(m(l)("Last name")),1),s(K,{modelValue:o.value.last_name,"onUpdate:modelValue":S[1]||(S[1]=M=>o.value.last_name=M),variant:"outlined",density:"compact"},null,8,["modelValue"]),k("label",wt,[A(g(m(l)("Language"))+" ",1),k("p",Ct,[A(g(m(l)("Feel free to improve the translations"))+" ",1),k("a",At,g(m(l)("here")),1),A(" "+g(m(l)("or suggest a new language"))+" ",1),k("a",kt,g(m(l)("there")),1)])]),s(lt,{modelValue:o.value.language,"onUpdate:modelValue":S[2]||(S[2]=M=>o.value.language=M),items:a.value,"item-title":"label","item-value":"code",variant:"outlined",density:"compact","error-messages":h.value},null,8,["modelValue","items","error-messages"]),k("label",Vt,g(m(l)("Phone number")),1),s(K,{modelValue:o.value.phone_number,"onUpdate:modelValue":S[3]||(S[3]=M=>o.value.phone_number=M),label:m(l)("Phone number"),variant:"outlined",density:"compact"},null,8,["modelValue","label"]),k("label",Et,g(m(l)("Secondary email")),1),s(K,{modelValue:o.value.secondary_email,"onUpdate:modelValue":S[4]||(S[4]=M=>o.value.secondary_email=M),variant:"outlined",density:"compact",rules:[m(te).emailOrNull]},null,8,["modelValue","rules"]),s(H,{color:"success",type:"submit",loading:f.value},{default:d(()=>[A(g(m(l)("Update settings")),1)]),_:1},8,["loading"])]),_:1},512)]),_:1})]),_:1}),s(Ee,null,{default:d(()=>[s(Re,null,{default:d(()=>[A(g(m(l)("Password")),1)]),_:1}),s(Pe,null,{default:d(()=>[s(ee,{ref_key:"passwordForm",ref:t,onSubmit:ce(T,["prevent"])},{default:d(()=>[s(je,{modelValue:o.value,"onUpdate:modelValue":S[5]||(S[5]=M=>o.value=M),"with-password-check":""},null,8,["modelValue"]),s(H,{color:"success",type:"submit",loading:v.value},{default:d(()=>[A(g(m(l)("Update Password")),1)]),_:1},8,["loading"])]),_:1},512)]),_:1})]),_:1})]),_:1},8,["modelValue"]))}};/*!
 * qrcode.vue v3.4.1
 * A Vue.js component to generate QRCode.
 * Â© 2017-2023 @scopewu(https://github.com/scopewu)
 * MIT License.
 */var fe=function(){return fe=Object.assign||function(l){for(var i,u=1,c=arguments.length;u<c;u++){i=arguments[u];for(var p in i)Object.prototype.hasOwnProperty.call(i,p)&&(l[p]=i[p])}return l},fe.apply(this,arguments)};var ae;(function(r){var l=function(){function o(e,t,a,n){if(this.version=e,this.errorCorrectionLevel=t,this.modules=[],this.isFunction=[],e<o.MIN_VERSION||e>o.MAX_VERSION)throw new RangeError("Version value out of range");if(n<-1||n>7)throw new RangeError("Mask value out of range");this.size=e*4+17;for(var f=[],v=0;v<this.size;v++)f.push(!1);for(var v=0;v<this.size;v++)this.modules.push(f.slice()),this.isFunction.push(f.slice());this.drawFunctionPatterns();var h=this.addEccAndInterleave(a);if(this.drawCodewords(h),n==-1)for(var y=1e9,v=0;v<8;v++){this.applyMask(v),this.drawFormatBits(v);var C=this.getPenaltyScore();C<y&&(n=v,y=C),this.applyMask(v)}c(0<=n&&n<=7),this.mask=n,this.applyMask(n),this.drawFormatBits(n),this.isFunction=[]}return o.encodeText=function(e,t){var a=r.QrSegment.makeSegments(e);return o.encodeSegments(a,t)},o.encodeBinary=function(e,t){var a=r.QrSegment.makeBytes(e);return o.encodeSegments([a],t)},o.encodeSegments=function(e,t,a,n,f,v){if(a===void 0&&(a=1),n===void 0&&(n=40),f===void 0&&(f=-1),v===void 0&&(v=!0),!(o.MIN_VERSION<=a&&a<=n&&n<=o.MAX_VERSION)||f<-1||f>7)throw new RangeError("Invalid value");var h,y;for(h=a;;h++){var C=o.getNumDataCodewords(h,t)*8,T=p.getTotalBits(e,h);if(T<=C){y=T;break}if(h>=n)throw new RangeError("Data too long")}for(var w=0,S=[o.Ecc.MEDIUM,o.Ecc.QUARTILE,o.Ecc.HIGH];w<S.length;w++){var M=S[w];v&&y<=o.getNumDataCodewords(h,M)*8&&(t=M)}for(var V=[],P=0,E=e;P<E.length;P++){var F=E[P];i(F.mode.modeBits,4,V),i(F.numChars,F.mode.numCharCountBits(h),V);for(var b=0,N=F.getData();b<N.length;b++){var L=N[b];V.push(L)}}c(V.length==y);var O=o.getNumDataCodewords(h,t)*8;c(V.length<=O),i(0,Math.min(4,O-V.length),V),i(0,(8-V.length%8)%8,V),c(V.length%8==0);for(var U=236;V.length<O;U^=253)i(U,8,V);for(var W=[];W.length*8<V.length;)W.push(0);return V.forEach(function(Le,Ae){return W[Ae>>>3]|=Le<<7-(Ae&7)}),new o(h,t,W,f)},o.prototype.getModule=function(e,t){return 0<=e&&e<this.size&&0<=t&&t<this.size&&this.modules[t][e]},o.prototype.getModules=function(){return this.modules},o.prototype.drawFunctionPatterns=function(){for(var e=0;e<this.size;e++)this.setFunctionModule(6,e,e%2==0),this.setFunctionModule(e,6,e%2==0);this.drawFinderPattern(3,3),this.drawFinderPattern(this.size-4,3),this.drawFinderPattern(3,this.size-4);for(var t=this.getAlignmentPatternPositions(),a=t.length,e=0;e<a;e++)for(var n=0;n<a;n++)e==0&&n==0||e==0&&n==a-1||e==a-1&&n==0||this.drawAlignmentPattern(t[e],t[n]);this.drawFormatBits(0),this.drawVersion()},o.prototype.drawFormatBits=function(e){for(var t=this.errorCorrectionLevel.formatBits<<3|e,a=t,n=0;n<10;n++)a=a<<1^(a>>>9)*1335;var f=(t<<10|a)^21522;c(f>>>15==0);for(var n=0;n<=5;n++)this.setFunctionModule(8,n,u(f,n));this.setFunctionModule(8,7,u(f,6)),this.setFunctionModule(8,8,u(f,7)),this.setFunctionModule(7,8,u(f,8));for(var n=9;n<15;n++)this.setFunctionModule(14-n,8,u(f,n));for(var n=0;n<8;n++)this.setFunctionModule(this.size-1-n,8,u(f,n));for(var n=8;n<15;n++)this.setFunctionModule(8,this.size-15+n,u(f,n));this.setFunctionModule(8,this.size-8,!0)},o.prototype.drawVersion=function(){if(!(this.version<7)){for(var e=this.version,t=0;t<12;t++)e=e<<1^(e>>>11)*7973;var a=this.version<<12|e;c(a>>>18==0);for(var t=0;t<18;t++){var n=u(a,t),f=this.size-11+t%3,v=Math.floor(t/3);this.setFunctionModule(f,v,n),this.setFunctionModule(v,f,n)}}},o.prototype.drawFinderPattern=function(e,t){for(var a=-4;a<=4;a++)for(var n=-4;n<=4;n++){var f=Math.max(Math.abs(n),Math.abs(a)),v=e+n,h=t+a;0<=v&&v<this.size&&0<=h&&h<this.size&&this.setFunctionModule(v,h,f!=2&&f!=4)}},o.prototype.drawAlignmentPattern=function(e,t){for(var a=-2;a<=2;a++)for(var n=-2;n<=2;n++)this.setFunctionModule(e+n,t+a,Math.max(Math.abs(n),Math.abs(a))!=1)},o.prototype.setFunctionModule=function(e,t,a){this.modules[t][e]=a,this.isFunction[t][e]=!0},o.prototype.addEccAndInterleave=function(e){var t=this.version,a=this.errorCorrectionLevel;if(e.length!=o.getNumDataCodewords(t,a))throw new RangeError("Invalid argument");for(var n=o.NUM_ERROR_CORRECTION_BLOCKS[a.ordinal][t],f=o.ECC_CODEWORDS_PER_BLOCK[a.ordinal][t],v=Math.floor(o.getNumRawDataModules(t)/8),h=n-v%n,y=Math.floor(v/n),C=[],T=o.reedSolomonComputeDivisor(f),w=0,S=0;w<n;w++){var M=e.slice(S,S+y-f+(w<h?0:1));S+=M.length;var V=o.reedSolomonComputeRemainder(M,T);w<h&&M.push(0),C.push(M.concat(V))}for(var P=[],E=function(F){C.forEach(function(b,N){(F!=y-f||N>=h)&&P.push(b[F])})},w=0;w<C[0].length;w++)E(w);return c(P.length==v),P},o.prototype.drawCodewords=function(e){if(e.length!=Math.floor(o.getNumRawDataModules(this.version)/8))throw new RangeError("Invalid argument");for(var t=0,a=this.size-1;a>=1;a-=2){a==6&&(a=5);for(var n=0;n<this.size;n++)for(var f=0;f<2;f++){var v=a-f,h=(a+1&2)==0,y=h?this.size-1-n:n;!this.isFunction[y][v]&&t<e.length*8&&(this.modules[y][v]=u(e[t>>>3],7-(t&7)),t++)}}c(t==e.length*8)},o.prototype.applyMask=function(e){if(e<0||e>7)throw new RangeError("Mask value out of range");for(var t=0;t<this.size;t++)for(var a=0;a<this.size;a++){var n=void 0;switch(e){case 0:n=(a+t)%2==0;break;case 1:n=t%2==0;break;case 2:n=a%3==0;break;case 3:n=(a+t)%3==0;break;case 4:n=(Math.floor(a/3)+Math.floor(t/2))%2==0;break;case 5:n=a*t%2+a*t%3==0;break;case 6:n=(a*t%2+a*t%3)%2==0;break;case 7:n=((a+t)%2+a*t%3)%2==0;break;default:throw new Error("Unreachable")}!this.isFunction[t][a]&&n&&(this.modules[t][a]=!this.modules[t][a])}},o.prototype.getPenaltyScore=function(){for(var e=0,t=0;t<this.size;t++){for(var a=!1,n=0,f=[0,0,0,0,0,0,0],v=0;v<this.size;v++)this.modules[t][v]==a?(n++,n==5?e+=o.PENALTY_N1:n>5&&e++):(this.finderPenaltyAddHistory(n,f),a||(e+=this.finderPenaltyCountPatterns(f)*o.PENALTY_N3),a=this.modules[t][v],n=1);e+=this.finderPenaltyTerminateAndCount(a,n,f)*o.PENALTY_N3}for(var v=0;v<this.size;v++){for(var a=!1,h=0,f=[0,0,0,0,0,0,0],t=0;t<this.size;t++)this.modules[t][v]==a?(h++,h==5?e+=o.PENALTY_N1:h>5&&e++):(this.finderPenaltyAddHistory(h,f),a||(e+=this.finderPenaltyCountPatterns(f)*o.PENALTY_N3),a=this.modules[t][v],h=1);e+=this.finderPenaltyTerminateAndCount(a,h,f)*o.PENALTY_N3}for(var t=0;t<this.size-1;t++)for(var v=0;v<this.size-1;v++){var y=this.modules[t][v];y==this.modules[t][v+1]&&y==this.modules[t+1][v]&&y==this.modules[t+1][v+1]&&(e+=o.PENALTY_N2)}for(var C=0,T=0,w=this.modules;T<w.length;T++){var S=w[T];C=S.reduce(function(P,E){return P+(E?1:0)},C)}var M=this.size*this.size,V=Math.ceil(Math.abs(C*20-M*10)/M)-1;return c(0<=V&&V<=9),e+=V*o.PENALTY_N4,c(0<=e&&e<=2568888),e},o.prototype.getAlignmentPatternPositions=function(){if(this.version==1)return[];for(var e=Math.floor(this.version/7)+2,t=this.version==32?26:Math.ceil((this.version*4+4)/(e*2-2))*2,a=[6],n=this.size-7;a.length<e;n-=t)a.splice(1,0,n);return a},o.getNumRawDataModules=function(e){if(e<o.MIN_VERSION||e>o.MAX_VERSION)throw new RangeError("Version number out of range");var t=(16*e+128)*e+64;if(e>=2){var a=Math.floor(e/7)+2;t-=(25*a-10)*a-55,e>=7&&(t-=36)}return c(208<=t&&t<=29648),t},o.getNumDataCodewords=function(e,t){return Math.floor(o.getNumRawDataModules(e)/8)-o.ECC_CODEWORDS_PER_BLOCK[t.ordinal][e]*o.NUM_ERROR_CORRECTION_BLOCKS[t.ordinal][e]},o.reedSolomonComputeDivisor=function(e){if(e<1||e>255)throw new RangeError("Degree out of range");for(var t=[],a=0;a<e-1;a++)t.push(0);t.push(1);for(var n=1,a=0;a<e;a++){for(var f=0;f<t.length;f++)t[f]=o.reedSolomonMultiply(t[f],n),f+1<t.length&&(t[f]^=t[f+1]);n=o.reedSolomonMultiply(n,2)}return t},o.reedSolomonComputeRemainder=function(e,t){for(var a=t.map(function(y){return 0}),n=function(y){var C=y^a.shift();a.push(0),t.forEach(function(T,w){return a[w]^=o.reedSolomonMultiply(T,C)})},f=0,v=e;f<v.length;f++){var h=v[f];n(h)}return a},o.reedSolomonMultiply=function(e,t){if(e>>>8||t>>>8)throw new RangeError("Byte out of range");for(var a=0,n=7;n>=0;n--)a=a<<1^(a>>>7)*285,a^=(t>>>n&1)*e;return c(a>>>8==0),a},o.prototype.finderPenaltyCountPatterns=function(e){var t=e[1];c(t<=this.size*3);var a=t>0&&e[2]==t&&e[3]==t*3&&e[4]==t&&e[5]==t;return(a&&e[0]>=t*4&&e[6]>=t?1:0)+(a&&e[6]>=t*4&&e[0]>=t?1:0)},o.prototype.finderPenaltyTerminateAndCount=function(e,t,a){return e&&(this.finderPenaltyAddHistory(t,a),t=0),t+=this.size,this.finderPenaltyAddHistory(t,a),this.finderPenaltyCountPatterns(a)},o.prototype.finderPenaltyAddHistory=function(e,t){t[0]==0&&(e+=this.size),t.pop(),t.unshift(e)},o.MIN_VERSION=1,o.MAX_VERSION=40,o.PENALTY_N1=3,o.PENALTY_N2=3,o.PENALTY_N3=40,o.PENALTY_N4=10,o.ECC_CODEWORDS_PER_BLOCK=[[-1,7,10,15,20,26,18,20,24,30,18,20,24,26,30,22,24,28,30,28,28,28,28,30,30,26,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,10,16,26,18,24,16,18,22,22,26,30,22,22,24,24,28,28,26,26,26,26,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28,28],[-1,13,22,18,26,18,24,18,22,20,24,28,26,24,20,30,24,28,28,26,30,28,30,30,30,30,28,30,30,30,30,30,30,30,30,30,30,30,30,30,30],[-1,17,28,22,16,22,28,26,26,24,28,24,28,22,24,24,30,28,28,26,28,30,24,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30,30]],o.NUM_ERROR_CORRECTION_BLOCKS=[[-1,1,1,1,1,1,2,2,2,2,4,4,4,4,4,6,6,6,6,7,8,8,9,9,10,12,12,12,13,14,15,16,17,18,19,19,20,21,22,24,25],[-1,1,1,1,2,2,4,4,4,5,5,5,8,9,9,10,10,11,13,14,16,17,17,18,20,21,23,25,26,28,29,31,33,35,37,38,40,43,45,47,49],[-1,1,1,2,2,4,4,6,6,8,8,8,10,12,16,12,17,16,18,21,20,23,23,25,27,29,34,34,35,38,40,43,45,48,51,53,56,59,62,65,68],[-1,1,1,2,4,4,4,5,6,8,8,11,11,16,16,18,16,19,21,25,25,25,34,30,32,35,37,40,42,45,48,51,54,57,60,63,66,70,74,77,81]],o}();r.QrCode=l;function i(o,e,t){if(e<0||e>31||o>>>e)throw new RangeError("Value out of range");for(var a=e-1;a>=0;a--)t.push(o>>>a&1)}function u(o,e){return(o>>>e&1)!=0}function c(o){if(!o)throw new Error("Assertion error")}var p=function(){function o(e,t,a){if(this.mode=e,this.numChars=t,this.bitData=a,t<0)throw new RangeError("Invalid argument");this.bitData=a.slice()}return o.makeBytes=function(e){for(var t=[],a=0,n=e;a<n.length;a++){var f=n[a];i(f,8,t)}return new o(o.Mode.BYTE,e.length,t)},o.makeNumeric=function(e){if(!o.isNumeric(e))throw new RangeError("String contains non-numeric characters");for(var t=[],a=0;a<e.length;){var n=Math.min(e.length-a,3);i(parseInt(e.substring(a,a+n),10),n*3+1,t),a+=n}return new o(o.Mode.NUMERIC,e.length,t)},o.makeAlphanumeric=function(e){if(!o.isAlphanumeric(e))throw new RangeError("String contains unencodable characters in alphanumeric mode");var t=[],a;for(a=0;a+2<=e.length;a+=2){var n=o.ALPHANUMERIC_CHARSET.indexOf(e.charAt(a))*45;n+=o.ALPHANUMERIC_CHARSET.indexOf(e.charAt(a+1)),i(n,11,t)}return a<e.length&&i(o.ALPHANUMERIC_CHARSET.indexOf(e.charAt(a)),6,t),new o(o.Mode.ALPHANUMERIC,e.length,t)},o.makeSegments=function(e){return e==""?[]:o.isNumeric(e)?[o.makeNumeric(e)]:o.isAlphanumeric(e)?[o.makeAlphanumeric(e)]:[o.makeBytes(o.toUtf8ByteArray(e))]},o.makeEci=function(e){var t=[];if(e<0)throw new RangeError("ECI assignment value out of range");if(e<128)i(e,8,t);else if(e<16384)i(2,2,t),i(e,14,t);else if(e<1e6)i(6,3,t),i(e,21,t);else throw new RangeError("ECI assignment value out of range");return new o(o.Mode.ECI,0,t)},o.isNumeric=function(e){return o.NUMERIC_REGEX.test(e)},o.isAlphanumeric=function(e){return o.ALPHANUMERIC_REGEX.test(e)},o.prototype.getData=function(){return this.bitData.slice()},o.getTotalBits=function(e,t){for(var a=0,n=0,f=e;n<f.length;n++){var v=f[n],h=v.mode.numCharCountBits(t);if(v.numChars>=1<<h)return 1/0;a+=4+h+v.bitData.length}return a},o.toUtf8ByteArray=function(e){e=encodeURI(e);for(var t=[],a=0;a<e.length;a++)e.charAt(a)!="%"?t.push(e.charCodeAt(a)):(t.push(parseInt(e.substring(a+1,a+3),16)),a+=2);return t},o.NUMERIC_REGEX=/^[0-9]*$/,o.ALPHANUMERIC_REGEX=/^[A-Z0-9 $%*+.\/:-]*$/,o.ALPHANUMERIC_CHARSET="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",o}();r.QrSegment=p})(ae||(ae={}));(function(r){(function(l){var i=function(){function u(c,p){this.ordinal=c,this.formatBits=p}return u.LOW=new u(0,1),u.MEDIUM=new u(1,0),u.QUARTILE=new u(2,3),u.HIGH=new u(3,2),u}();l.Ecc=i})(r.QrCode||(r.QrCode={}))})(ae||(ae={}));(function(r){(function(l){var i=function(){function u(c,p){this.modeBits=c,this.numBitsCharCount=p}return u.prototype.numCharCountBits=function(c){return this.numBitsCharCount[Math.floor((c+7)/17)]},u.NUMERIC=new u(1,[10,12,14]),u.ALPHANUMERIC=new u(2,[9,11,13]),u.BYTE=new u(4,[8,16,16]),u.KANJI=new u(8,[8,10,12]),u.ECI=new u(7,[0,0,0]),u}();l.Mode=i})(r.QrSegment||(r.QrSegment={}))})(ae||(ae={}));var oe=ae,$e="H",we={L:oe.QrCode.Ecc.LOW,M:oe.QrCode.Ecc.MEDIUM,Q:oe.QrCode.Ecc.QUARTILE,H:oe.QrCode.Ecc.HIGH},Pt=function(){try{new Path2D().addPath(new Path2D)}catch{return!1}return!0}();function De(r){return r in we}function Oe(r,l){l===void 0&&(l=0);var i=[];return r.forEach(function(u,c){var p=null;u.forEach(function(o,e){if(!o&&p!==null){i.push("M".concat(p+l," ").concat(c+l,"h").concat(e-p,"v1H").concat(p+l,"z")),p=null;return}if(e===u.length-1){if(!o)return;p===null?i.push("M".concat(e+l,",").concat(c+l," h1v1H").concat(e+l,"z")):i.push("M".concat(p+l,",").concat(c+l," h").concat(e+1-p,"v1H").concat(p+l,"z"));return}o&&p===null&&(p=e)})}),i.join("")}var Ce={value:{type:String,required:!0,default:""},size:{type:Number,default:100},level:{type:String,default:$e,validator:function(r){return De(r)}},background:{type:String,default:"#fff"},foreground:{type:String,default:"#000"},margin:{type:Number,required:!1,default:0}},St=fe(fe({},Ce),{renderAs:{type:String,required:!1,default:"canvas",validator:function(r){return["canvas","svg"].indexOf(r)>-1}}}),Mt=ye({name:"QRCodeSvg",props:Ce,setup:function(r){var l=_(0),i=_(""),u=function(){var c=r.value,p=r.level,o=r.margin,e=oe.QrCode.encodeText(c,we[p]).getModules();l.value=e.length+o*2,i.value=Oe(e,o)};return u(),Me(u),function(){return se("svg",{width:r.size,height:r.size,"shape-rendering":"crispEdges",xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 ".concat(l.value," ").concat(l.value)},[se("path",{fill:r.background,d:"M0,0 h".concat(l.value,"v").concat(l.value,"H0z")}),se("path",{fill:r.foreground,d:i.value})])}}}),Nt=ye({name:"QRCodeCanvas",props:Ce,setup:function(r){var l=_(null),i=function(){var u=r.value,c=r.level,p=r.size,o=r.margin,e=r.background,t=r.foreground,a=l.value;if(a){var n=a.getContext("2d");if(n){var f=oe.QrCode.encodeText(u,we[c]).getModules(),v=f.length+o*2,h=window.devicePixelRatio||1,y=p/v*h;a.height=a.width=p*h,n.scale(y,y),n.fillStyle=e,n.fillRect(0,0,v,v),n.fillStyle=t,Pt?n.fill(new Path2D(Oe(f,o))):f.forEach(function(C,T){C.forEach(function(w,S){w&&n.fillRect(S+o,T+o,1,1)})})}}};return me(i),Me(i),function(){return se("canvas",{ref:l,style:{width:"".concat(r.size,"px"),height:"".concat(r.size,"px")}})}}}),Ft=ye({name:"Qrcode",render:function(){var r=this.$props,l=r.renderAs,i=r.value,u=r.size,c=r.margin,p=r.level,o=r.background,e=r.foreground,t=u>>>0,a=c>>>0,n=De(p)?p:$e;return se(l==="svg"?Mt:Nt,{value:i,size:t,margin:a,level:n,background:o,foreground:e})},props:St});const Tt=xe({autofocus:Boolean,divider:String,focusAll:Boolean,label:{type:String,default:"$vuetify.input.otp"},length:{type:[Number,String],default:6},modelValue:{type:[Number,String],default:void 0},placeholder:String,type:{type:String,default:"number"},...ut(),...tt(),...Qe(at({variant:"outlined"}),["baseColor","bgColor","class","color","disabled","error","loading","rounded","style","theme","variant"])},"VOtpInput"),It=He()({name:"VOtpInput",props:Tt(),emits:{finish:r=>!0,"update:focused":r=>!0,"update:modelValue":r=>!0},setup(r,l){let{attrs:i,emit:u,slots:c}=l;const{dimensionStyles:p}=it(r),{isFocused:o,focus:e,blur:t}=ot(r),a=Ke(r,"modelValue","",b=>b==null?[]:String(b).split(""),b=>b.join("")),{t:n}=Ye(),f=z(()=>Number(r.length)),v=z(()=>Array(f.value).fill(0)),h=_(-1),y=_(),C=_([]),T=z(()=>C.value[h.value]);function w(){if(F(T.value.value)){T.value.value="";return}const b=a.value.slice(),N=T.value.value;b[h.value]=N;let L=null;h.value>a.value.length?L=a.value.length+1:h.value+1!==f.value&&(L="next"),a.value=b,L&&Ve(y.value,L)}function S(b){const N=a.value.slice(),L=h.value;let O=null;["ArrowLeft","ArrowRight","Backspace","Delete"].includes(b.key)&&(b.preventDefault(),b.key==="ArrowLeft"?O="prev":b.key==="ArrowRight"?O="next":["Backspace","Delete"].includes(b.key)&&(N[h.value]="",a.value=N,h.value>0&&b.key==="Backspace"?O="prev":requestAnimationFrame(()=>{var U;(U=C.value[L])==null||U.select()})),requestAnimationFrame(()=>{O!=null&&Ve(y.value,O)}))}function M(b,N){var O,U;N.preventDefault(),N.stopPropagation();const L=((O=N==null?void 0:N.clipboardData)==null?void 0:O.getData("Text"))??"";F(L)||(a.value=L.split(""),(U=C.value)==null||U[b].blur())}function V(){a.value=[]}function P(b,N){e(),h.value=N}function E(){t(),h.value=-1}function F(b){return r.type==="number"&&/[^0-9]/g.test(b)}return We({VField:{color:z(()=>r.color),bgColor:z(()=>r.color),baseColor:z(()=>r.baseColor),disabled:z(()=>r.disabled),error:z(()=>r.error),variant:z(()=>r.variant)}},{scoped:!0}),he(a,b=>{b.length===f.value&&u("finish",b.join(""))},{deep:!0}),he(h,b=>{b<0||qe(()=>{var N;(N=C.value[b])==null||N.select()})}),dt(()=>{var L;const[b,N]=Ge(i);return s("div",ke({class:["v-otp-input",{"v-otp-input--divided":!!r.divider},r.class],style:[r.style]},b),[s("div",{ref:y,class:"v-otp-input__content",style:[p.value]},[v.value.map((O,U)=>s(Q,null,[r.divider&&U!==0&&s("span",{class:"v-otp-input__divider"},[r.divider]),s(nt,{focused:o.value&&r.focusAll||h.value===U,key:U},{...c,loader:void 0,default:()=>s("input",{ref:W=>C.value[U]=W,"aria-label":n(r.label,U+1),autofocus:U===0&&r.autofocus,autocomplete:"one-time-code",class:["v-otp-input__field"],disabled:r.disabled,inputmode:r.type==="number"?"numeric":"text",min:r.type==="number"?0:void 0,maxlength:"1",placeholder:r.placeholder,type:r.type==="number"?"text":r.type,value:a.value[U],onInput:w,onFocus:W=>P(W,U),onBlur:E,onKeydown:S,onPaste:W=>M(U,W)},null)})])),s("input",ke({class:"v-otp-input-input",type:"hidden"},N,{value:a.value.join("")}),null),s(rt,{contained:!0,"content-class":"v-otp-input__loader","model-value":!!r.loading,persistent:!0},{default:()=>{var O;return[((O=c.loader)==null?void 0:O.call(c))??s(st,{color:typeof r.loading=="boolean"?void 0:r.loading,indeterminate:!0,size:"24",width:"2"},null)]}}),(L=c.default)==null?void 0:L.call(c)])])}),{blur:()=>{var b;(b=C.value)==null||b.some(N=>N.blur())},focus:()=>{var b;(b=C.value)==null||b[0].focus()},reset:V,isFocused:o}}}),Ut={class:"text-h6"},$t={class:"m-label"},Dt={class:"mt-4"},Ot={class:"m-label"},Bt={class:"mt-5"},Lt={tag:"p",class:"my-4"},zt={__name:"TotpAuthForm",setup(r){const{$gettext:l}=X(),i=ne(),u=ie(),c=_(),p=_(""),o=_([]),e=_(null),t=_(null),a=_(!1),n=_(!1),f=_(""),v=_([]),h=_([]),y=_(!1),C=z(()=>u.authUser.totp_enabled);function T(){Y.getKeyForTFASetup().then(P=>{e.value=P.data.key,t.value=P.data.url})}function w(){navigator.clipboard.writeText(e.value),a.value=!0}function S(){Y.startTFASetup().then(()=>{T()})}function M(){u.finalizeTFASetup(p.value).then(P=>{e.value=null,t.value=null,P.status===200&&(h.value=P.data.tokens),y.value=!0}).catch(P=>{P.response.status===400&&(o.value=P.response.data.pin_code)})}async function V(){if(!await c.value.validate())return;const E={password:f.value};n.value=!0,Y.disableTFA(E).then(()=>{u.fetchUser()}).catch(F=>{F.response.status===400?v.value=F.response.data.password:i.displayNotification({msg:l(F.response.data),type:"error"})}).finally(()=>{n.value=!1,c.value.reset()})}return(P,E)=>(R(),$("div",null,[s(J,{flat:""},{default:d(()=>[s(pe,null,{default:d(()=>[k("span",Ut,g(m(l)("One-time passwords")),1)]),_:1}),s(G,null,{default:d(()=>[t.value?(R(),D(de,{key:0},{default:d(()=>[s(ue,{cols:"4"},{default:d(()=>[s(de,{rows:"2"},{default:d(()=>[s(Ft,{value:t.value,size:250,"render-as":"svg",level:"H",class:"qrcode"},null,8,["value"])]),_:1}),s(de,null,{default:d(()=>[s(H,{color:"primary",class:"key",onClick:w},{default:d(()=>[A(g(m(l)("Click here to copy the key"))+" ",1),a.value?(R(),D(ge,{key:0,color:"success"},{default:d(()=>[A(" mdi-check-all ")]),_:1})):q("",!0)]),_:1})]),_:1})]),_:1}),s(ue,{cols:"6"},{default:d(()=>[s(Z,{type:"info",class:"ma-4"},{default:d(()=>[A(g(m(l)("Install a soft token authenticator like FreeOTP or Google Authenticator from your application repository and use that app to scan this QR code.")),1)]),_:1}),k("label",$t,g(m(l)("Pin code")),1),s(It,{modelValue:p.value,"onUpdate:modelValue":E[0]||(E[0]=F=>p.value=F),error:o.value.length!==0},null,8,["modelValue","error"]),s(H,{color:"primary",onClick:M},{default:d(()=>[A(g(m(l)("Register")),1)]),_:1})]),_:1})]),_:1})):y.value?(R(),$(Q,{key:1},[s(Z,{type:"success"},{default:d(()=>[A(g(m(l)("Congratulations! Two-factor authentication using one-time passwords is now enabled for your account.")),1)]),_:1}),h.value.length?(R(),$(Q,{key:0},[k("p",Dt,g(m(l)("The following recovery codes can be used one time each to let you regain access to your account, in case you lose your phone for example. Make sure to save them in a safe place, otherwise you won't be able to access your account anymore.")),1),s(Fe,{density:"compact"},{default:d(()=>[k("tbody",null,[(R(!0),$(Q,null,Ne(h.value,F=>(R(),$("tr",{key:F},[k("td",null,g(F),1)]))),128))])]),_:1})],64)):q("",!0)],64)):C.value?(R(),$(Q,{key:2},[s(Z,{type:"info",class:"mb-2"},{default:d(()=>[A(g(m(l)("Two-factor authentication using one-time passwords is enabled for your account.")),1)]),_:1}),s(ee,{ref_key:"editTFAForm",ref:c},{default:d(()=>[k("label",Ot,g(m(l)("Password")),1),s(K,{modelValue:f.value,"onUpdate:modelValue":E[1]||(E[1]=F=>f.value=F),autocomplete:"new-password",type:"password",variant:"outlined",density:"compact",rules:[m(te).required],"error-messages":v.value},null,8,["modelValue","rules","error-messages"]),k("div",Bt,[s(H,{color:"error",class:"mr-2",loading:n.value,onClick:V},{default:d(()=>[A(g(m(l)("Disable 2FA")),1)]),_:1},8,["loading"])])]),_:1},512)],64)):(R(),$(Q,{key:3},[k("div",Lt,g(m(l)("Two-factor authentication (2FA) using one-time passwords is not yet activated for your account.")),1),s(H,{color:"success",onClick:S},{default:d(()=>[A(g(m(l)("Register authenticator")),1)]),_:1})],64))]),_:1})]),_:1})]))}},xt={class:"headline"},Be={__name:"RecoveryCodesResetDialog",props:{tokens:{type:Array,default:null}},emits:["close"],setup(r,{emit:l}){const{$gettext:i}=X(),u=l;function c(){u("close")}return(p,o)=>(R(),D(J,null,{default:d(()=>[s(pe,null,{default:d(()=>[k("span",xt,g(m(i)("New recovery codes")),1)]),_:1}),s(G,null,{default:d(()=>[s(Z,{type:"info"},{default:d(()=>[A(g(m(i)("The following recovery codes can be used one time each to let you regain access to your account, in case you lose your phone for example. Make sure to save them in a safe place, otherwise you won't be able to access your account anymore.")),1)]),_:1}),s(Fe,{class:"mt-4",density:"compact"},{default:d(()=>[k("tbody",null,[(R(!0),$(Q,null,Ne(r.tokens,e=>(R(),$("tr",{key:e},[k("td",null,g(e),1)]))),128))])]),_:1})]),_:1}),s(be,null,{default:d(()=>[s(ct),s(H,{color:"grey darken-1",text:"",onClick:c},{default:d(()=>[A(g(m(i)("Close")),1)]),_:1})]),_:1})]),_:1}))}},Qt={class:"text-h6"},Ht={class:"m-label"},Kt={class:"mt-5"},Yt={key:1,tag:"p",class:"my-4"},Wt={__name:"BackupCodeAuthForm",setup(r){const{$gettext:l}=X(),i=ne(),u=ie(),c=z(()=>u.authUser.tfa_enabled),p=_(!1),o=_(),e=_(""),t=_([]),a=_(),n=_(!1);async function f(){if(!await o.value.validate())return;const y={password:e.value};p.value=!0,Y.resetRecoveryCodes(y).then(C=>{t.value=C.data.tokens,n.value=!0}).catch(C=>{C.response.status===400?a.value=C.response.data.password:i.displayNotification({msg:l(C.response.data),type:"error"})}).finally(()=>{p.value=!1,o.value.reset()})}function v(){t.value=[],n.value=!1}return(h,y)=>(R(),$("div",null,[s(J,{flat:""},{default:d(()=>[s(pe,null,{default:d(()=>[k("span",Qt,g(m(l)("Backup codes")),1)]),_:1}),s(G,null,{default:d(()=>[c.value?(R(),$(Q,{key:0},[s(Z,{type:"info",class:"mb-2"},{default:d(()=>[A(g(m(l)("You already have generated backup codes for this account. If you don't remember them or have used them all, you can generate new ones.")),1)]),_:1}),s(ee,{ref_key:"editTFAForm",ref:o},{default:d(()=>[k("label",Ht,g(m(l)("Password")),1),s(K,{modelValue:e.value,"onUpdate:modelValue":y[0]||(y[0]=C=>e.value=C),autocomplete:"new-password",type:"password",variant:"outlined",density:"compact",rules:[m(te).required],"error-messages":a.value},null,8,["modelValue","rules","error-messages"]),k("div",Kt,[s(H,{loading:p.value,color:"success",onClick:f},{default:d(()=>[A(g(m(l)("Reset recovery codes")),1)]),_:1},8,["loading"])])]),_:1},512)],64)):(R(),$("div",Yt,g(m(l)("No two-factor authentificator is yet set for your account.")),1)),s(Te,{modelValue:n.value,"onUpdate:modelValue":y[1]||(y[1]=C=>n.value=C),"max-width":"800px",persistent:""},{default:d(()=>[s(m(Be),{tokens:t.value,onClose:v},null,8,["tokens"])]),_:1},8,["modelValue"])]),_:1})]),_:1})]))}},qt={class:"m-label"},Gt={__name:"ForwardForm",setup(r){const{$gettext:l}=X(),i=ne(),u=_({}),c=_(!1);function p(){c.value=!0,Y.setForward(u.value).then(()=>{c.value=!1,i.displayNotification({type:"success",msg:l("Forward updated")})})}return Y.getForward().then(o=>{u.value=o.data}),(o,e)=>(R(),D(J,{flat:""},{default:d(()=>[s(G,null,{default:d(()=>[k("label",qt,g(m(l)("Recipient(s)")),1),s(Ie,{modelValue:u.value.recipients,"onUpdate:modelValue":e[0]||(e[0]=t=>u.value.recipients=t),hint:m(l)("Indicate one or more recipients separated by a comma (,)"),"persistent-hint":"",rows:"3",variant:"outlined"},null,8,["modelValue","hint"]),s(Ue,{modelValue:u.value.keepcopies,"onUpdate:modelValue":e[1]||(e[1]=t=>u.value.keepcopies=t),label:m(l)("Keep local copies"),hint:m(l)("Forward messages and store copies into your local mailbox"),"persistent-hint":""},null,8,["modelValue","label","hint"])]),_:1}),s(be,{class:"pa-4"},{default:d(()=>[s(H,{color:"success",variant:"flat",loading:c.value,onClick:p},{default:d(()=>[A(g(m(l)("Update")),1)]),_:1},8,["loading"])]),_:1})]),_:1}))}},Jt={class:"m-label"},Xt={class:"mb-4"},Zt={class:"m-label"},jt={class:"mb-4"},ea={class:"m-label"},ta={class:"mb-4"},aa={class:"m-label"},oa={__name:"AutoReplyForm",setup(r){const l=ne(),{$gettext:i}=X(),u=_({}),c=_(),p=_(!1);async function o(){const{valid:e}=await c.value.validate();e&&(p.value=!0,Y.setARMessage(u.value).then(()=>{l.displayNotification({msg:i("Auto-reply message updated")}),p.value=!1}).catch(()=>{p.value=!1}))}return Y.getARMessage().then(e=>{u.value=e.data,u.value.fromdate&&(u.value.fromdate=u.value.fromdate.slice(0,-4)),u.value.untildate&&(u.value.untildate=u.value.untildate.slice(0,-4))}),(e,t)=>(R(),D(J,{flat:""},{default:d(()=>[s(G,null,{default:d(()=>[s(ee,{ref_key:"formRef",ref:c,onSubmit:ce(o,["prevent"])},{default:d(()=>[s(Ue,{modelValue:u.value.enabled,"onUpdate:modelValue":t[0]||(t[0]=a=>u.value.enabled=a),label:m(i)("Enabled"),color:"primary","hide-details":"",class:"mb-4"},null,8,["modelValue","label"]),k("label",Jt,g(m(i)("Subject")),1),s(K,{modelValue:u.value.subject,"onUpdate:modelValue":t[1]||(t[1]=a=>u.value.subject=a),variant:"outlined",density:"compact",rules:[m(te).required]},null,8,["modelValue","rules"]),k("div",Xt,[k("label",Zt,g(m(i)("Content")),1),s(Ie,{modelValue:u.value.content,"onUpdate:modelValue":t[2]||(t[2]=a=>u.value.content=a),hint:m(i)("The content of your answer. You can use the following variables, which will be automatically replaced by the appropriate value: %(name)s, %(fromdate)s, %(untildate)s"),"persistent-hint":"",variant:"outlined",rows:"3",density:"compact",rules:[m(te).required]},null,8,["modelValue","hint","rules"])]),k("div",jt,[k("label",ea,g(m(i)("From")),1),s(K,{modelValue:u.value.fromdate,"onUpdate:modelValue":t[3]||(t[3]=a=>u.value.fromdate=a),hint:m(i)("Activate your auto reply from this date"),variant:"outlined","persistent-hint":"",type:"datetime-local",density:"compact"},null,8,["modelValue","hint"])]),k("div",ta,[k("label",aa,g(m(i)("Until")),1),s(K,{modelValue:u.value.untildate,"onUpdate:modelValue":t[4]||(t[4]=a=>u.value.untildate=a),hint:m(i)("Activate your auto reply until this date"),variant:"outlined","persistent-hint":"",type:"datetime-local",density:"compact"},null,8,["modelValue","hint"])]),s(H,{color:"success",type:"submit",loading:p.value},{default:d(()=>[A(g(m(i)("Update auto-reply")),1)]),_:1},8,["loading"])]),_:1},512)]),_:1})]),_:1}))}},na={class:"m-label"},la={class:"ml-5 mr-5"},ra=["href"],sa={__name:"APISetupForm",setup(r){const{$gettext:l}=X(),i=ne(),u=Je("$config"),c=z(()=>u.API_DOC_URL),p=_(!1),o=_(null),e=_();function t(){navigator.clipboard.writeText(o.value),i.displayNotification({msg:l("API token copied to your clipboard"),type:"success"})}function a(){p.value=!0,Y.createAPIToken().then(v=>{o.value=v.data.token,i.displayNotification({msg:l("API token created"),type:"success"})}).finally(()=>p.value=!1)}function n(){e.value.open(l("Warning"),l("You are about to delete your API access token"),{color:"error",cancelLabel:l("Cancel"),agreeLabel:l("Proceed")})}async function f(){await Y.deleteAPIToken(),i.displayNotification({msg:l("API token deleted"),type:"success"}),o.value=null}return me(()=>{Y.getAPIToken().then(v=>{o.value=v.data.token})}),(v,h)=>(R(),$(Q,null,[o.value?(R(),D(J,{key:1,flat:""},{default:d(()=>[s(G,null,{default:d(()=>[k("label",na,g(m(l)("Your API token is:")),1),k("code",la,g(o.value),1),s(H,{icon:"mdi-clipboard-plus",density:"compact",title:m(l)("Copy token to clipboard"),variant:"text",onClick:h[0]||(h[0]=y=>t())},null,8,["title"]),s(H,{icon:"mdi-delete",density:"compact",color:"error",variant:"text",title:m(l)("Delete token"),onClick:n},null,8,["title"])]),_:1})]),_:1})):(R(),D(J,{key:0,flat:""},{default:d(()=>[s(G,null,{default:d(()=>[A(g(m(l)("Your API token has not been generated yet.")),1)]),_:1}),s(be,null,{default:d(()=>[s(H,{color:"success",variant:"flat",loading:p.value,onClick:a},{default:d(()=>[A(g(m(l)("Generate")),1)]),_:1},8,["loading"])]),_:1})]),_:1})),s(Z,{type:"info",variant:"tonal",border:"start",class:"mt-4"},{default:d(()=>[A(g(m(l)("A documentation of the API is available"))+" ",1),k("a",{href:c.value,target:"_blank"},g(m(l)("here")),9,ra),A(". ")]),_:1}),s(_e,{ref_key:"confirm",ref:e,onAgree:f},null,512)],64))}};function ua(r){const l="==".slice(0,(4-r.length%4)%4),i=r.replace(/-/g,"+").replace(/_/g,"/")+l,u=atob(i),c=new ArrayBuffer(u.length),p=new Uint8Array(c);for(let o=0;o<u.length;o++)p[o]=u.charCodeAt(o);return c}function ia(r){const l=new Uint8Array(r);let i="";for(const p of l)i+=String.fromCharCode(p);return btoa(i).replace(/\+/g,"-").replace(/\//g,"_").replace(/=/g,"")}var I="copy",j="convert";function ve(r,l,i){if(l===I)return i;if(l===j)return r(i);if(l instanceof Array)return i.map(u=>ve(r,l[0],u));if(l instanceof Object){const u={};for(const[c,p]of Object.entries(l)){if(p.derive){const o=p.derive(i);o!==void 0&&(i[c]=o)}if(!(c in i)){if(p.required)throw new Error(`Missing key: ${c}`);continue}if(i[c]==null){u[c]=null;continue}u[c]=ve(r,p.schema,i[c])}return u}}function Se(r,l){return{required:!0,schema:r,derive:l}}function B(r){return{required:!0,schema:r}}function x(r){return{required:!1,schema:r}}var da={type:B(I),id:B(j),transports:x(I)},ca={appid:x(I),appidExclude:x(I),credProps:x(I)},fa={appid:x(I),appidExclude:x(I),credProps:x(I)},va={publicKey:B({rp:B(I),user:B({id:B(j),name:B(I),displayName:B(I)}),challenge:B(j),pubKeyCredParams:B(I),timeout:x(I),excludeCredentials:x([da]),authenticatorSelection:x(I),attestation:x(I),extensions:x(ca)}),signal:x(I)},ma={type:B(I),id:B(I),rawId:B(j),authenticatorAttachment:x(I),response:B({clientDataJSON:B(j),attestationObject:B(j),transports:Se(I,r=>{var l;return((l=r.getTransports)==null?void 0:l.call(r))||[]})}),clientExtensionResults:Se(fa,r=>r.getClientExtensionResults())};function pa(r){return ve(ua,va,r)}function ha(r){return ve(ia,ma,r)}async function ga(r){const l=await navigator.credentials.create(r);return l.toJSON=()=>ha(l),l}const _a={class:"text-h6"},ya={tag:"p",class:"my-4"},ba={__name:"FidoAuthForm",setup(r){const l=ie(),{$gettext:i}=X(),u=_(),c=_(!1),p=!!(navigator.credentials&&navigator.credentials.create&&navigator.credentials.get&&window.PublicKeyCredential),o=_(),e=z(()=>l.fidoCreds),t=[{title:i("Name"),key:"name"},{title:i("Added On"),key:"added_on"},{title:i("Last Used"),key:"last_used"},{title:i("Use count"),key:"use_count"},{title:i("Actions"),key:"actions"}],a=_(),n=_(),f=_(),v=_(""),h=_(),y=_(!1);async function C(){const{valid:V}=await o.value.validate();if(!V)return;c.value=!0;const P=await Xe.beginFidoRegistration();if(P){const E=pa(P.data),b=(await ga(E)).toJSON();b.name=u.value,l.addFidoCred(b).then(N=>{N.status===200&&(h.value=N.data.tokens,y.value=!0)}),o.value.reset(),c.value=!1;return}c.value=!1}function T(){h.value=[],y.value=!1}async function w(V){await a.value.open(i("Warning"),i("Do you really want to delete this WebAuthn device?"),{color:"warning",cancelLabel:i("No"),agreeLabel:i("Yes")})&&l.deleteFidoCreds(V.id)}async function S(){return(await f.value.validate()).valid}async function M(V){if(v.value=V.name,!await n.value.open(i("Edition"),i("Edit your device"),{color:"warning",cancelLabel:i("Cancel"),agreeLabel:i("Save")}))return;const E={name:v.value};await l.editFidoCred(V.id,E)}return me(()=>{l.getFidoCreds()}),(V,P)=>(R(),$(Q,null,[k("div",null,[s(J,{flat:""},{default:d(()=>[s(pe,null,{default:d(()=>[k("span",_a,g(m(i)("WebAuthn")),1)]),_:1}),s(G,null,{default:d(()=>[s(de,null,{default:d(()=>[e.value.length===0?(R(),D(ue,{key:0,cols:"4"},{default:d(()=>[k("div",ya,g(m(i)("You don't have any WebAuthN device registered as a second authentication method.")),1)]),_:1})):(R(),D(ue,{key:1,cols:"8"},{default:d(()=>[k("h3",null,g(m(i)("Registered Webauthn devices")),1),s(ft,{headers:t,items:e.value,"item-value":"id"},{"item.added_on":d(({item:E})=>[A(g(V.$date(E.added_on)),1)]),"item.last_used":d(({item:E})=>[E.last_used===null?(R(),$(Q,{key:0},[A(g(m(i)("Never")),1)],64)):(R(),$(Q,{key:1},[A(g(V.$date(E.last_used)),1)],64))]),"item.enabled":d(({item:E})=>[A(g(V.$yesno(E.enabled)),1)]),"item.actions":d(({item:E})=>[s(ge,{class:"me-2",size:"small",onClick:F=>M(E)},{default:d(()=>[A(" mdi-pencil ")]),_:2},1032,["onClick"]),s(ge,{size:"small",onClick:F=>w(E)},{default:d(()=>[A(" mdi-delete ")]),_:2},1032,["onClick"])]),_:2},1032,["items"])]),_:1})),s(ue,{cols:"4"},{default:d(()=>[p?(R(),$(Q,{key:0},[k("h3",null,g(m(i)("Enter a name to register a new webauthn device.")),1),s(ee,{ref_key:"fidoForm",ref:o,onSubmit:ce(C,["prevent"])},{default:d(()=>[s(K,{modelValue:u.value,"onUpdate:modelValue":P[0]||(P[0]=E=>u.value=E),label:m(i)("New device name"),rules:[m(te).required]},null,8,["modelValue","label","rules"]),s(H,{color:"success",type:"submit",loading:c.value},{default:d(()=>[A(g(m(i)("Setup device")),1)]),_:1},8,["loading"])]),_:1},512)],64)):(R(),D(Z,{key:1,type:"error"},{default:d(()=>[A(g(m(i)("Your browser does not seem compatible with WebAuthN")),1)]),_:1}))]),_:1})]),_:1})]),_:1})]),_:1})]),s(_e,{ref_key:"confirmDeletion",ref:a},null,512),s(_e,{ref_key:"confirmEdition",ref:n,callback_agree:S},{default:d(()=>[s(ee,{ref_key:"editForm",ref:f},{default:d(()=>[s(K,{modelValue:v.value,"onUpdate:modelValue":P[1]||(P[1]=E=>v.value=E),label:m(i)("name"),rules:[m(te).required]},null,8,["modelValue","label","rules"])]),_:1},512)]),_:1},512),s(Te,{modelValue:y.value,"onUpdate:modelValue":P[2]||(P[2]=E=>y.value=E),"max-width":"800px",persistent:""},{default:d(()=>[s(Be,{tokens:h.value,onClose:T},null,8,["tokens"])]),_:1},8,["modelValue"])],64))}},wa={class:"pa-4"},Ca={__name:"SettingsView",setup(r){const l=ie(),i=_();return(u,c)=>(R(),$(Q,null,[s(vt,{flat:""},{default:d(()=>[s(mt,null,{default:d(()=>[A(g(u.$gettext("Account settings")),1)]),_:1})]),_:1}),k("div",wa,[s(pt,{modelValue:i.value,"onUpdate:modelValue":c[0]||(c[0]=p=>i.value=p),color:"primary",class:"mb-4"},{default:d(()=>[s(le,{value:"profile"},{default:d(()=>[A(g(u.$gettext("Profile")),1)]),_:1}),s(le,{value:"security"},{default:d(()=>[A(g(u.$gettext("Two-factor auth")),1)]),_:1}),m(l).userHasMailbox?(R(),D(le,{key:0,value:"forward"},{default:d(()=>[A(g(u.$gettext("Forward")),1)]),_:1})):q("",!0),m(l).userHasMailbox?(R(),D(le,{key:1,value:"autoreply"},{default:d(()=>[A(g(u.$gettext("Auto-reply message")),1)]),_:1})):q("",!0),m(l).authUser.role==="SuperAdmins"?(R(),D(le,{key:2,value:"api"},{default:d(()=>[A(g(u.$gettext("API access")),1)]),_:1})):q("",!0)]),_:1},8,["modelValue"]),s(ht,{modelValue:i.value,"onUpdate:modelValue":c[1]||(c[1]=p=>i.value=p)},{default:d(()=>[s(re,{value:"profile"},{default:d(()=>[s(Rt)]),_:1}),s(re,{value:"security"},{default:d(()=>[s(zt),s(ba),s(Wt)]),_:1}),m(l).userHasMailbox?(R(),D(re,{key:0,value:"forward"},{default:d(()=>[s(Gt)]),_:1})):q("",!0),m(l).userHasMailbox?(R(),D(re,{key:1,value:"autoreply"},{default:d(()=>[s(oa)]),_:1})):q("",!0),m(l).authUser.role==="SuperAdmins"?(R(),D(re,{key:2,value:"api"},{default:d(()=>[s(sa)]),_:1})):q("",!0)]),_:1},8,["modelValue"])])],64))}},to=Ze(Ca,[["__scopeId","data-v-ecac0f88"]]);export{to as default};
